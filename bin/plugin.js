import e from"events";import t from"https";import n from"http";import i from"net";import s from"tls";import o from"crypto";import r from"stream";import a from"url";import c from"zlib";import l from"buffer";import u,{join as d}from"node:path";import{cwd as h}from"node:process";import p,{existsSync as f,readFileSync as v}from"node:fs";import{execSync as m}from"child_process";import g from"fs";
/**!
 * @author Elgato
 * @module elgato/streamdeck
 * @license MIT
 * @copyright Copyright (c) Corsair Memory Inc.
 */var y,b;function _(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}!function(e){e[e.StreamDeck=0]="StreamDeck",e[e.StreamDeckMini=1]="StreamDeckMini",e[e.StreamDeckXL=2]="StreamDeckXL",e[e.StreamDeckMobile=3]="StreamDeckMobile",e[e.CorsairGKeys=4]="CorsairGKeys",e[e.StreamDeckPedal=5]="StreamDeckPedal",e[e.CorsairVoyager=6]="CorsairVoyager",e[e.StreamDeckPlus=7]="StreamDeckPlus",e[e.SCUFController=8]="SCUFController",e[e.StreamDeckNeo=9]="StreamDeckNeo",e[e.StreamDeckStudio=10]="StreamDeckStudio",e[e.VirtualStreamDeck=11]="VirtualStreamDeck"}(y||(y={})),function(e){e[e.Rectangle=0]="Rectangle",e[e.DoubleRectangle=1]="DoubleRectangle",e[e.Trapezoid=2]="Trapezoid",e[e.DoubleTrapezoid=3]="DoubleTrapezoid",e[e.Groove=4]="Groove"}(b||(b={}));var w,S,I,k,x,E,D,C={exports:{}};function O(){if(S)return w;S=1;const e=["nodebuffer","arraybuffer","fragments"],t="undefined"!=typeof Blob;return t&&e.push("blob"),w={BINARY_TYPES:e,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:t,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}}function M(){if(I)return C.exports;I=1;const{EMPTY_BUFFER:e}=O(),t=Buffer[Symbol.species];function n(e,t,n,i,s){for(let o=0;o<s;o++)n[i+o]=e[o]^t[3&o]}function i(e,t){for(let n=0;n<e.length;n++)e[n]^=t[3&n]}if(C.exports={concat:function(n,i){if(0===n.length)return e;if(1===n.length)return n[0];const s=Buffer.allocUnsafe(i);let o=0;for(let e=0;e<n.length;e++){const t=n[e];s.set(t,o),o+=t.length}return o<i?new t(s.buffer,s.byteOffset,o):s},mask:n,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(n){if(e.readOnly=!0,Buffer.isBuffer(n))return n;let i;return n instanceof ArrayBuffer?i=new t(n):ArrayBuffer.isView(n)?i=new t(n.buffer,n.byteOffset,n.byteLength):(i=Buffer.from(n),e.readOnly=!1),i},unmask:i},!process.env.WS_NO_BUFFER_UTIL)try{const e=require("bufferutil");C.exports.mask=function(t,i,s,o,r){r<48?n(t,i,s,o,r):e.mask(t,i,s,o,r)},C.exports.unmask=function(t,n){t.length<32?i(t,n):e.unmask(t,n)}}catch(e){}return C.exports}function P(){if(D)return E;D=1;const e=c,t=M(),n=function(){if(x)return k;x=1;const e=Symbol("kDone"),t=Symbol("kRun");return k=class{constructor(n){this[e]=()=>{this.pending--,this[t]()},this.concurrency=n||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[t]()}[t](){if(this.pending!==this.concurrency&&this.jobs.length){const t=this.jobs.shift();this.pending++,t(this[e])}}}}(),{kStatusCode:i}=O(),s=Buffer[Symbol.species],o=Buffer.from([0,0,255,255]),r=Symbol("permessage-deflate"),a=Symbol("total-length"),l=Symbol("callback"),u=Symbol("buffers"),d=Symbol("error");let h;function p(e){this[u].push(e),this[a]+=e.length}function f(e){this[a]+=e.length,this[r]._maxPayload<1||this[a]<=this[r]._maxPayload?this[u].push(e):(this[d]=new RangeError("Max payload size exceeded"),this[d].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[d][i]=1009,this.removeListener("data",f),this.reset())}function v(e){this[r]._inflate=null,this[d]?this[l](this[d]):(e[i]=1007,this[l](e))}return E=class{constructor(e,t,i){if(this._maxPayload=0|i,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!h){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;h=new n(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[l];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,n=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!n)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:!0!==n.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete n.client_max_window_bits,n}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){const e=+n;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==n)throw new TypeError(`Invalid value for parameter "${t}": ${n}`)}e[t]=n})}),e}decompress(e,t,n){h.add(i=>{this._decompress(e,t,(e,t)=>{i(),n(e,t)})})}compress(e,t,n){h.add(i=>{this._compress(e,t,(e,t)=>{i(),n(e,t)})})}_decompress(n,i,s){const c=this._isServer?"client":"server";if(!this._inflate){const t=`${c}_max_window_bits`,n="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._inflate=e.createInflateRaw({...this._options.zlibInflateOptions,windowBits:n}),this._inflate[r]=this,this._inflate[a]=0,this._inflate[u]=[],this._inflate.on("error",v),this._inflate.on("data",f)}this._inflate[l]=s,this._inflate.write(n),i&&this._inflate.write(o),this._inflate.flush(()=>{const e=this._inflate[d];if(e)return this._inflate.close(),this._inflate=null,void s(e);const n=t.concat(this._inflate[u],this._inflate[a]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[a]=0,this._inflate[u]=[],i&&this.params[`${c}_no_context_takeover`]&&this._inflate.reset()),s(null,n)})}_compress(n,i,o){const r=this._isServer?"server":"client";if(!this._deflate){const t=`${r}_max_window_bits`,n="number"!=typeof this.params[t]?e.Z_DEFAULT_WINDOWBITS:this.params[t];this._deflate=e.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:n}),this._deflate[a]=0,this._deflate[u]=[],this._deflate.on("data",p)}this._deflate[l]=o,this._deflate.write(n),this._deflate.flush(e.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=t.concat(this._deflate[u],this._deflate[a]);i&&(e=new s(e.buffer,e.byteOffset,e.length-4)),this._deflate[l]=null,this._deflate[a]=0,this._deflate[u]=[],i&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),o(null,e)})}}}var A,T,z,L,$,N,j,R,U,B,F,V,W,G={exports:{}};function Z(){if(A)return G.exports;A=1;const{isUtf8:e}=l,{hasBlob:t}=O();function n(e){const t=e.length;let n=0;for(;n<t;)if(128&e[n])if(192==(224&e[n])){if(n+1===t||128!=(192&e[n+1])||192==(254&e[n]))return!1;n+=2}else if(224==(240&e[n])){if(n+2>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||224===e[n]&&128==(224&e[n+1])||237===e[n]&&160==(224&e[n+1]))return!1;n+=3}else{if(240!=(248&e[n]))return!1;if(n+3>=t||128!=(192&e[n+1])||128!=(192&e[n+2])||128!=(192&e[n+3])||240===e[n]&&128==(240&e[n+1])||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}else n++;return!0}if(G.exports={isBlob:function(e){return t&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:n,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},e)G.exports.isValidUTF8=function(t){return t.length<24?n(t):e(t)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const e=require("utf-8-validate");G.exports.isValidUTF8=function(t){return t.length<32?n(t):e(t)}}catch(e){}return G.exports}function K(){if(z)return T;z=1;const{Writable:e}=r,t=P(),{BINARY_TYPES:n,EMPTY_BUFFER:i,kStatusCode:s,kWebSocket:o}=O(),{concat:a,toArrayBuffer:c,unmask:l}=M(),{isValidStatusCode:u,isValidUTF8:d}=Z(),h=Buffer[Symbol.species];return T=class extends e{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||n[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[o]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new h(t.buffer,t.byteOffset+e,t.length-e),new h(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const n=this._buffers[0],i=t.length-e;e>=n.length?t.set(this._buffers.shift(),i):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),i),this._buffers[0]=new h(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const n=this.consume(2);if(48&n[0]){return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"))}const i=!(64&~n[0]);if(i&&!this._extensions[t.extensionName]){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._fin=!(128&~n[0]),this._opcode=15&n[0],this._payloadLength=127&n[1],0===this._opcode){if(i){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(!this._fragmented){return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"))}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}this._compressed=i}else{if(!(this._opcode>7&&this._opcode<11)){return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"))}if(!this._fin){return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"))}if(i){return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~n[1]),this._isServer){if(!this._masked){return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}}else if(this._masked){return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"))}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),n=t.readUInt32BE(0);if(n>Math.pow(2,21)-1){return void e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"))}this._payloadLength=n*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){return void e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"))}this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=i;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&l(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,n){this._extensions[t.extensionName].decompress(e,this._fin,(e,t)=>{if(e)return n(e);if(t.length){if(this._messageLength+=t.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void n(e)}this._fragments.push(t)}this.dataMessage(n),0===this._state&&this.startLoop(n)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let i;i="nodebuffer"===this._binaryType?a(n,t):"arraybuffer"===this._binaryType?c(a(n,t)):"blob"===this._binaryType?new Blob(n):n,this._allowSynchronousEvents?(this.emit("message",i,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!0),this._state=0,this.startLoop(e)}))}else{const i=a(n,t);if(!this._skipUTF8Validation&&!d(i)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",i,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",i,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,i),this.end();else{const n=e.readUInt16BE(0);if(!u(n)){const e=this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const i=new h(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!d(i)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",n,i),this.end()}this._state=0}}createError(e,t,n,i,o){this._loop=!1,this._errored=!0;const r=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(r,this.createError),r.code=o,r[s]=i,r}}}function q(){if($)return L;$=1;const{Duplex:e}=r,{randomFillSync:t}=o,n=P(),{EMPTY_BUFFER:i,kWebSocket:s,NOOP:a}=O(),{isBlob:c,isValidStatusCode:l}=Z(),{mask:u,toBuffer:d}=M(),h=Symbol("kByteLength"),p=Buffer.alloc(4),f=8192;let v,m=f;class g{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=a,this[s]=void 0}static frame(e,n){let i,s,o=!1,r=2,a=!1;n.mask&&(i=n.maskBuffer||p,n.generateMask?n.generateMask(i):(m===f&&(void 0===v&&(v=Buffer.alloc(f)),t(v,0,f),m=0),i[0]=v[m++],i[1]=v[m++],i[2]=v[m++],i[3]=v[m++]),a=0===(i[0]|i[1]|i[2]|i[3]),r=6),"string"==typeof e?s=n.mask&&!a||void 0===n[h]?(e=Buffer.from(e)).length:n[h]:(s=e.length,o=n.mask&&n.readOnly&&!a);let c=s;s>=65536?(r+=8,c=127):s>125&&(r+=2,c=126);const l=Buffer.allocUnsafe(o?s+r:r);return l[0]=n.fin?128|n.opcode:n.opcode,n.rsv1&&(l[0]|=64),l[1]=c,126===c?l.writeUInt16BE(s,2):127===c&&(l[2]=l[3]=0,l.writeUIntBE(s,4,6)),n.mask?(l[1]|=128,l[r-4]=i[0],l[r-3]=i[1],l[r-2]=i[2],l[r-1]=i[3],a?[l,e]:o?(u(e,i,l,r,s),[l]):(u(e,i,e,0,s),[l,e])):[l,e]}close(e,t,n,s){let o;if(void 0===e)o=i;else{if("number"!=typeof e||!l(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const n=Buffer.byteLength(t);if(n>123)throw new RangeError("The message must not be greater than 123 bytes");o=Buffer.allocUnsafe(2+n),o.writeUInt16BE(e,0),"string"==typeof t?o.write(t,2):o.set(t,2)}else o=Buffer.allocUnsafe(2),o.writeUInt16BE(e,0)}const r={[h]:o.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,o,!1,r,s]):this.sendFrame(g.frame(o,r),s)}ping(e,t,n){let i,s;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):c(e)?(i=e.size,s=!1):(i=(e=d(e)).length,s=d.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[h]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:s,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(g.frame(e,o),n)}pong(e,t,n){let i,s;if("string"==typeof e?(i=Buffer.byteLength(e),s=!1):c(e)?(i=e.size,s=!1):(i=(e=d(e)).length,s=d.readOnly),i>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[h]:i,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:s,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(g.frame(e,o),n)}send(e,t,i){const s=this._extensions[n.extensionName];let o,r,a=t.binary?2:1,l=t.compress;"string"==typeof e?(o=Buffer.byteLength(e),r=!1):c(e)?(o=e.size,r=!1):(o=(e=d(e)).length,r=d.readOnly),this._firstFragment?(this._firstFragment=!1,l&&s&&s.params[s._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=o>=s._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);const u={[h]:o,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:r,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,i]):this.getBlobData(e,this._compress,u,i):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,i]):this.dispatch(e,this._compress,u,i)}getBlobData(e,t,n,i){this._bufferedBytes+=n[h],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(y,this,e,i)}this._bufferedBytes-=n[h];const s=d(e);t?this.dispatch(s,t,n,i):(this._state=0,this.sendFrame(g.frame(s,n),i),this.dequeue())}).catch(e=>{process.nextTick(b,this,e,i)})}dispatch(e,t,i,s){if(!t)return void this.sendFrame(g.frame(e,i),s);const o=this._extensions[n.extensionName];this._bufferedBytes+=i[h],this._state=1,o.compress(e,i.fin,(e,t)=>{if(this._socket.destroyed){return void y(this,new Error("The socket was closed while data was being compressed"),s)}this._bufferedBytes-=i[h],this._state=0,i.readOnly=!1,this.sendFrame(g.frame(t,i),s),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][h],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][h],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function y(e,t,n){"function"==typeof n&&n(t);for(let n=0;n<e._queue.length;n++){const i=e._queue[n],s=i[i.length-1];"function"==typeof s&&s(t)}}function b(e,t,n){y(e,t,n),e.onerror(t)}return L=g}function H(){if(U)return R;U=1;const{tokenChars:e}=Z();function t(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}return R={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(n){const i=Object.create(null);let s,o,r=Object.create(null),a=!1,c=!1,l=!1,u=-1,d=-1,h=-1,p=0;for(;p<n.length;p++)if(d=n.charCodeAt(p),void 0===s)if(-1===h&&1===e[d])-1===u&&(u=p);else if(0===p||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);const e=n.slice(u,h);44===d?(t(i,e,r),r=Object.create(null)):s=e,u=h=-1}}else-1===h&&-1!==u&&(h=p);else if(void 0===o)if(-1===h&&1===e[d])-1===u&&(u=p);else if(32===d||9===d)-1===h&&-1!==u&&(h=p);else if(59===d||44===d){if(-1===u)throw new SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p),t(r,n.slice(u,h),!0),44===d&&(t(i,s,r),r=Object.create(null),s=void 0),u=h=-1}else{if(61!==d||-1===u||-1!==h)throw new SyntaxError(`Unexpected character at index ${p}`);o=n.slice(u,p),u=h=-1}else if(c){if(1!==e[d])throw new SyntaxError(`Unexpected character at index ${p}`);-1===u?u=p:a||(a=!0),c=!1}else if(l)if(1===e[d])-1===u&&(u=p);else if(34===d&&-1!==u)l=!1,h=p;else{if(92!==d)throw new SyntaxError(`Unexpected character at index ${p}`);c=!0}else if(34===d&&61===n.charCodeAt(p-1))l=!0;else if(-1===h&&1===e[d])-1===u&&(u=p);else if(-1===u||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===u)throw new SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let e=n.slice(u,h);a&&(e=e.replace(/\\/g,""),a=!1),t(r,o,e),44===d&&(t(i,s,r),r=Object.create(null),s=void 0),o=void 0,u=h=-1}}else-1===h&&(h=p);if(-1===u||l||32===d||9===d)throw new SyntaxError("Unexpected end of input");-1===h&&(h=p);const f=n.slice(u,h);return void 0===s?t(i,f,r):(void 0===o?t(r,f,!0):t(r,o,a?f.replace(/\\/g,""):f),t(i,s,r)),i}}}function X(){if(F)return B;F=1;const c=e,l=t,u=n,d=i,h=s,{randomBytes:p,createHash:f}=o,{Duplex:v,Readable:m}=r,{URL:g}=a,y=P(),b=K(),_=q(),{isBlob:w}=Z(),{BINARY_TYPES:S,EMPTY_BUFFER:I,GUID:k,kForOnEventAttribute:x,kListener:E,kStatusCode:D,kWebSocket:C,NOOP:A}=O(),{EventTarget:{addEventListener:T,removeEventListener:z}}=function(){if(j)return N;j=1;const{kForOnEventAttribute:e,kListener:t}=O(),n=Symbol("kCode"),i=Symbol("kData"),s=Symbol("kError"),o=Symbol("kMessage"),r=Symbol("kReason"),a=Symbol("kTarget"),c=Symbol("kType"),l=Symbol("kWasClean");class u{constructor(e){this[a]=null,this[c]=e}get target(){return this[a]}get type(){return this[c]}}Object.defineProperty(u.prototype,"target",{enumerable:!0}),Object.defineProperty(u.prototype,"type",{enumerable:!0});class d extends u{constructor(e,t={}){super(e),this[n]=void 0===t.code?0:t.code,this[r]=void 0===t.reason?"":t.reason,this[l]=void 0!==t.wasClean&&t.wasClean}get code(){return this[n]}get reason(){return this[r]}get wasClean(){return this[l]}}Object.defineProperty(d.prototype,"code",{enumerable:!0}),Object.defineProperty(d.prototype,"reason",{enumerable:!0}),Object.defineProperty(d.prototype,"wasClean",{enumerable:!0});class h extends u{constructor(e,t={}){super(e),this[s]=void 0===t.error?null:t.error,this[o]=void 0===t.message?"":t.message}get error(){return this[s]}get message(){return this[o]}}Object.defineProperty(h.prototype,"error",{enumerable:!0}),Object.defineProperty(h.prototype,"message",{enumerable:!0});class p extends u{constructor(e,t={}){super(e),this[i]=void 0===t.data?null:t.data}get data(){return this[i]}}Object.defineProperty(p.prototype,"data",{enumerable:!0});const f={addEventListener(n,i,s={}){for(const o of this.listeners(n))if(!s[e]&&o[t]===i&&!o[e])return;let o;if("message"===n)o=function(e,t){const n=new p("message",{data:t?e:e.toString()});n[a]=this,v(i,this,n)};else if("close"===n)o=function(e,t){const n=new d("close",{code:e,reason:t.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[a]=this,v(i,this,n)};else if("error"===n)o=function(e){const t=new h("error",{error:e,message:e.message});t[a]=this,v(i,this,t)};else{if("open"!==n)return;o=function(){const e=new u("open");e[a]=this,v(i,this,e)}}o[e]=!!s[e],o[t]=i,s.once?this.once(n,o):this.on(n,o)},removeEventListener(n,i){for(const s of this.listeners(n))if(s[t]===i&&!s[e]){this.removeListener(n,s);break}}};function v(e,t,n){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,n):e.call(t,n)}return N={CloseEvent:d,ErrorEvent:h,Event:u,EventTarget:f,MessageEvent:p}}(),{format:L,parse:$}=H(),{toBuffer:R}=M(),U=Symbol("kAborted"),V=[8,13],W=["CONNECTING","OPEN","CLOSING","CLOSED"],G=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class X extends c{constructor(e,t,n){super(),this._binaryType=S[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=I,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=X.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(n=t,t=[]):t=[t]),J(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){S.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){const i=new b({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),s=new _(e,this._extensions,n.generateMask);this._receiver=i,this._sender=s,this._socket=e,i[C]=this,s[C]=this,e[C]=this,i.on("conclude",ie),i.on("drain",se),i.on("error",oe),i.on("message",ae),i.on("ping",ce),i.on("pong",le),s.onerror=de,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",pe),e.on("data",fe),e.on("end",ve),e.on("error",me),this._readyState=X.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=X.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[y.extensionName]&&this._extensions[y.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=X.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==X.CLOSED){if(this.readyState===X.CONNECTING){const e="WebSocket was closed before the connection was established";return void te(this,this._req,e)}this.readyState!==X.CLOSING?(this._readyState=X.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),he(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==X.CONNECTING&&this.readyState!==X.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===X.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===X.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||I,t,n)):ne(this,e,n)}pong(e,t,n){if(this.readyState===X.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===X.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||I,t,n)):ne(this,e,n)}resume(){this.readyState!==X.CONNECTING&&this.readyState!==X.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===X.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==X.OPEN)return void ne(this,e,n);const i={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[y.extensionName]||(i.compress=!1),this._sender.send(e||I,i,n)}terminate(){if(this.readyState!==X.CLOSED){if(this.readyState===X.CONNECTING){const e="WebSocket was closed before the connection was established";return void te(this,this._req,e)}this._socket&&(this._readyState=X.CLOSING,this._socket.destroy())}}}function J(e,t,n,i){const s={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:V[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...i,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=s.autoPong,!V.includes(s.protocolVersion))throw new RangeError(`Unsupported protocol version: ${s.protocolVersion} (supported versions: ${V.join(", ")})`);let o;if(t instanceof g)o=t;else try{o=new g(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===o.protocol?o.protocol="ws:":"https:"===o.protocol&&(o.protocol="wss:"),e._url=o.href;const r="wss:"===o.protocol,a="ws+unix:"===o.protocol;let c;if("ws:"===o.protocol||r||a?a&&!o.pathname?c="The URL's pathname is empty":o.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',c){const t=new SyntaxError(c);if(0===e._redirects)throw t;return void Y(e,t)}const d=r?443:80,h=p(16).toString("base64"),v=r?l.request:u.request,m=new Set;let b,_;if(s.createConnection=s.createConnection||(r?ee:Q),s.defaultPort=s.defaultPort||d,s.port=o.port||d,s.host=o.hostname.startsWith("[")?o.hostname.slice(1,-1):o.hostname,s.headers={...s.headers,"Sec-WebSocket-Version":s.protocolVersion,"Sec-WebSocket-Key":h,Connection:"Upgrade",Upgrade:"websocket"},s.path=o.pathname+o.search,s.timeout=s.handshakeTimeout,s.perMessageDeflate&&(b=new y(!0!==s.perMessageDeflate?s.perMessageDeflate:{},!1,s.maxPayload),s.headers["Sec-WebSocket-Extensions"]=L({[y.extensionName]:b.offer()})),n.length){for(const e of n){if("string"!=typeof e||!G.test(e)||m.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");m.add(e)}s.headers["Sec-WebSocket-Protocol"]=n.join(",")}if(s.origin&&(s.protocolVersion<13?s.headers["Sec-WebSocket-Origin"]=s.origin:s.headers.Origin=s.origin),(o.username||o.password)&&(s.auth=`${o.username}:${o.password}`),a){const e=s.path.split(":");s.socketPath=e[0],s.path=e[1]}if(s.followRedirects){if(0===e._redirects){e._originalIpc=a,e._originalSecure=r,e._originalHostOrSocketPath=a?s.socketPath:o.host;const t=i&&i.headers;if(i={...i,headers:{}},t)for(const[e,n]of Object.entries(t))i.headers[e.toLowerCase()]=n}else if(0===e.listenerCount("redirect")){const t=a?!!e._originalIpc&&s.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&o.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!r)&&(delete s.headers.authorization,delete s.headers.cookie,t||delete s.headers.host,s.auth=void 0)}s.auth&&!i.headers.authorization&&(i.headers.authorization="Basic "+Buffer.from(s.auth).toString("base64")),_=e._req=v(s),e._redirects&&e.emit("redirect",e.url,_)}else _=e._req=v(s);s.timeout&&_.on("timeout",()=>{te(e,_,"Opening handshake has timed out")}),_.on("error",t=>{null===_||_[U]||(_=e._req=null,Y(e,t))}),_.on("response",o=>{const r=o.headers.location,a=o.statusCode;if(r&&s.followRedirects&&a>=300&&a<400){if(++e._redirects>s.maxRedirects)return void te(e,_,"Maximum redirects exceeded");let o;_.abort();try{o=new g(r,t)}catch(t){const n=new SyntaxError(`Invalid URL: ${r}`);return void Y(e,n)}J(e,o,n,i)}else e.emit("unexpected-response",_,o)||te(e,_,`Unexpected server response: ${o.statusCode}`)}),_.on("upgrade",(t,n,i)=>{if(e.emit("upgrade",t),e.readyState!==X.CONNECTING)return;_=e._req=null;const o=t.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase())return void te(e,n,"Invalid Upgrade header");const r=f("sha1").update(h+k).digest("base64");if(t.headers["sec-websocket-accept"]!==r)return void te(e,n,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"];let c;if(void 0!==a?m.size?m.has(a)||(c="Server sent an invalid subprotocol"):c="Server sent a subprotocol but none was requested":m.size&&(c="Server sent no subprotocol"),c)return void te(e,n,c);a&&(e._protocol=a);const l=t.headers["sec-websocket-extensions"];if(void 0!==l){if(!b){return void te(e,n,"Server sent a Sec-WebSocket-Extensions header but no extension was requested")}let t;try{t=$(l)}catch(t){return void te(e,n,"Invalid Sec-WebSocket-Extensions header")}const i=Object.keys(t);if(1!==i.length||i[0]!==y.extensionName){return void te(e,n,"Server indicated an extension that was not requested")}try{b.accept(t[y.extensionName])}catch(t){return void te(e,n,"Invalid Sec-WebSocket-Extensions header")}e._extensions[y.extensionName]=b}e.setSocket(n,i,{allowSynchronousEvents:s.allowSynchronousEvents,generateMask:s.generateMask,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation})}),s.finishRequest?s.finishRequest(_,e):_.end()}function Y(e,t){e._readyState=X.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function Q(e){return e.path=e.socketPath,d.connect(e)}function ee(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=d.isIP(e.host)?"":e.host),h.connect(e)}function te(e,t,n){e._readyState=X.CLOSING;const i=new Error(n);Error.captureStackTrace(i,te),t.setHeader?(t[U]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(Y,e,i)):(t.destroy(i),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function ne(e,t,n){if(t){const n=w(t)?t.size:R(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${W[e.readyState]})`);process.nextTick(n,t)}}function ie(e,t){const n=this[C];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,void 0!==n._socket[C]&&(n._socket.removeListener("data",fe),process.nextTick(ue,n._socket),1005===e?n.close():n.close(e,t))}function se(){const e=this[C];e.isPaused||e._socket.resume()}function oe(e){const t=this[C];void 0!==t._socket[C]&&(t._socket.removeListener("data",fe),process.nextTick(ue,t._socket),t.close(e[D])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function re(){this[C].emitClose()}function ae(e,t){this[C].emit("message",e,t)}function ce(e){const t=this[C];t._autoPong&&t.pong(e,!this._isServer,A),t.emit("ping",e)}function le(e){this[C].emit("pong",e)}function ue(e){e.resume()}function de(e){const t=this[C];t.readyState!==X.CLOSED&&(t.readyState===X.OPEN&&(t._readyState=X.CLOSING,he(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function he(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function pe(){const e=this[C];let t;this.removeListener("close",pe),this.removeListener("data",fe),this.removeListener("end",ve),e._readyState=X.CLOSING,this._readableState.endEmitted||e._closeFrameReceived||e._receiver._writableState.errorEmitted||null===(t=e._socket.read())||e._receiver.write(t),e._receiver.end(),this[C]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",re),e._receiver.on("finish",re))}function fe(e){this[C]._receiver.write(e)||this.pause()}function ve(){const e=this[C];e._readyState=X.CLOSING,e._receiver.end(),this.end()}function me(){const e=this[C];this.removeListener("error",me),this.on("error",A),e&&(e._readyState=X.CLOSING,this.destroy())}return Object.defineProperty(X,"CONNECTING",{enumerable:!0,value:W.indexOf("CONNECTING")}),Object.defineProperty(X.prototype,"CONNECTING",{enumerable:!0,value:W.indexOf("CONNECTING")}),Object.defineProperty(X,"OPEN",{enumerable:!0,value:W.indexOf("OPEN")}),Object.defineProperty(X.prototype,"OPEN",{enumerable:!0,value:W.indexOf("OPEN")}),Object.defineProperty(X,"CLOSING",{enumerable:!0,value:W.indexOf("CLOSING")}),Object.defineProperty(X.prototype,"CLOSING",{enumerable:!0,value:W.indexOf("CLOSING")}),Object.defineProperty(X,"CLOSED",{enumerable:!0,value:W.indexOf("CLOSED")}),Object.defineProperty(X.prototype,"CLOSED",{enumerable:!0,value:W.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(X.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(X.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[x])return t[E];return null},set(t){for(const t of this.listeners(e))if(t[x]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[x]:!0})}})}),X.prototype.addEventListener=T,X.prototype.removeEventListener=z,B=X}!function(){if(W)return V;W=1,X();const{Duplex:e}=r;function t(e){e.emit("close")}function n(){!this.destroyed&&this._writableState.finished&&this.destroy()}function i(e){this.removeListener("error",i),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}V=function(s,o){let r=!0;const a=new e({...o,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return s.on("message",function(e,t){const n=!t&&a._readableState.objectMode?e.toString():e;a.push(n)||s.pause()}),s.once("error",function(e){a.destroyed||(r=!1,a.destroy(e))}),s.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(e,n){if(s.readyState===s.CLOSED)return n(e),void process.nextTick(t,a);let i=!1;s.once("error",function(e){i=!0,n(e)}),s.once("close",function(){i||n(e),process.nextTick(t,a)}),r&&s.terminate()},a._final=function(e){s.readyState!==s.CONNECTING?null!==s._socket&&(s._socket._writableState.finished?(e(),a._readableState.endEmitted&&a.destroy()):(s._socket.once("finish",function(){e()}),s.close())):s.once("open",function(){a._final(e)})},a._read=function(){s.isPaused&&s.resume()},a._write=function(e,t,n){s.readyState!==s.CONNECTING?s.send(e,n):s.once("open",function(){a._write(e,t,n)})},a.on("end",n),a.on("error",i),a}}(),K(),q();var J,Y,Q,ee,te=_(X());function ne(){if(Y)return J;Y=1;const{tokenChars:e}=Z();return J={parse:function(t){const n=new Set;let i=-1,s=-1,o=0;for(;o<t.length;o++){const r=t.charCodeAt(o);if(-1===s&&1===e[r])-1===i&&(i=o);else if(0===o||32!==r&&9!==r){if(44!==r)throw new SyntaxError(`Unexpected character at index ${o}`);{if(-1===i)throw new SyntaxError(`Unexpected character at index ${o}`);-1===s&&(s=o);const e=t.slice(i,s);if(n.has(e))throw new SyntaxError(`The "${e}" subprotocol is duplicated`);n.add(e),i=s=-1}}else-1===s&&-1!==i&&(s=o)}if(-1===i||-1!==s)throw new SyntaxError("Unexpected end of input");const r=t.slice(i,o);if(n.has(r))throw new SyntaxError(`The "${r}" subprotocol is duplicated`);return n.add(r),n}}}!function(){if(ee)return Q;ee=1;const t=e,i=n,{Duplex:s}=r,{createHash:a}=o,c=H(),l=P(),u=ne(),d=X(),{GUID:h,kWebSocket:p}=O(),f=/^[+/0-9A-Za-z]{22}==$/;function v(e){e._state=2,e.emit("close")}function m(){this.destroy()}function g(e,t,n,s){n=n||i.STATUS_CODES[t],s={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...s},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(s).map(e=>`${e}: ${s[e]}`).join("\r\n")+"\r\n\r\n"+n)}function y(e,t,n,i,s,o){if(e.listenerCount("wsClientError")){const i=new Error(s);Error.captureStackTrace(i,y),e.emit("wsClientError",i,n,t)}else g(n,i,s,o)}Q=class extends t{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:d,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{const n=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const n of Object.keys(t))e.on(n,t[n]);return function(){for(const n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,i)=>{this.handleUpgrade(t,n,i,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(v,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(v,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{v(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,i){t.on("error",m);const s=e.headers["sec-websocket-key"],o=e.headers.upgrade,r=+e.headers["sec-websocket-version"];if("GET"!==e.method){return void y(this,e,t,405,"Invalid HTTP method")}if(void 0===o||"websocket"!==o.toLowerCase()){return void y(this,e,t,400,"Invalid Upgrade header")}if(void 0===s||!f.test(s)){return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header")}if(13!==r&&8!==r){return void y(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"})}if(!this.shouldHandle(e))return void g(t,400);const a=e.headers["sec-websocket-protocol"];let d=new Set;if(void 0!==a)try{d=u.parse(a)}catch(n){return void y(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const h=e.headers["sec-websocket-extensions"],p={};if(this.options.perMessageDeflate&&void 0!==h){const n=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=c.parse(h);e[l.extensionName]&&(n.accept(e[l.extensionName]),p[l.extensionName]=n)}catch(n){return void y(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const o={origin:e.headers[""+(8===r?"sec-websocket-origin":"origin")],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,r,a,c)=>{if(!o)return g(t,r||401,a,c);this.completeUpgrade(p,s,d,e,t,n,i)});if(!this.options.verifyClient(o))return g(t,401)}this.completeUpgrade(p,s,d,e,t,n,i)}completeUpgrade(e,t,n,i,s,o,r){if(!s.readable||!s.writable)return s.destroy();if(s[p])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return g(s,503);const u=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${a("sha1").update(t+h).digest("base64")}`],d=new this.options.WebSocket(null,void 0,this.options);if(n.size){const e=this.options.handleProtocols?this.options.handleProtocols(n,i):n.values().next().value;e&&(u.push(`Sec-WebSocket-Protocol: ${e}`),d._protocol=e)}if(e[l.extensionName]){const t=e[l.extensionName].params,n=c.format({[l.extensionName]:[t]});u.push(`Sec-WebSocket-Extensions: ${n}`),d._extensions=e}this.emit("headers",u,i),s.write(u.concat("\r\n").join("\r\n")),s.removeListener("error",m),d.setSocket(s,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(d),d.on("close",()=>{this.clients.delete(d),this._shouldEmitClose&&!this.clients.size&&process.nextTick(v,this)})),r(d,i)}}}();
/**!
 * @author Elgato
 * @module elgato/streamdeck
 * @license MIT
 * @copyright Copyright (c) Corsair Memory Inc.
 */
const ie=["de","en","es","fr","ja","ko","zh_CN","zh_TW"];var se,oe;function re(e){null==e||"object"!=typeof e||Object.isFrozen(e)||(Object.freeze(e),Object.values(e).forEach(re))}function ae(e,t){return e.split(".").reduce((e,t)=>e&&e[t],t)}!function(e){e.Port="-port",e.Info="-info",e.PluginUUID="-pluginUUID",e.RegisterEvent="-registerEvent"}(se||(se={})),function(e){e[e.HardwareAndSoftware=0]="HardwareAndSoftware",e[e.Hardware=1]="Hardware",e[e.Software=2]="Software"}(oe||(oe={}));class ce{language;readTranslations;static DEFAULT_LANGUAGE="en";_translations=new Map;constructor(e,t){this.language=e,this.readTranslations=t}t(e,t=this.language){return this.translate(e,t)}translate(e,t=this.language){return t===ce.DEFAULT_LANGUAGE?ae(e,this.getTranslations(t))?.toString()||e:ae(e,this.getTranslations(t))?.toString()||ae(e,this.getTranslations(ce.DEFAULT_LANGUAGE))?.toString()||e}getTranslations(e){let t=this._translations.get(e);return void 0===t&&(t=ie.includes(e)?this.readTranslations(e):null,re(t),this._translations.set(e,t)),t}}class le{type;constructor(e){this.type=e.event}}class ue extends le{action;constructor(e,t){super(t),this.action=e}}class de extends ue{payload;constructor(e,t){super(e,t),this.payload=t.payload}}class he extends le{settings;constructor(e){super(e),this.settings=e.payload.settings}}class pe{#e=void 0;#t;constructor(e){this.#t=e}get value(){return void 0===this.#e&&(this.#e=this.#t()),this.#e}}Symbol.dispose??=Symbol("Symbol.dispose");let fe=class{events=new Map;addListener(e,t){return this.on(e,t)}disposableOn(e,t){return this.addListener(e,t),function(e){let t=!1;const n=()=>{t||(e(),t=!0)};return{[Symbol.dispose]:n,dispose:n}}(()=>this.removeListener(e,t))}emit(e,...t){const n=this.events.get(e);if(void 0===n)return!1;for(let e=0;e<n.length;){const{listener:i,once:s}=n[e];s?n.splice(e,1):e++,i(...t)}return!0}eventNames(){return Array.from(this.events.keys())}listenerCount(e,t){const n=this.events.get(e);if(void 0===n||null==t)return n?.length||0;let i=0;return n.forEach(e=>{e.listener===t&&i++}),i}listeners(e){return Array.from(this.events.get(e)||[]).map(({listener:e})=>e)}off(e,t){const n=this.events.get(e)||[];for(let e=n.length-1;e>=0;e--)n[e].listener===t&&n.splice(e,1);return this}on(e,t){return this.add(e,e=>e.push({listener:t}))}once(e,t){return this.add(e,e=>e.push({listener:t,once:!0}))}prependListener(e,t){return this.add(e,e=>e.splice(0,0,{listener:t}))}prependOnceListener(e,t){return this.add(e,e=>e.splice(0,0,{listener:t,once:!0}))}removeAllListeners(e){return this.events.delete(e),this}removeListener(e,t){return this.off(e,t)}add(e,t){let n=this.events.get(e);return void 0===n&&(n=[],this.events.set(e,n)),t(n),this}};class ve{_promise;_reject;_resolve;constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}setException(e){this._reject&&this._reject(e)}setResult(e){this._resolve&&this._resolve(e)}}class me{build;major;minor;patch;constructor(e){const t=e.match(/^(0|[1-9]\d*)(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?(?:\.(0|[1-9]\d*))?$/);if(null===t)throw new Error(`Invalid format; expected "{major}[.{minor}[.{patch}[.{build}]]]" but was "${e}"`);[,this.major,this.minor,this.patch,this.build]=[...t.map(e=>parseInt(e)||0)]}compareTo(e){const t=({major:e,minor:t,build:n,patch:i})=>[e,t,n,i],n=t(this),i=t(e);for(let e=0;e<4;e++){if(n[e]<i[e])return-1;if(n[e]>i[e])return 1}return 0}toString(){return`${this.major}.${this.minor}`}}var ge;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG",e[e.TRACE=4]="TRACE"}(ge||(ge={}));class ye{write(e){switch(e.level){case ge.ERROR:console.error(...e.data);break;case ge.WARN:console.warn(...e.data);break;default:console.log(...e.data)}}}const be="\n";class _e{_level;options;scope;constructor(e){this.options={minimumLevel:ge.TRACE,...e},this.scope=void 0===this.options.scope||""===this.options.scope.trim()?"":this.options.scope,"function"!=typeof this.options.level&&this.setLevel(this.options.level)}get level(){return void 0!==this._level?this._level:"function"==typeof this.options.level?this.options.level():this.options.level}createScope(e){return""===(e=e.trim())?this:new _e({...this.options,level:()=>this.level,scope:this.options.scope?`${this.options.scope}->${e}`:e})}debug(...e){return this.write({level:ge.DEBUG,data:e,scope:this.scope})}error(...e){return this.write({level:ge.ERROR,data:e,scope:this.scope})}info(...e){return this.write({level:ge.INFO,data:e,scope:this.scope})}setLevel(e){return void 0!==e&&e>this.options.minimumLevel?(this._level=ge.INFO,this.warn(`Log level cannot be set to ${ge[e]} whilst not in debug mode.`)):this._level=e,this}trace(...e){return this.write({level:ge.TRACE,data:e,scope:this.scope})}warn(...e){return this.write({level:ge.WARN,data:e,scope:this.scope})}write(e){return e.level<=this.level&&this.options.targets.forEach(t=>t.write(e)),this}}let we;function Se(){return void 0===we&&(we=process.execArgv.some(e=>{const t=e.split("=")[0];return"--inspect"===t||"--inspect-brk"===t||"--inspect-port"===t})),we}const Ie=[new class{options;filePath;size=0;constructor(e){this.options=e,this.filePath=this.getLogFilePath(),this.reIndex()}write(e){const t=p.openSync(this.filePath,"a");try{const n=this.options.format(e);p.writeSync(t,n+"\n"),this.size+=n.length}finally{p.closeSync(t)}this.size>=this.options.maxSize&&(this.reIndex(),this.size=0)}getLogFilePath(e=0){return u.join(this.options.dest,`${this.options.fileName}.${e}.log`)}getLogFiles(){const e=/^\.(\d+)\.log$/;return p.readdirSync(this.options.dest,{withFileTypes:!0}).reduce((t,n)=>{if(n.isDirectory()||n.name.indexOf(this.options.fileName)<0)return t;const i=n.name.substring(this.options.fileName.length).match(e);return 2!==i?.length||t.push({path:u.join(this.options.dest,n.name),index:parseInt(i[1])}),t},[]).sort(({index:e},{index:t})=>e<t?-1:e>t?1:0)}reIndex(){if(!p.existsSync(this.options.dest))return void p.mkdirSync(this.options.dest);const e=this.getLogFiles();for(let t=e.length-1;t>=0;t--){const n=e[t];t>=this.options.maxFileCount-1?p.rmSync(n.path):p.renameSync(n.path,this.getLogFilePath(t+1))}}}({dest:u.join(h(),"logs"),fileName:function(){const e=u.basename(process.cwd()),t=e.lastIndexOf(".sdPlugin");return t<0?e:e.substring(0,t)}(),format:e=>{const{data:t,level:n,scope:i}=e;let s=`${(new Date).toISOString()} ${ge[n].padEnd(5)} `;return i&&(s+=`${i}: `),`${s}${function(e){let t="",n=!1;for(const i of e)"object"==typeof i&&i instanceof Error?(t+=`${be}${i.stack}`,n=!0):(n&&(t+=be,n=!1),t+="object"==typeof i?JSON.stringify(i):i,t+=" ");return t.trimEnd()}(t)}`},maxFileCount:10,maxSize:52428800})];Se()&&Ie.splice(0,0,new ye);const ke=new _e({level:Se()?ge.DEBUG:ge.INFO,minimumLevel:Se()?ge.TRACE:ge.DEBUG,targets:Ie});process.once("uncaughtException",e=>ke.error("Process encountered uncaught exception",e));const xe=new class extends fe{_registrationParameters;_version;canConnect=!0;connection=new ve;logger=ke.createScope("Connection");get registrationParameters(){return this._registrationParameters??=this.getRegistrationParameters()}get version(){return this._version??=new me(this.registrationParameters.info.application.version)}async connect(){if(this.canConnect){this.canConnect=!1;const e=new te(`ws://127.0.0.1:${this.registrationParameters.port}`);e.onmessage=e=>this.tryEmit(e),e.onopen=()=>{e.send(JSON.stringify({event:this.registrationParameters.registerEvent,uuid:this.registrationParameters.pluginUUID})),this.connection.setResult(e),this.emit("connected",this.registrationParameters.info)}}await this.connection.promise}async send(e){const t=await this.connection.promise,n=JSON.stringify(e);this.logger.trace(n),t.send(n)}getRegistrationParameters(){const e={port:void 0,info:void 0,pluginUUID:void 0,registerEvent:void 0},t=ke.createScope("RegistrationParameters");for(let n=0;n<process.argv.length-1;n++){const i=process.argv[n],s=process.argv[++n];switch(i){case se.Port:t.debug(`port=${s}`),e.port=s;break;case se.PluginUUID:t.debug(`pluginUUID=${s}`),e.pluginUUID=s;break;case se.RegisterEvent:t.debug(`registerEvent=${s}`),e.registerEvent=s;break;case se.Info:t.debug(`info=${s}`),e.info=JSON.parse(s);break;default:n--}}const n=[],i=(e,t)=>{void 0===t&&n.push(e)};if(i(se.Port,e.port),i(se.PluginUUID,e.pluginUUID),i(se.RegisterEvent,e.registerEvent),i(se.Info,e.info),n.length>0)throw new Error(`Unable to establish a connection with Stream Deck, missing command line arguments: ${n.join(", ")}`);return e}tryEmit(e){try{const t=JSON.parse(e.data.toString());t.event?(this.logger.trace(e.data.toString()),this.emit(t.event,t)):this.logger.warn(`Received unknown message: ${e.data}`)}catch(t){this.logger.error(`Failed to parse message: ${e.data}`,t)}}},Ee=new pe(()=>{const e=d(process.cwd(),"manifest.json");if(!f(e))throw new Error("Failed to read manifest.json as the file does not exist.");try{return JSON.parse(v(e,{encoding:"utf-8",flag:"r"}).toString())}catch(e){if(e instanceof SyntaxError)return null;throw e}}),De=new pe(()=>null===Ee.value?null:new me(Ee.value.Software.MinimumVersion));function Ce(){return De.value}class Oe{#n;#i;#s;constructor(e){e instanceof Oe?(this.#n=e.#n,this.#i=e.#i):Array.isArray(e)?(this.#n=()=>e.values(),this.#i=()=>e.length):e instanceof Map||e instanceof Set?(this.#n=()=>e.values(),this.#i=()=>e.size):(this.#n=e,this.#i=()=>{let e=0;for(const t of this)e++;return e})}get length(){return this.#i()}*[Symbol.iterator](){for(const e of this.#n())yield e}asIndexedPairs(){return new Oe(function*(){let e=0;for(const t of this)yield[e++,t]}.bind(this))}drop(e){if(isNaN(e)||e<0)throw new RangeError("limit must be 0, or a positive number");return new Oe(function*(){let t=0;for(const n of this)t++>=e&&(yield n)}.bind(this))}every(e){for(const t of this)if(!e(t))return!1;return!0}filter(e){return new Oe(function*(){for(const t of this)e(t)&&(yield t)}.bind(this))}find(e){for(const t of this)if(e(t))return t}findLast(e){let t;for(const n of this)e(n)&&(t=n);return t}flatMap(e){return new Oe(function*(){for(const t of this)for(const n of e(t))yield n}.bind(this))}forEach(e){for(const t of this)e(t)}includes(e){return this.some(t=>t===e)}map(e){return new Oe(function*(){for(const t of this)yield e(t)}.bind(this))}next(...e){this.#s??=this.#n();const t=this.#s.next(...e);return t.done&&(this.#s=void 0),t}reduce(e,t){if(0===this.length){if(void 0===t)throw new TypeError("Reduce of empty enumerable with no initial value.");return t}let n=t;for(const t of this)n=void 0===n?t:e(n,t);return n}return(e){return this.#s=void 0,{done:!0,value:e}}some(e){for(const t of this)if(e(t))return!0;return!1}take(e){if(isNaN(e)||e<0)throw new RangeError("limit must be 0, or a positive number");return new Oe(function*(){let t=0;for(const n of this)t++<e&&(yield n)}.bind(this))}throw(e){throw e}toArray(){return Array.from(this)}toJSON(){return this.toArray()}toString(){return`${this.toArray()}`}}const Me=new Map;class Pe extends Oe{constructor(){super(Me)}getActionById(e){return Me.get(e)}}const Ae=new class extends Pe{delete(e){Me.delete(e)}set(e){Me.set(e.id,e)}};class Te extends le{application;constructor(e){super(e),this.application=e.payload.application}}class ze extends le{device;constructor(e,t){super(e),this.device=t}}class Le extends le{url;constructor(e){super(e),this.url=new Ne(e.payload.url)}}const $e="streamdeck://";class Ne{fragment;href;path;query;queryParameters;constructor(e){const t=new URL(`${$e}${e}`);this.fragment=t.hash.substring(1),this.href=t.href.substring(13),this.path=Ne.parsePath(this.href),this.query=t.search.substring(1),this.queryParameters=t.searchParams}static parsePath(e){const t=t=>{const n=e.indexOf(t);return n>=0?n:e.length};return e.substring(0,Math.min(t("?"),t("#")))}}class je extends le{action;payload;constructor(e,t){super(t),this.action=e,this.payload=t.payload}}function Re(e){return xe.disposableOn("didReceiveSettings",t=>{const n=Ae.getActionById(t.context);n&&e(new de(n,t))})}var Ue=Object.freeze({__proto__:null,getGlobalSettings:function(){return new Promise(e=>{xe.once("didReceiveGlobalSettings",t=>e(t.payload.settings)),xe.send({event:"getGlobalSettings",context:xe.registrationParameters.pluginUUID})})},onDidReceiveGlobalSettings:function(e){return xe.disposableOn("didReceiveGlobalSettings",t=>e(new he(t)))},onDidReceiveSettings:Re,setGlobalSettings:function(e){return xe.send({event:"setGlobalSettings",context:xe.registrationParameters.pluginUUID,payload:e})}});const Be=new class{#o;#r=0;constructor(){this.onDidAppear(e=>{this.#a(e.action)?this.#r++:(this.#r=1,this.#o=e.action)}),this.onDidDisappear(e=>{this.#a(e.action)&&(this.#r--,this.#r<=0&&(this.#o=void 0))})}get action(){return this.#o}onDidAppear(e){return xe.disposableOn("propertyInspectorDidAppear",t=>{const n=Ae.getActionById(t.context);n&&e(new ue(n,t))})}onDidDisappear(e){return xe.disposableOn("propertyInspectorDidDisappear",t=>{const n=Ae.getActionById(t.context);n&&e(new ue(n,t))})}onSendToPlugin(e){return xe.disposableOn("sendToPlugin",t=>{const n=Ae.getActionById(t.context);n&&e(new je(n,t))})}async sendToPropertyInspector(e){this.#o&&await xe.send({event:"sendToPropertyInspector",context:this.#o.id,payload:e})}#a(e){return this.#o?.id===e.id&&this.#o?.manifestId===e.manifestId&&this.#o?.device?.id===e.device.id}},Fe=new Map;class Ve extends Oe{constructor(){super(Fe)}getDeviceById(e){return Fe.get(e)}}const We=new class extends Ve{set(e){Fe.set(e.id,e)}};class Ge{#c;#l;constructor(e){this.#l=e;const t=We.getDeviceById(e.device);if(!t)throw new Error(`Failed to initialize action; device ${e.device} not found`);this.#c=t}get controllerType(){return this.#l.payload.controller}get device(){return this.#c}get id(){return this.#l.context}get manifestId(){return this.#l.action}toJSON(){return{controllerType:this.controllerType,device:this.device,id:this.id,manifestId:this.manifestId}}}class Ze extends Ge{getSettings(){return new Promise(e=>{const t=n=>{n.context==this.id&&(e(n.payload.settings),xe.removeListener("didReceiveSettings",t))};xe.on("didReceiveSettings",t),xe.send({event:"getSettings",context:this.id})})}isDial(){return"Encoder"===this.controllerType}isKey(){return"Keypad"===this.controllerType}setSettings(e){return xe.send({event:"setSettings",context:this.id,payload:e})}showAlert(){return xe.send({event:"showAlert",context:this.id})}}class Ke extends Ze{#u;constructor(e){if(super(e),"Encoder"!==e.payload.controller)throw new Error("Unable to create DialAction; source event is not a Encoder");this.#u=Object.freeze(e.payload.coordinates)}get coordinates(){return this.#u}setFeedback(e){return xe.send({event:"setFeedback",context:this.id,payload:e})}setFeedbackLayout(e){return xe.send({event:"setFeedbackLayout",context:this.id,payload:{layout:e}})}setImage(e){return xe.send({event:"setImage",context:this.id,payload:{image:e}})}setTitle(e){return this.setFeedback({title:e})}setTriggerDescription(e){return xe.send({event:"setTriggerDescription",context:this.id,payload:e||{}})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates}}}class qe extends Ze{#u;#l;constructor(e){if(super(e),"Keypad"!==e.payload.controller)throw new Error("Unable to create KeyAction; source event is not a Keypad");this.#u=e.payload.isInMultiAction?void 0:Object.freeze(e.payload.coordinates),this.#l=e}get coordinates(){return this.#u}isInMultiAction(){return this.#l.payload.isInMultiAction}setImage(e,t){return xe.send({event:"setImage",context:this.id,payload:{image:e,...t}})}setState(e){return xe.send({event:"setState",context:this.id,payload:{state:e}})}setTitle(e,t){return xe.send({event:"setTitle",context:this.id,payload:{title:e,...t}})}showOk(){return xe.send({event:"showOk",context:this.id})}toJSON(){return{...super.toJSON(),coordinates:this.coordinates,isInMultiAction:this.isInMultiAction()}}}const He=new pe(()=>Ee.value);const Xe=new class extends Pe{constructor(){super(),xe.prependListener("willAppear",e=>{const t="Encoder"===e.payload.controller?new Ke(e):new qe(e);Ae.set(t)}),xe.prependListener("willDisappear",e=>Ae.delete(e.context))}onDialDown(e){return xe.disposableOn("dialDown",t=>{const n=Ae.getActionById(t.context);n?.isDial()&&e(new de(n,t))})}onDialRotate(e){return xe.disposableOn("dialRotate",t=>{const n=Ae.getActionById(t.context);n?.isDial()&&e(new de(n,t))})}onDialUp(e){return xe.disposableOn("dialUp",t=>{const n=Ae.getActionById(t.context);n?.isDial()&&e(new de(n,t))})}onKeyDown(e){return xe.disposableOn("keyDown",t=>{const n=Ae.getActionById(t.context);n?.isKey()&&e(new de(n,t))})}onKeyUp(e){return xe.disposableOn("keyUp",t=>{const n=Ae.getActionById(t.context);n?.isKey()&&e(new de(n,t))})}onTitleParametersDidChange(e){return xe.disposableOn("titleParametersDidChange",t=>{const n=Ae.getActionById(t.context);n&&e(new de(n,t))})}onTouchTap(e){return xe.disposableOn("touchTap",t=>{const n=Ae.getActionById(t.context);n?.isDial()&&e(new de(n,t))})}onWillAppear(e){return xe.disposableOn("willAppear",t=>{const n=Ae.getActionById(t.context);n&&e(new de(n,t))})}onWillDisappear(e){return xe.disposableOn("willDisappear",t=>e(new de(new Ge(t),t)))}registerAction(e){if(void 0===e.manifestId)throw new Error("The action's manifestId cannot be undefined.");if(null!==He.value&&!He.value.Actions.some(t=>t.UUID===e.manifestId))throw new Error(`The action's manifestId was not found within the manifest: ${e.manifestId}`);const{manifestId:t}=e,n=(n,i)=>{const s=i?.bind(e);void 0!==s&&n.bind(e)(async e=>{e.action.manifestId==t&&await s(e)})};n(this.onDialDown,e.onDialDown),n(this.onDialUp,e.onDialUp),n(this.onDialRotate,e.onDialRotate),n(Be.onSendToPlugin,e.onSendToPlugin),n(Re,e.onDidReceiveSettings),n(this.onKeyDown,e.onKeyDown),n(this.onKeyUp,e.onKeyUp),n(Be.onDidAppear,e.onPropertyInspectorDidAppear),n(Be.onDidDisappear,e.onPropertyInspectorDidDisappear),n(this.onTitleParametersDidChange,e.onTitleParametersDidChange),n(this.onTouchTap,e.onTouchTap),n(this.onWillAppear,e.onWillAppear),n(this.onWillDisappear,e.onWillDisappear)}};function Je(e,t){const n=Ee.value?.SDKVersion??null;if(null!==n&&e>n)throw new Error(`[ERR_NOT_SUPPORTED]: ${t} requires manifest SDK version ${e} or higher, but found version ${n}; please update the "SDKVersion" in the plugin's manifest to ${e} or higher.`)}function Ye(e,t,n){const i={major:Math.floor(e),minor:Number(e.toString().split(".").at(1)??0),patch:0,build:0};if(-1===t.compareTo(i))throw new Error(`[ERR_NOT_SUPPORTED]: ${n} requires Stream Deck version ${i.major}.${i.minor} or higher, but current version is ${t.major}.${t.minor}; please update Stream Deck and the "Software.MinimumVersion" in the plugin's manifest to "${i.major}.${i.minor}" or higher.`);const s=Ce();if(null!==s&&-1===s.compareTo(i))throw new Error(`[ERR_NOT_SUPPORTED]: ${n} requires Stream Deck version ${i.major}.${i.minor} or higher; please update the "Software.MinimumVersion" in the plugin's manifest to "${i.major}.${i.minor}" or higher.`)}class Qe{#d=!1;#h;id;constructor(e,t,n){this.id=e,this.#h=t,this.#d=n,xe.prependListener("deviceDidConnect",e=>{e.device===this.id&&(this.#h=e.deviceInfo,this.#d=!0)}),xe.prependListener("deviceDidChange",e=>{e.device===this.id&&(this.#h=e.deviceInfo)}),xe.prependListener("deviceDidDisconnect",e=>{e.device===this.id&&(this.#d=!1)})}get actions(){return Ae.filter(e=>e.device.id===this.id)}get isConnected(){return this.#d}get name(){return this.#h.name}get size(){return this.#h.size}get type(){return this.#h.type}}const et=new class extends Ve{constructor(){super(),xe.once("connected",e=>{e.devices.forEach(e=>We.set(new Qe(e.id,e,!1)))}),xe.on("deviceDidConnect",({device:e,deviceInfo:t})=>{We.getDeviceById(e)||We.set(new Qe(e,t,!0))}),xe.on("deviceDidChange",({device:e,deviceInfo:t})=>{We.getDeviceById(e)||We.set(new Qe(e,t,!1))})}onDeviceDidChange(e){return Ye(7,xe.version,"onDeviceDidChange"),xe.disposableOn("deviceDidChange",t=>e(new ze(t,this.getDeviceById(t.device))))}onDeviceDidConnect(e){return xe.disposableOn("deviceDidConnect",t=>e(new ze(t,this.getDeviceById(t.device))))}onDeviceDidDisconnect(e){return xe.disposableOn("deviceDidDisconnect",t=>e(new ze(t,this.getDeviceById(t.device))))}};function tt(e){const t=u.join(process.cwd(),`${e}.json`);if(!p.existsSync(t))return null;try{const e=p.readFileSync(t,{flag:"r"})?.toString();return function(e){const t=JSON.parse(e);if(null!=t&&"object"==typeof t&&"Localization"in t)return t.Localization;throw new TypeError('Translations must be a JSON object nested under a property named "Localization"')}(e)}catch(e){return ke.error(`Failed to load translations from ${t}`,e),null}}var nt=Object.freeze({__proto__:null,switchToProfile:function(e,t,n){return void 0!==n&&Ye(6.5,xe.version,"Switching to a profile page"),xe.send({event:"switchToProfile",context:xe.registrationParameters.pluginUUID,device:e,payload:{page:n,profile:t}})}});var it=Object.freeze({__proto__:null,getSecrets:function(){return Ye(6.9,xe.version,"Secrets"),Je(3,"Secrets"),new Promise(e=>{xe.once("didReceiveSecrets",t=>e(t.payload.secrets)),xe.send({event:"getSecrets",context:xe.registrationParameters.pluginUUID})})},onApplicationDidLaunch:function(e){return xe.disposableOn("applicationDidLaunch",t=>e(new Te(t)))},onApplicationDidTerminate:function(e){return xe.disposableOn("applicationDidTerminate",t=>e(new Te(t)))},onDidReceiveDeepLink:function(e){return Ye(6.5,xe.version,"Receiving deep-link messages"),xe.disposableOn("didReceiveDeepLink",t=>e(new Le(t)))},onSystemDidWakeUp:function(e){return xe.disposableOn("systemDidWakeUp",t=>e(new le(t)))},openUrl:function(e){return xe.send({event:"openUrl",payload:{url:e}})}});function st(e){const t=e.UUID;return function(e,n){return class extends e{manifestId=t}}}class ot{manifestId;get actions(){return Ae.filter(e=>e.manifestId===this.manifestId)}}let rt;const at={get actions(){return Xe},get devices(){return et},get i18n(){return rt??=new ce(this.info.application.language,tt)},get info(){return xe.registrationParameters.info},get logger(){return ke},get profiles(){return nt},get settings(){return Ue},get system(){return it},get ui(){return Be},connect:()=>xe.connect()};function ct(e,t,n,i,s,o){function r(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,c=i.kind,l="getter"===c?"get":"setter"===c?"set":"value",u=!t&&e?i.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,i.name):{}),h=!1,p=n.length-1;p>=0;p--){var f={};for(var v in i)f[v]="access"===v?{}:i[v];for(var v in i.access)f.access[v]=i.access[v];f.addInitializer=function(e){if(h)throw new TypeError("Cannot add initializers after decoration has completed");o.push(r(e||null))};var m=(0,n[p])("accessor"===c?{get:d.get,set:d.set}:d[l],f);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(a=r(m.get))&&(d.get=a),(a=r(m.set))&&(d.set=a),(a=r(m.init))&&s.unshift(a)}else(a=r(m))&&("field"===c?s.unshift(a):d[l]=a)}u&&Object.defineProperty(u,i.name,d),h=!0}function lt(e,t,n){for(var i=arguments.length>2,s=0;s<t.length;s++)n=i?t[s].call(e,n):t[s].call(e);return i?n:void 0}function ut(e,t,n){function i(n,i){var s;Object.defineProperty(n,"_zod",{value:n._zod??{},enumerable:!1}),(s=n._zod).traits??(s.traits=new Set),n._zod.traits.add(e),t(n,i);for(const e in r.prototype)e in n||Object.defineProperty(n,e,{value:r.prototype[e].bind(n)});n._zod.constr=r,n._zod.def=i}const s=n?.Parent??Object;class o extends s{}function r(e){var t;const s=n?.Parent?new o:this;i(s,e),(t=s._zod).deferred??(t.deferred=[]);for(const e of s._zod.deferred)e();return s}return Object.defineProperty(o,"name",{value:e}),Object.defineProperty(r,"init",{value:i}),Object.defineProperty(r,Symbol.hasInstance,{value:t=>!!(n?.Parent&&t instanceof n.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(r,"name",{value:e}),r}"function"==typeof SuppressedError&&SuppressedError;let dt=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}};const ht={};function pt(e){return ht}function ft(e,t){return"bigint"==typeof t?t.toString():t}function vt(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function mt(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function gt(e,t,n){Object.defineProperty(e,t,{get(){{const i=n();return e[t]=i,i}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function yt(e,t,n){Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0})}function bt(e){return JSON.stringify(e)}const _t=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function wt(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const St=vt(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(e){return!1}});function It(e,t=0){for(let n=t;n<e.issues.length;n++)if(!0!==e.issues[n]?.continue)return!0;return!1}function kt(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}function xt(e){return"string"==typeof e?e:e?.message}function Et(e,t,n){const i={...e,path:e.path??[]};if(!e.message){const s=xt(e.inst?._zod.def?.error?.(e))??xt(t?.error?.(e))??xt(n.customError?.(e))??xt(n.localeError?.(e))??"Invalid input";i.message=s}return delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}const Dt=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,ft,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Ct=ut("$ZodError",Dt),Ot=ut("$ZodError",Dt,{Parent:Error}),Mt=(e=>(t,n,i,s)=>{const o=i?Object.assign(i,{async:!1}):{async:!1},r=t._zod.run({value:n,issues:[]},o);if(r instanceof Promise)throw new dt;if(r.issues.length){const t=new(s?.Err??e)(r.issues.map(e=>Et(e,o,pt())));throw _t(t,s?.callee),t}return r.value})(Ot),Pt=(e=>async(t,n,i,s)=>{const o=i?Object.assign(i,{async:!0}):{async:!0};let r=t._zod.run({value:n,issues:[]},o);if(r instanceof Promise&&(r=await r),r.issues.length){const t=new(s?.Err??e)(r.issues.map(e=>Et(e,o,pt())));throw _t(t,s?.callee),t}return r.value})(Ot),At=(e=>(t,n,i)=>{const s=i?{...i,async:!1}:{async:!1},o=t._zod.run({value:n,issues:[]},s);if(o instanceof Promise)throw new dt;return o.issues.length?{success:!1,error:new(e??Ct)(o.issues.map(e=>Et(e,s,pt())))}:{success:!0,data:o.value}})(Ot),Tt=(e=>async(t,n,i)=>{const s=i?Object.assign(i,{async:!0}):{async:!0};let o=t._zod.run({value:n,issues:[]},s);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(e=>Et(e,s,pt())))}:{success:!0,data:o.value}})(Ot),zt=/^-?\d+(?:\.\d+)?/i;let Lt=class{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),n=Math.min(...t.map(e=>e.length-e.trimStart().length)),i=t.map(e=>e.slice(n)).map(e=>" ".repeat(2*this.indent)+e);for(const e of i)this.content.push(e)}compile(){const e=Function,t=this?.args;return new e(...t,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}};const $t={major:4,minor:0,patch:0},Nt=ut("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=$t;const i=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&i.unshift(e);for(const t of i)for(const n of t._zod.onattach)n(e);if(0===i.length)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,n)=>{let i,s=It(e);for(const o of t){if(o._zod.def.when){if(!o._zod.def.when(e))continue}else if(s)continue;const t=e.issues.length,r=o._zod.check(e);if(r instanceof Promise&&!1===n?.async)throw new dt;if(i||r instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await r;e.issues.length!==t&&(s||(s=It(e,t)))});else{if(e.issues.length===t)continue;s||(s=It(e,t))}}return i?i.then(()=>e):e};e._zod.run=(n,s)=>{const o=e._zod.parse(n,s);if(o instanceof Promise){if(!1===s.async)throw new dt;return o.then(e=>t(e,i,s))}return t(o,i,s)}}e["~standard"]={validate:t=>{try{const n=At(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch(n){return Tt(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),jt=ut("$ZodString",(e,t)=>{var n;Nt.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??(n=e._zod.bag,new RegExp(`^${n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*"}$`)),e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=String(n.value)}catch(i){}return"string"==typeof n.value||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),Rt=ut("$ZodNumber",(e,t)=>{Nt.init(e,t),e._zod.pattern=e._zod.bag.pattern??zt,e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=Number(n.value)}catch(e){}const s=n.value;if("number"==typeof s&&!Number.isNaN(s)&&Number.isFinite(s))return n;const o="number"==typeof s?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...o?{received:o}:{}}),n}}),Ut=ut("$ZodAny",(e,t)=>{Nt.init(e,t),e._zod.parse=e=>e}),Bt=ut("$ZodNever",(e,t)=>{Nt.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function Ft(e,t,n){e.issues.length&&t.issues.push(...kt(n,e.issues)),t.value[n]=e.value}const Vt=ut("$ZodArray",(e,t)=>{Nt.init(e,t),e._zod.parse=(n,i)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),n;n.value=Array(s.length);const o=[];for(let e=0;e<s.length;e++){const r=s[e],a=t.element._zod.run({value:r,issues:[]},i);a instanceof Promise?o.push(a.then(t=>Ft(t,n,e))):Ft(a,n,e)}return o.length?Promise.all(o).then(()=>n):n}});function Wt(e,t,n){e.issues.length&&t.issues.push(...kt(n,e.issues)),t.value[n]=e.value}function Gt(e,t,n,i){e.issues.length?void 0===i[n]?t.value[n]=n in i?void 0:e.value:t.issues.push(...kt(n,e.issues)):void 0===e.value?n in i&&(t.value[n]=void 0):t.value[n]=e.value}const Zt=ut("$ZodObject",(e,t)=>{Nt.init(e,t);const n=vt(()=>{const e=Object.keys(t.shape);for(const n of e)if(!(t.shape[n]instanceof Nt))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const n=(i=t.shape,Object.keys(i).filter(e=>"optional"===i[e]._zod.optin&&"optional"===i[e]._zod.optout));var i;return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}});gt(e._zod,"propValues",()=>{const e=t.shape,n={};for(const t in e){const i=e[t]._zod;if(i.values){n[t]??(n[t]=new Set);for(const e of i.values)n[t].add(e)}}return n});let i;const s=wt,o=!ht.jitless,r=o&&St.value,a=t.catchall;let c;e._zod.parse=(l,u)=>{c??(c=n.value);const d=l.value;if(!s(d))return l.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),l;const h=[];if(o&&r&&!1===u?.async&&!0!==u.jitless)i||(i=(e=>{const t=new Lt(["shape","payload","ctx"]),i=n.value,s=e=>{const t=bt(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const o=Object.create(null);let r=0;for(const e of i.keys)o[e]="key_"+r++;t.write("const newResult = {}");for(const e of i.keys)if(i.optionalKeys.has(e)){const n=o[e];t.write(`const ${n} = ${s(e)};`);const i=bt(e);t.write(`\n        if (${n}.issues.length) {\n          if (input[${i}] === undefined) {\n            if (${i} in input) {\n              newResult[${i}] = undefined;\n            }\n          } else {\n            payload.issues = payload.issues.concat(\n              ${n}.issues.map((iss) => ({\n                ...iss,\n                path: iss.path ? [${i}, ...iss.path] : [${i}],\n              }))\n            );\n          }\n        } else if (${n}.value === undefined) {\n          if (${i} in input) newResult[${i}] = undefined;\n        } else {\n          newResult[${i}] = ${n}.value;\n        }\n        `)}else{const n=o[e];t.write(`const ${n} = ${s(e)};`),t.write(`\n          if (${n}.issues.length) payload.issues = payload.issues.concat(${n}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${bt(e)}, ...iss.path] : [${bt(e)}]\n          })));`),t.write(`newResult[${bt(e)}] = ${n}.value`)}t.write("payload.value = newResult;"),t.write("return payload;");const a=t.compile();return(t,n)=>a(e,t,n)})(t.shape)),l=i(l,u);else{l.value={};const e=c.shape;for(const t of c.keys){const n=e[t],i=n._zod.run({value:d[t],issues:[]},u),s="optional"===n._zod.optin&&"optional"===n._zod.optout;i instanceof Promise?h.push(i.then(e=>s?Gt(e,l,t,d):Wt(e,l,t))):s?Gt(i,l,t,d):Wt(i,l,t)}}if(!a)return h.length?Promise.all(h).then(()=>l):l;const p=[],f=c.keySet,v=a._zod,m=v.def.type;for(const e of Object.keys(d)){if(f.has(e))continue;if("never"===m){p.push(e);continue}const t=v.run({value:d[e],issues:[]},u);t instanceof Promise?h.push(t.then(t=>Wt(t,l,e))):Wt(t,l,e)}return p.length&&l.issues.push({code:"unrecognized_keys",keys:p,input:d,inst:e}),h.length?Promise.all(h).then(()=>l):l}});function Kt(e,t,n,i){for(const n of e)if(0===n.issues.length)return t.value=n.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(e=>e.issues.map(e=>Et(e,i,pt())))}),t}const qt=ut("$ZodUnion",(e,t)=>{Nt.init(e,t),gt(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),gt(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),gt(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),gt(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>mt(e.source)).join("|")})$`)}}),e._zod.parse=(n,i)=>{let s=!1;const o=[];for(const e of t.options){const t=e._zod.run({value:n.value,issues:[]},i);if(t instanceof Promise)o.push(t),s=!0;else{if(0===t.issues.length)return t;o.push(t)}}return s?Promise.all(o).then(t=>Kt(t,n,e,i)):Kt(o,n,e,i)}}),Ht=ut("$ZodRecord",(e,t)=>{Nt.init(e,t),e._zod.parse=(n,i)=>{const s=n.value;if(!function(e){if(!1===wt(e))return!1;const t=e.constructor;if(void 0===t)return!0;const n=t.prototype;return!1!==wt(n)&&!1!==Object.prototype.hasOwnProperty.call(n,"isPrototypeOf")}(s))return n.issues.push({expected:"record",code:"invalid_type",input:s,inst:e}),n;const o=[];if(t.keyType._zod.values){const r=t.keyType._zod.values;n.value={};for(const e of r)if("string"==typeof e||"number"==typeof e||"symbol"==typeof e){const r=t.valueType._zod.run({value:s[e],issues:[]},i);r instanceof Promise?o.push(r.then(t=>{t.issues.length&&n.issues.push(...kt(e,t.issues)),n.value[e]=t.value})):(r.issues.length&&n.issues.push(...kt(e,r.issues)),n.value[e]=r.value)}let a;for(const e in s)r.has(e)||(a=a??[],a.push(e));a&&a.length>0&&n.issues.push({code:"unrecognized_keys",input:s,inst:e,keys:a})}else{n.value={};for(const r of Reflect.ownKeys(s)){if("__proto__"===r)continue;const a=t.keyType._zod.run({value:r,issues:[]},i);if(a instanceof Promise)throw new Error("Async schemas not supported in object keys currently");if(a.issues.length){n.issues.push({origin:"record",code:"invalid_key",issues:a.issues.map(e=>Et(e,i,pt())),input:r,path:[r],inst:e}),n.value[a.value]=a.value;continue}const c=t.valueType._zod.run({value:s[r],issues:[]},i);c instanceof Promise?o.push(c.then(e=>{e.issues.length&&n.issues.push(...kt(r,e.issues)),n.value[a.value]=e.value})):(c.issues.length&&n.issues.push(...kt(r,c.issues)),n.value[a.value]=c.value)}}return o.length?Promise.all(o).then(()=>n):n}}),Xt=ut("$ZodLiteral",(e,t)=>{Nt.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(e=>"string"==typeof e?e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):e?e.toString():String(e)).join("|")})$`),e._zod.parse=(n,i)=>{const s=n.value;return e._zod.values.has(s)||n.issues.push({code:"invalid_value",values:t.values,input:s,inst:e}),n}}),Jt=ut("$ZodOptional",(e,t)=>{Nt.init(e,t),e._zod.optin="optional",e._zod.optout="optional",gt(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),gt(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${mt(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>"optional"===t.innerType._zod.optin?t.innerType._zod.run(e,n):void 0===e.value?e:t.innerType._zod.run(e,n)});const Yt=ut("ZodMiniType",(e,t)=>{if(!e._zod)throw new Error("Uninitialized schema in ZodMiniType.");Nt.init(e,t),e.def=t,e.parse=(t,n)=>Mt(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>At(e,t,n),e.parseAsync=async(t,n)=>Pt(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>Tt(e,t,n),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,n)=>function(e,t,n){const i=new e._zod.constr(t??e._zod.def);return t&&!n?.parent||(i._zod.parent=e),i}(e,t,n),e.brand=()=>e,e.register=(t,n)=>(t.add(e,n),e)}),Qt=ut("ZodMiniString",(e,t)=>{jt.init(e,t),Yt.init(e,t)});function en(e){return new Qt({type:"string"})}const tn=ut("ZodMiniNumber",(e,t)=>{Rt.init(e,t),Yt.init(e,t)});const nn=ut("ZodMiniAny",(e,t)=>{Ut.init(e,t),Yt.init(e,t)});function sn(){return new nn({type:"any"})}const on=ut("ZodMiniNever",(e,t)=>{Bt.init(e,t),Yt.init(e,t)});const rn=ut("ZodMiniArray",(e,t)=>{Vt.init(e,t),Yt.init(e,t)});const an=ut("ZodMiniObject",(e,t)=>{Zt.init(e,t),Yt.init(e,t),gt(e,"shape",()=>t.shape)});function cn(e,t){return new an({type:"object",get shape(){return yt(this,"shape",{...e}),this.shape}})}function ln(e,t){return new an({type:"object",get shape(){return yt(this,"shape",{...e}),this.shape},catchall:new on({type:"never"})})}const un=ut("ZodMiniUnion",(e,t)=>{qt.init(e,t),Yt.init(e,t)});function dn(e,t){return new un({type:"union",options:e})}const hn=ut("ZodMiniRecord",(e,t)=>{Ht.init(e,t),Yt.init(e,t)});const pn=ut("ZodMiniLiteral",(e,t)=>{Xt.init(e,t),Yt.init(e,t)});function fn(e,t){return new pn({type:"literal",values:Array.isArray(e)?e:[e]})}const vn=ut("ZodMiniOptional",(e,t)=>{Jt.init(e,t),Yt.init(e,t)});function mn(e){return new vn({type:"optional",innerType:e})}const gn=cn({code:new tn({type:"number",checks:[]}),message:en(),data:sn()}),yn=-32601,bn=-32603,_n=cn({jsonrpc:fn("2.0"),method:en(),params:mn(dn([(Sn=en(),In=sn(),new hn({type:"record",keyType:Sn,valueType:In})),(wn=sn(),new rn({type:"array",element:wn}))])),id:mn(en())});var wn,Sn,In;const kn=dn([ln({jsonrpc:fn("2.0"),result:sn(),id:en()}),ln({jsonrpc:fn("2.0"),error:gn,id:mn(en())})]);class xn{#p;#f=!1;#v;constructor(e,t){this.#v=e,this.#p=t}get canRespond(){return!this.#f&&void 0!==this.#p}error(e){return this.#m({jsonrpc:"2.0",id:this.#p,error:e})}async success(e){this.#p&&await this.#m({jsonrpc:"2.0",id:this.#p,result:e})}async#m(e){this.#f||(await this.#v(e),this.#f=!0)}}var En;let Dn=class{static#g=3e4;#y;#v;#b=new Map;constructor(e,t){this.#v=e,this.#y={error:()=>{},...t}}async notify(e,t){"string"==typeof e?await this.#v({jsonrpc:"2.0",method:e,params:t}):await this.#v({jsonrpc:"2.0",method:e.method,params:e.params})}async receive(e){const{success:t,data:n}=kn.safeParse(e);if(!t)return!1;if("result"in n)this.#_(n.id,{ok:!0,result:n.result});else{const e={ok:!1,error:n.error};void 0===n.id?this.#y.error(e):this.#_(n.id,e)}return!0}async request(e,t){return"string"==typeof e?this.#w({method:e,params:t}):this.#w(e)}#_(e,t){const n=this.#b.get(e);this.#b.delete(e),n&&n(t)}async#w(e){const t=crypto.randomUUID(),{method:n,params:i,timeout:s=En.#g}=e,o=new Promise(e=>{this.#b.set(t,t=>{clearTimeout(r),e(t)})}),r=setTimeout(()=>{this.#_(t,{ok:!1,error:{code:bn,message:"The request timed out."}})},s);return await this.#v({jsonrpc:"2.0",method:n,params:i,id:t}),o}};En=Dn;class Cn{events=new Map;addListener(e,t){return this.add(e,t,e=>e.push({listener:t}))}disposableOn(e,t){return this.add(e,t,e=>e.push({listener:t})),function(e){let t=!1;const n=()=>{t||(e(),t=!0)};return{[Symbol.dispose]:n,dispose:n}}(()=>this.removeListener(e,t))}emit(e,...t){const n=this.events.get(e);if(void 0===n)return!1;for(let i=0;i<n.length;){const{listener:s,once:o}=n[i];o?this.remove(e,n,i):i++,s(...t)}return!0}eventNames(){return Array.from(this.events.keys())}listenerCount(e,t){const n=this.events.get(e);if(void 0===n||null==t)return n?.length||0;let i=0;return n.forEach(e=>{e.listener===t&&i++}),i}listeners(e){return Array.from(this.events.get(e)||[]).map(({listener:e})=>e)}off(e,t){const n=this.events.get(e)??[];for(let i=n.length-1;i>=0;i--)n[i].listener===t&&this.remove(e,n,i);return this}on(e,t){return this.add(e,t,e=>e.push({listener:t}))}once(e,t){return this.add(e,t,e=>e.push({listener:t,once:!0}))}prependListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t}))}prependOnceListener(e,t){return this.add(e,t,e=>e.splice(0,0,{listener:t,once:!0}))}removeAllListeners(e){const t=this.events.get(e)??[];for(;t.length>0;)this.remove(e,t,0);return this.events.delete(e),this}removeListener(e,t){return this.off(e,t)}add(e,t,n){let i=this.events.get(e);if(void 0===i&&(i=[],this.events.set(e,i)),n(i),"newListener"!==e){const n=[e,t];this.emit("newListener",...n)}return this}remove(e,t,n){const[{listener:i}]=t.splice(n,1);if("removeListener"!==e){const t=[e,i];this.emit("removeListener",...t)}}}class On{#S=new Cn;#v;constructor(e){this.#v=e}addMethod(e,t){return this.#S.disposableOn(e,t)}async receive(e){const{success:t,data:n}=_n.safeParse(e);if(!t)return!1;const i=new xn(this.#v,n.id),s=this.#S.listeners(n.method);return 0===s.length?(await i.error({code:yn,message:"The method does not exist or is not available."}),!1):(await this.#I(s,n.params,i),!0)}async#I(e,t,n){const i=e=>()=>{const[s,...o]=e;return void 0===s?null:s(t,n,i(o))};try{const t=await i(e)();await n.success(t??null)}catch(e){throw await n.error({code:bn,message:e instanceof Error?e.message:e instanceof Object?e.toString():"Unknown error"}),e}}}function Mn(e,t,n){function i(n,i){var s;Object.defineProperty(n,"_zod",{value:n._zod??{},enumerable:!1}),(s=n._zod).traits??(s.traits=new Set),n._zod.traits.add(e),t(n,i);for(const e in r.prototype)e in n||Object.defineProperty(n,e,{value:r.prototype[e].bind(n)});n._zod.constr=r,n._zod.def=i}const s=n?.Parent??Object;class o extends s{}function r(e){var t;const s=n?.Parent?new o:this;i(s,e),(t=s._zod).deferred??(t.deferred=[]);for(const e of s._zod.deferred)e();return s}return Object.defineProperty(o,"name",{value:e}),Object.defineProperty(r,"init",{value:i}),Object.defineProperty(r,Symbol.hasInstance,{value:t=>!!(n?.Parent&&t instanceof n.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(r,"name",{value:e}),r}let Pn=class extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}};const An={};function Tn(e){return An}function zn(e,t){return"bigint"==typeof t?t.toString():t}function Ln(e){return{get value(){{const t=e();return Object.defineProperty(this,"value",{value:t}),t}}}}function $n(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}function Nn(e,t,n){Object.defineProperty(e,t,{get(){{const i=n();return e[t]=i,i}},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}function jn(e){return JSON.stringify(e)}const Rn=Error.captureStackTrace?Error.captureStackTrace:(...e)=>{};function Un(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const Bn=Ln(()=>{if("undefined"!=typeof navigator&&navigator?.userAgent?.includes("Cloudflare"))return!1;try{return new Function(""),!0}catch(e){return!1}});function Fn(e,t=0){for(let n=t;n<e.issues.length;n++)if(!0!==e.issues[n]?.continue)return!0;return!1}function Vn(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}function Wn(e){return"string"==typeof e?e:e?.message}function Gn(e,t,n){const i={...e,path:e.path??[]};if(!e.message){const s=Wn(e.inst?._zod.def?.error?.(e))??Wn(t?.error?.(e))??Wn(n.customError?.(e))??Wn(n.localeError?.(e))??"Invalid input";i.message=s}return delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}const Zn=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),Object.defineProperty(e,"message",{get:()=>JSON.stringify(t,zn,2),enumerable:!0}),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},Kn=Mn("$ZodError",Zn),qn=Mn("$ZodError",Zn,{Parent:Error}),Hn=(e=>(t,n,i,s)=>{const o=i?Object.assign(i,{async:!1}):{async:!1},r=t._zod.run({value:n,issues:[]},o);if(r instanceof Promise)throw new Pn;if(r.issues.length){const t=new(s?.Err??e)(r.issues.map(e=>Gn(e,o,Tn())));throw Rn(t,s?.callee),t}return r.value})(qn),Xn=(e=>async(t,n,i,s)=>{const o=i?Object.assign(i,{async:!0}):{async:!0};let r=t._zod.run({value:n,issues:[]},o);if(r instanceof Promise&&(r=await r),r.issues.length){const t=new(s?.Err??e)(r.issues.map(e=>Gn(e,o,Tn())));throw Rn(t,s?.callee),t}return r.value})(qn),Jn=(e=>(t,n,i)=>{const s=i?{...i,async:!1}:{async:!1},o=t._zod.run({value:n,issues:[]},s);if(o instanceof Promise)throw new Pn;return o.issues.length?{success:!1,error:new(e??Kn)(o.issues.map(e=>Gn(e,s,Tn())))}:{success:!0,data:o.value}})(qn),Yn=(e=>async(t,n,i)=>{const s=i?Object.assign(i,{async:!0}):{async:!0};let o=t._zod.run({value:n,issues:[]},s);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(e=>Gn(e,s,Tn())))}:{success:!0,data:o.value}})(qn),Qn=/^-?\d+(?:\.\d+)?/i,ei=/true|false/i;class ti{constructor(e=[]){this.content=[],this.indent=0,this&&(this.args=e)}indented(e){this.indent+=1,e(this),this.indent-=1}write(e){if("function"==typeof e)return e(this,{execution:"sync"}),void e(this,{execution:"async"});const t=e.split("\n").filter(e=>e),n=Math.min(...t.map(e=>e.length-e.trimStart().length)),i=t.map(e=>e.slice(n)).map(e=>" ".repeat(2*this.indent)+e);for(const e of i)this.content.push(e)}compile(){const e=Function,t=this?.args;return new e(...t,[...(this?.content??[""]).map(e=>`  ${e}`)].join("\n"))}}const ni={major:4,minor:0,patch:0},ii=Mn("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=ni;const i=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&i.unshift(e);for(const t of i)for(const n of t._zod.onattach)n(e);if(0===i.length)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,n)=>{let i,s=Fn(e);for(const o of t){if(o._zod.def.when){if(!o._zod.def.when(e))continue}else if(s)continue;const t=e.issues.length,r=o._zod.check(e);if(r instanceof Promise&&!1===n?.async)throw new Pn;if(i||r instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await r;e.issues.length!==t&&(s||(s=Fn(e,t)))});else{if(e.issues.length===t)continue;s||(s=Fn(e,t))}}return i?i.then(()=>e):e};e._zod.run=(n,s)=>{const o=e._zod.parse(n,s);if(o instanceof Promise){if(!1===s.async)throw new Pn;return o.then(e=>t(e,i,s))}return t(o,i,s)}}e["~standard"]={validate:t=>{try{const n=Jn(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch(n){return Yn(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),si=Mn("$ZodString",(e,t)=>{var n;ii.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??(n=e._zod.bag,new RegExp(`^${n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*"}$`)),e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=String(n.value)}catch(i){}return"string"==typeof n.value||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),oi=Mn("$ZodNumber",(e,t)=>{ii.init(e,t),e._zod.pattern=e._zod.bag.pattern??Qn,e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=Number(n.value)}catch(e){}const s=n.value;if("number"==typeof s&&!Number.isNaN(s)&&Number.isFinite(s))return n;const o="number"==typeof s?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...o?{received:o}:{}}),n}}),ri=Mn("$ZodBoolean",(e,t)=>{ii.init(e,t),e._zod.pattern=ei,e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=Boolean(n.value)}catch(e){}const s=n.value;return"boolean"==typeof s||n.issues.push({expected:"boolean",code:"invalid_type",input:s,inst:e}),n}}),ai=Mn("$ZodNever",(e,t)=>{ii.init(e,t),e._zod.parse=(t,n)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:e}),t)});function ci(e,t,n){e.issues.length&&t.issues.push(...Vn(n,e.issues)),t.value[n]=e.value}const li=Mn("$ZodArray",(e,t)=>{ii.init(e,t),e._zod.parse=(n,i)=>{const s=n.value;if(!Array.isArray(s))return n.issues.push({expected:"array",code:"invalid_type",input:s,inst:e}),n;n.value=Array(s.length);const o=[];for(let e=0;e<s.length;e++){const r=s[e],a=t.element._zod.run({value:r,issues:[]},i);a instanceof Promise?o.push(a.then(t=>ci(t,n,e))):ci(a,n,e)}return o.length?Promise.all(o).then(()=>n):n}});function ui(e,t,n){e.issues.length&&t.issues.push(...Vn(n,e.issues)),t.value[n]=e.value}function di(e,t,n,i){e.issues.length?void 0===i[n]?t.value[n]=n in i?void 0:e.value:t.issues.push(...Vn(n,e.issues)):void 0===e.value?n in i&&(t.value[n]=void 0):t.value[n]=e.value}const hi=Mn("$ZodObject",(e,t)=>{ii.init(e,t);const n=Ln(()=>{const e=Object.keys(t.shape);for(const n of e)if(!(t.shape[n]instanceof ii))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const n=(i=t.shape,Object.keys(i).filter(e=>"optional"===i[e]._zod.optin&&"optional"===i[e]._zod.optout));var i;return{shape:t.shape,keys:e,keySet:new Set(e),numKeys:e.length,optionalKeys:new Set(n)}});Nn(e._zod,"propValues",()=>{const e=t.shape,n={};for(const t in e){const i=e[t]._zod;if(i.values){n[t]??(n[t]=new Set);for(const e of i.values)n[t].add(e)}}return n});let i;const s=Un,o=!An.jitless,r=o&&Bn.value,a=t.catchall;let c;e._zod.parse=(l,u)=>{c??(c=n.value);const d=l.value;if(!s(d))return l.issues.push({expected:"object",code:"invalid_type",input:d,inst:e}),l;const h=[];if(o&&r&&!1===u?.async&&!0!==u.jitless)i||(i=(e=>{const t=new ti(["shape","payload","ctx"]),i=n.value,s=e=>{const t=jn(e);return`shape[${t}]._zod.run({ value: input[${t}], issues: [] }, ctx)`};t.write("const input = payload.value;");const o=Object.create(null);let r=0;for(const e of i.keys)o[e]="key_"+r++;t.write("const newResult = {}");for(const e of i.keys)if(i.optionalKeys.has(e)){const n=o[e];t.write(`const ${n} = ${s(e)};`);const i=jn(e);t.write(`\n        if (${n}.issues.length) {\n          if (input[${i}] === undefined) {\n            if (${i} in input) {\n              newResult[${i}] = undefined;\n            }\n          } else {\n            payload.issues = payload.issues.concat(\n              ${n}.issues.map((iss) => ({\n                ...iss,\n                path: iss.path ? [${i}, ...iss.path] : [${i}],\n              }))\n            );\n          }\n        } else if (${n}.value === undefined) {\n          if (${i} in input) newResult[${i}] = undefined;\n        } else {\n          newResult[${i}] = ${n}.value;\n        }\n        `)}else{const n=o[e];t.write(`const ${n} = ${s(e)};`),t.write(`\n          if (${n}.issues.length) payload.issues = payload.issues.concat(${n}.issues.map(iss => ({\n            ...iss,\n            path: iss.path ? [${jn(e)}, ...iss.path] : [${jn(e)}]\n          })));`),t.write(`newResult[${jn(e)}] = ${n}.value`)}t.write("payload.value = newResult;"),t.write("return payload;");const a=t.compile();return(t,n)=>a(e,t,n)})(t.shape)),l=i(l,u);else{l.value={};const e=c.shape;for(const t of c.keys){const n=e[t],i=n._zod.run({value:d[t],issues:[]},u),s="optional"===n._zod.optin&&"optional"===n._zod.optout;i instanceof Promise?h.push(i.then(e=>s?di(e,l,t,d):ui(e,l,t))):s?di(i,l,t,d):ui(i,l,t)}}if(!a)return h.length?Promise.all(h).then(()=>l):l;const p=[],f=c.keySet,v=a._zod,m=v.def.type;for(const e of Object.keys(d)){if(f.has(e))continue;if("never"===m){p.push(e);continue}const t=v.run({value:d[e],issues:[]},u);t instanceof Promise?h.push(t.then(t=>ui(t,l,e))):ui(t,l,e)}return p.length&&l.issues.push({code:"unrecognized_keys",keys:p,input:d,inst:e}),h.length?Promise.all(h).then(()=>l):l}});function pi(e,t,n,i){for(const n of e)if(0===n.issues.length)return t.value=n.value,t;return t.issues.push({code:"invalid_union",input:t.value,inst:n,errors:e.map(e=>e.issues.map(e=>Gn(e,i,Tn())))}),t}const fi=Mn("$ZodUnion",(e,t)=>{ii.init(e,t),Nn(e._zod,"optin",()=>t.options.some(e=>"optional"===e._zod.optin)?"optional":void 0),Nn(e._zod,"optout",()=>t.options.some(e=>"optional"===e._zod.optout)?"optional":void 0),Nn(e._zod,"values",()=>{if(t.options.every(e=>e._zod.values))return new Set(t.options.flatMap(e=>Array.from(e._zod.values)))}),Nn(e._zod,"pattern",()=>{if(t.options.every(e=>e._zod.pattern)){const e=t.options.map(e=>e._zod.pattern);return new RegExp(`^(${e.map(e=>$n(e.source)).join("|")})$`)}}),e._zod.parse=(n,i)=>{let s=!1;const o=[];for(const e of t.options){const t=e._zod.run({value:n.value,issues:[]},i);if(t instanceof Promise)o.push(t),s=!0;else{if(0===t.issues.length)return t;o.push(t)}}return s?Promise.all(o).then(t=>pi(t,n,e,i)):pi(o,n,e,i)}}),vi=Mn("$ZodLiteral",(e,t)=>{ii.init(e,t),e._zod.values=new Set(t.values),e._zod.pattern=new RegExp(`^(${t.values.map(e=>"string"==typeof e?e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):e?e.toString():String(e)).join("|")})$`),e._zod.parse=(n,i)=>{const s=n.value;return e._zod.values.has(s)||n.issues.push({code:"invalid_value",values:t.values,input:s,inst:e}),n}}),mi=Mn("$ZodTransform",(e,t)=>{ii.init(e,t),e._zod.parse=(e,n)=>{const i=t.transform(e.value,e);if(n.async){return(i instanceof Promise?i:Promise.resolve(i)).then(t=>(e.value=t,e))}if(i instanceof Promise)throw new Pn;return e.value=i,e}}),gi=Mn("$ZodOptional",(e,t)=>{ii.init(e,t),e._zod.optin="optional",e._zod.optout="optional",Nn(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),Nn(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${$n(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>"optional"===t.innerType._zod.optin?t.innerType._zod.run(e,n):void 0===e.value?e:t.innerType._zod.run(e,n)}),yi=Mn("$ZodPipe",(e,t)=>{ii.init(e,t),Nn(e._zod,"values",()=>t.in._zod.values),Nn(e._zod,"optin",()=>t.in._zod.optin),Nn(e._zod,"optout",()=>t.out._zod.optout),e._zod.parse=(e,n)=>{const i=t.in._zod.run(e,n);return i instanceof Promise?i.then(e=>bi(e,t,n)):bi(i,t,n)}});function bi(e,t,n){return Fn(e)?e:t.out._zod.run({value:e.value,issues:e.issues},n)}const _i=Mn("$ZodLazy",(e,t)=>{ii.init(e,t),Nn(e._zod,"innerType",()=>t.getter()),Nn(e._zod,"pattern",()=>e._zod.innerType._zod.pattern),Nn(e._zod,"propValues",()=>e._zod.innerType._zod.propValues),Nn(e._zod,"optin",()=>e._zod.innerType._zod.optin),Nn(e._zod,"optout",()=>e._zod.innerType._zod.optout),e._zod.parse=(t,n)=>e._zod.innerType._zod.run(t,n)});const wi=Mn("ZodMiniType",(e,t)=>{if(!e._zod)throw new Error("Uninitialized schema in ZodMiniType.");ii.init(e,t),e.def=t,e.parse=(t,n)=>Hn(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>Jn(e,t,n),e.parseAsync=async(t,n)=>Xn(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>Yn(e,t,n),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,n)=>function(e,t,n){const i=new e._zod.constr(t??e._zod.def);return t&&!n?.parent||(i._zod.parent=e),i}(e,t,n),e.brand=()=>e,e.register=(t,n)=>(t.add(e,n),e)}),Si=Mn("ZodMiniString",(e,t)=>{si.init(e,t),wi.init(e,t)});function Ii(e){return new Si({type:"string"})}const ki=Mn("ZodMiniNumber",(e,t)=>{oi.init(e,t),wi.init(e,t)});const xi=Mn("ZodMiniBoolean",(e,t)=>{ri.init(e,t),wi.init(e,t)});function Ei(e){return new xi({type:"boolean"})}const Di=Mn("ZodMiniNever",(e,t)=>{ai.init(e,t),wi.init(e,t)});const Ci=Mn("ZodMiniArray",(e,t)=>{li.init(e,t),wi.init(e,t)});const Oi=Mn("ZodMiniObject",(e,t)=>{hi.init(e,t),wi.init(e,t),Nn(e,"shape",()=>t.shape)});function Mi(e,t){return new Oi({type:"object",get shape(){var t,n,i;return t=this,n="shape",i={...e},Object.defineProperty(t,n,{value:i,writable:!0,enumerable:!0,configurable:!0}),this.shape},catchall:new Di({type:"never"})})}const Pi=Mn("ZodMiniUnion",(e,t)=>{fi.init(e,t),wi.init(e,t)});function Ai(e,t){return new Pi({type:"union",options:e})}const Ti=Mn("ZodMiniLiteral",(e,t)=>{vi.init(e,t),wi.init(e,t)});function zi(e,t){return new Ti({type:"literal",values:Array.isArray(e)?e:[e]})}const Li=Mn("ZodMiniTransform",(e,t)=>{mi.init(e,t),wi.init(e,t)});function $i(e){return new Li({type:"transform",transform:e})}const Ni=Mn("ZodMiniOptional",(e,t)=>{gi.init(e,t),wi.init(e,t)});function ji(e){return new Ni({type:"optional",innerType:e})}const Ri=Mn("ZodMiniPipe",(e,t)=>{yi.init(e,t),wi.init(e,t)});function Ui(e,t){return new Ri({type:"pipe",in:e,out:t})}const Bi=Mn("ZodMiniLazy",(e,t)=>{_i.init(e,t),wi.init(e,t)});const Fi="Option";class Vi{static{this.schema=Ui(Mi({__brand:zi(Fi),disabled:ji(Ei()),label:Ii(),selected:ji(Ei()),value:ji(Ai([Ei(),new ki({type:"number",checks:[]}),Ii()]))}),$i(e=>new Vi(e.label,e)))}constructor(e,t){this.disabled=!1,this.selected=!1,this.label=e,"object"==typeof t?(this.disabled=t.disabled??!1,this.selected=t.selected??!1,this.value=t.value??e):this.value=t??e}toJSON(){return{__brand:Fi,disabled:!!this.disabled||void 0,label:this.label,selected:!!this.selected||void 0,value:this.value!==this.label?this.value:void 0}}}const Wi="OptionGroup";class Gi{static{var e;this.schema=Ui(Mi({__brand:zi(Wi),disabled:ji(Ei()),label:Ii(),options:(e=()=>function(e){return new Ci({type:"array",element:e})}(Ai([Vi.schema,Gi.schema])),new Bi({type:"lazy",getter:e}))}),$i(e=>new Gi(e.label,e)))}constructor(e,t){this.disabled=!1,this.options=[],this.label=e,Array.isArray(t)?this.options=t:void 0!==t&&(this.disabled=t?.disabled??!1,this.options=t.options)}toJSON(){return{__brand:Wi,disabled:this.disabled||void 0,label:this.label,options:this.options}}}const{addMethod:Zi,notify:Ki,receive:qi,request:Hi}=function(e,t){const n=new Dn(e,t),i=new On(e);return{addMethod:i.addMethod.bind(i),notify:n.notify.bind(n),request:n.request.bind(n),receive:async e=>await n.receive(e)||await i.receive(e)}}(e=>at.ui.sendToPropertyInspector(e));at.ui.onSendToPlugin(e=>qi(e.payload));const Xi={addMethod:Zi,notify:Ki,request:Hi};function Ji(e){return(t,n)=>{if("object"!=typeof n)throw new Error("Experimental decorators are not supported; remove `experimentalDecorators` from your tsconfig.json file\nor register RPC method handlers manually using `rpc.addMethod(...)`.");n.addInitializer(function(){Xi.addMethod(e,async(n,i,s)=>{if(this instanceof ot&&this.manifestId!==at.ui.action?.manifestId)return s();try{const e=Array.isArray(n)?n:[n];return await t(...e,i,s)}catch(t){const n=t instanceof Error?t.message:t?.toString();throw await i.error({code:bn,message:n??`Encountered an error whilst invoking ${e}`}),t}})})}}let Yi=new Map;class Qi{id=0;notificationCallbacks=new Map;webSocket=void 0;send(e,t=void 0){if(this.webSocket?.readyState!=te.OPEN)return new Promise(e=>e("Websocket undefined"));let n={id:this.id++,jsonrpc:"2.0",method:e};return void 0===t||this.isEmpty(t)||(n.params=t),this.webSocket.send(JSON.stringify(n)),new Promise(function(e,t){Yi.set(n.id,{resolve:e,reject:t})})}async resolveMessage(e){const t=JSON.parse(e.data.toString()),{method:n,params:i}=t,s=this.notificationCallbacks.get(n);if(null!=s){if(Array.isArray(i))s.fn.apply(this.notificationCallbacks,i);else if("object"==typeof i)if(0==s.params.length)s.fn.call(this.notificationCallbacks,i);else{var o=[];s.params.forEach(function(e){i.hasOwnProperty(e)?(o.push(i[e]),delete i[e]):o.push(void 0)}),s.fn.apply(this.notificationCallbacks,o)}}else this.resolveRequest(JSON.parse(e.data.toString()))}resolveRequest(e){Yi.get(e.id)&&(null!=e.result?(Yi.get(e.id)?.resolve(e.result),Yi.delete(e.id)):(Yi.get(e.id)?.reject(e.error),Yi.delete(e.id)))}onNotification(e,t,n){this.notificationCallbacks.set(e,{fn:n,params:t})}isEmpty(e){if("object"==typeof e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}return Array.isArray(e)?!(0===Array(e).length):!e}}class es extends Qi{port;minPort;maxPort;count=0;isConnecting=!1;ws;constructor(e){super(),this.minPort=this.port=e,this.maxPort=this.port+9}connect(){this.isConnecting||(this.count=0,this.isConnecting=!0,this.startConnecting())}startConnecting(){const e=new te(`ws://127.0.0.1:${this.port}`,{origin:"streamdeck://"});e.onopen=()=>{at.logger.info("Connected on",this.port),this.count=0,this.webSocket=e,this.isConnecting=!1,this.onConnect()},e.onerror=e=>{this.webSocket=void 0,this.port>=this.maxPort?this.port=this.minPort:this.port++,this.count<60?this.port===this.minPort?(at.logger.error(`No connection after ${this.count} tries. Last error: ${e.error}`),this.count++,setTimeout(()=>{this.startConnecting()},1e3)):setTimeout(()=>{this.startConnecting()},100):(at.logger.error(`Stopped connecting after ${this.count} tries. Last error: ${e.error}`),this.isConnecting=!1)},e.onclose=()=>{this.webSocket=void 0},e.onmessage=this.resolveMessage.bind(this)}disconnect(){void 0!==this.webSocket&&this.webSocket.close(),this.onDisconnect()}onConnect(){}onDisconnect(){}}function ts(e,t,n){function i(n,i){var s;Object.defineProperty(n,"_zod",{value:n._zod??{},enumerable:!1}),(s=n._zod).traits??(s.traits=new Set),n._zod.traits.add(e),t(n,i);for(const e in r.prototype)e in n||Object.defineProperty(n,e,{value:r.prototype[e].bind(n)});n._zod.constr=r,n._zod.def=i}const s=n?.Parent??Object;class o extends s{}function r(e){var t;const s=n?.Parent?new o:this;i(s,e),(t=s._zod).deferred??(t.deferred=[]);for(const e of s._zod.deferred)e();return s}return Object.defineProperty(o,"name",{value:e}),Object.defineProperty(r,"init",{value:i}),Object.defineProperty(r,Symbol.hasInstance,{value:t=>!!(n?.Parent&&t instanceof n.Parent)||t?._zod?.traits?.has(e)}),Object.defineProperty(r,"name",{value:e}),r}class ns extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const is={};function ss(e){return is}function os(e,t){return"bigint"==typeof t?t.toString():t}const rs=Symbol("evaluating");function as(e,t,n){let i;Object.defineProperty(e,t,{get(){if(i!==rs)return void 0===i&&(i=rs,i=n()),i},set(n){Object.defineProperty(e,t,{value:n})},configurable:!0})}const cs="captureStackTrace"in Error?Error.captureStackTrace:(...e)=>{};function ls(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}const us=new Set(["string","number","symbol"]);const ds={safeint:[Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],int32:[-2147483648,2147483647],uint32:[0,4294967295],float32:[-34028234663852886e22,34028234663852886e22],float64:[-Number.MAX_VALUE,Number.MAX_VALUE]};function hs(e,t=0){if(!0===e.aborted)return!0;for(let n=t;n<e.issues.length;n++)if(!0!==e.issues[n]?.continue)return!0;return!1}function ps(e){return"string"==typeof e?e:e?.message}function fs(e,t,n){const i={...e,path:e.path??[]};if(!e.message){const s=ps(e.inst?._zod.def?.error?.(e))??ps(t?.error?.(e))??ps(n.customError?.(e))??ps(n.localeError?.(e))??"Invalid input";i.message=s}return delete i.inst,delete i.continue,t?.reportInput||delete i.input,i}const vs=(e,t)=>{e.name="$ZodError",Object.defineProperty(e,"_zod",{value:e._zod,enumerable:!1}),Object.defineProperty(e,"issues",{value:t,enumerable:!1}),e.message=JSON.stringify(t,os,2),Object.defineProperty(e,"toString",{value:()=>e.message,enumerable:!1})},ms=ts("$ZodError",vs),gs=ts("$ZodError",vs,{Parent:Error}),ys=(e=>(t,n,i,s)=>{const o=i?Object.assign(i,{async:!1}):{async:!1},r=t._zod.run({value:n,issues:[]},o);if(r instanceof Promise)throw new ns;if(r.issues.length){const t=new(s?.Err??e)(r.issues.map(e=>fs(e,o,ss())));throw cs(t,s?.callee),t}return r.value})(gs),bs=(e=>async(t,n,i,s)=>{const o=i?Object.assign(i,{async:!0}):{async:!0};let r=t._zod.run({value:n,issues:[]},o);if(r instanceof Promise&&(r=await r),r.issues.length){const t=new(s?.Err??e)(r.issues.map(e=>fs(e,o,ss())));throw cs(t,s?.callee),t}return r.value})(gs),_s=(e=>(t,n,i)=>{const s=i?{...i,async:!1}:{async:!1},o=t._zod.run({value:n,issues:[]},s);if(o instanceof Promise)throw new ns;return o.issues.length?{success:!1,error:new(e??ms)(o.issues.map(e=>fs(e,s,ss())))}:{success:!0,data:o.value}})(gs),ws=(e=>async(t,n,i)=>{const s=i?Object.assign(i,{async:!0}):{async:!0};let o=t._zod.run({value:n,issues:[]},s);return o instanceof Promise&&(o=await o),o.issues.length?{success:!1,error:new e(o.issues.map(e=>fs(e,s,ss())))}:{success:!0,data:o.value}})(gs),Ss=/^-?\d+$/,Is=/^-?\d+(?:\.\d+)?/,ks=ts("$ZodCheck",(e,t)=>{var n;e._zod??(e._zod={}),e._zod.def=t,(n=e._zod).onattach??(n.onattach=[])}),xs=ts("$ZodCheckNumberFormat",(e,t)=>{ks.init(e,t),t.format=t.format||"float64";const n=t.format?.includes("int"),i=n?"int":"number",[s,o]=ds[t.format];e._zod.onattach.push(e=>{const i=e._zod.bag;i.format=t.format,i.minimum=s,i.maximum=o,n&&(i.pattern=Ss)}),e._zod.check=r=>{const a=r.value;if(n){if(!Number.isInteger(a))return void r.issues.push({expected:i,format:t.format,code:"invalid_type",continue:!1,input:a,inst:e});if(!Number.isSafeInteger(a))return void(a>0?r.issues.push({input:a,code:"too_big",maximum:Number.MAX_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}):r.issues.push({input:a,code:"too_small",minimum:Number.MIN_SAFE_INTEGER,note:"Integers must be within the safe integer range.",inst:e,origin:i,continue:!t.abort}))}a<s&&r.issues.push({origin:"number",input:a,code:"too_small",minimum:s,inclusive:!0,inst:e,continue:!t.abort}),a>o&&r.issues.push({origin:"number",input:a,code:"too_big",maximum:o,inst:e})}}),Es={major:4,minor:1,patch:12},Ds=ts("$ZodType",(e,t)=>{var n;e??(e={}),e._zod.def=t,e._zod.bag=e._zod.bag||{},e._zod.version=Es;const i=[...e._zod.def.checks??[]];e._zod.traits.has("$ZodCheck")&&i.unshift(e);for(const t of i)for(const n of t._zod.onattach)n(e);if(0===i.length)(n=e._zod).deferred??(n.deferred=[]),e._zod.deferred?.push(()=>{e._zod.run=e._zod.parse});else{const t=(e,t,n)=>{let i,s=hs(e);for(const o of t){if(o._zod.def.when){if(!o._zod.def.when(e))continue}else if(s)continue;const t=e.issues.length,r=o._zod.check(e);if(r instanceof Promise&&!1===n?.async)throw new ns;if(i||r instanceof Promise)i=(i??Promise.resolve()).then(async()=>{await r;e.issues.length!==t&&(s||(s=hs(e,t)))});else{if(e.issues.length===t)continue;s||(s=hs(e,t))}}return i?i.then(()=>e):e},n=(n,s,o)=>{if(hs(n))return n.aborted=!0,n;const r=t(s,i,o);if(r instanceof Promise){if(!1===o.async)throw new ns;return r.then(t=>e._zod.parse(t,o))}return e._zod.parse(r,o)};e._zod.run=(s,o)=>{if(o.skipChecks)return e._zod.parse(s,o);if("backward"===o.direction){const t=e._zod.parse({value:s.value,issues:[]},{...o,skipChecks:!0});return t instanceof Promise?t.then(e=>n(e,s,o)):n(t,s,o)}const r=e._zod.parse(s,o);if(r instanceof Promise){if(!1===o.async)throw new ns;return r.then(e=>t(e,i,o))}return t(r,i,o)}}e["~standard"]={validate:t=>{try{const n=_s(e,t);return n.success?{value:n.data}:{issues:n.error?.issues}}catch(n){return ws(e,t).then(e=>e.success?{value:e.data}:{issues:e.error?.issues})}},vendor:"zod",version:1}}),Cs=ts("$ZodString",(e,t)=>{var n;Ds.init(e,t),e._zod.pattern=[...e?._zod.bag?.patterns??[]].pop()??(n=e._zod.bag,new RegExp(`^${n?`[\\s\\S]{${n?.minimum??0},${n?.maximum??""}}`:"[\\s\\S]*"}$`)),e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=String(n.value)}catch(i){}return"string"==typeof n.value||n.issues.push({expected:"string",code:"invalid_type",input:n.value,inst:e}),n}}),Os=ts("$ZodNumber",(e,t)=>{Ds.init(e,t),e._zod.pattern=e._zod.bag.pattern??Is,e._zod.parse=(n,i)=>{if(t.coerce)try{n.value=Number(n.value)}catch(e){}const s=n.value;if("number"==typeof s&&!Number.isNaN(s)&&Number.isFinite(s))return n;const o="number"==typeof s?Number.isNaN(s)?"NaN":Number.isFinite(s)?void 0:"Infinity":void 0;return n.issues.push({expected:"number",code:"invalid_type",input:s,inst:e,...o?{received:o}:{}}),n}}),Ms=ts("$ZodNumber",(e,t)=>{xs.init(e,t),Os.init(e,t)});function Ps(e,t,n,i){e.issues.length&&t.issues.push(...function(e,t){return t.map(t=>{var n;return(n=t).path??(n.path=[]),t.path.unshift(e),t})}(n,e.issues)),void 0===e.value?n in i&&(t.value[n]=void 0):t.value[n]=e.value}function As(e){const t=Object.keys(e.shape);for(const n of t)if(!e.shape?.[n]?._zod?.traits?.has("$ZodType"))throw new Error(`Invalid element at key "${n}": expected a Zod schema`);const n=(i=e.shape,Object.keys(i).filter(e=>"optional"===i[e]._zod.optin&&"optional"===i[e]._zod.optout));var i;return{...e,keys:t,keySet:new Set(t),numKeys:t.length,optionalKeys:new Set(n)}}const Ts=ts("$ZodObject",(e,t)=>{Ds.init(e,t);const n=Object.getOwnPropertyDescriptor(t,"shape");if(!n?.get){const e=t.shape;Object.defineProperty(t,"shape",{get:()=>{const n={...e};return Object.defineProperty(t,"shape",{value:n}),n}})}const i=(s=()=>As(t),{get value(){{const e=s();return Object.defineProperty(this,"value",{value:e}),e}}});var s;as(e._zod,"propValues",()=>{const e=t.shape,n={};for(const t in e){const i=e[t]._zod;if(i.values){n[t]??(n[t]=new Set);for(const e of i.values)n[t].add(e)}}return n});const o=ls,r=t.catchall;let a;e._zod.parse=(t,n)=>{a??(a=i.value);const s=t.value;if(!o(s))return t.issues.push({expected:"object",code:"invalid_type",input:s,inst:e}),t;t.value={};const c=[],l=a.shape;for(const e of a.keys){const i=l[e]._zod.run({value:s[e],issues:[]},n);i instanceof Promise?c.push(i.then(n=>Ps(n,t,e,s))):Ps(i,t,e,s)}return r?function(e,t,n,i,s,o){const r=[],a=s.keySet,c=s.catchall._zod,l=c.def.type;for(const s of Object.keys(t)){if(a.has(s))continue;if("never"===l){r.push(s);continue}const o=c.run({value:t[s],issues:[]},i);o instanceof Promise?e.push(o.then(e=>Ps(e,n,s,t))):Ps(o,n,s,t)}return r.length&&n.issues.push({code:"unrecognized_keys",keys:r,input:t,inst:o}),e.length?Promise.all(e).then(()=>n):n}(c,s,t,n,i.value,e):c.length?Promise.all(c).then(()=>t):t}}),zs=ts("$ZodEnum",(e,t)=>{Ds.init(e,t);const n=function(e){const t=Object.values(e).filter(e=>"number"==typeof e);return Object.entries(e).filter(([e,n])=>-1===t.indexOf(+e)).map(([e,t])=>t)}(t.entries),i=new Set(n);e._zod.values=i,e._zod.pattern=new RegExp(`^(${n.filter(e=>us.has(typeof e)).map(e=>"string"==typeof e?e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"):e.toString()).join("|")})$`),e._zod.parse=(t,s)=>{const o=t.value;return i.has(o)||t.issues.push({code:"invalid_value",values:n,input:o,inst:e}),t}});function Ls(e,t){return e.issues.length&&void 0===t?{issues:[],value:void 0}:e}const $s=ts("$ZodOptional",(e,t)=>{Ds.init(e,t),e._zod.optin="optional",e._zod.optout="optional",as(e._zod,"values",()=>t.innerType._zod.values?new Set([...t.innerType._zod.values,void 0]):void 0),as(e._zod,"pattern",()=>{const e=t.innerType._zod.pattern;return e?new RegExp(`^(${function(e){const t=e.startsWith("^")?1:0,n=e.endsWith("$")?e.length-1:e.length;return e.slice(t,n)}(e.source)})?$`):void 0}),e._zod.parse=(e,n)=>{if("optional"===t.innerType._zod.optin){const i=t.innerType._zod.run(e,n);return i instanceof Promise?i.then(t=>Ls(t,e.value)):Ls(i,e.value)}return void 0===e.value?e:t.innerType._zod.run(e,n)}});const Ns=ts("ZodMiniType",(e,t)=>{if(!e._zod)throw new Error("Uninitialized schema in ZodMiniType.");Ds.init(e,t),e.def=t,e.type=t.type,e.parse=(t,n)=>ys(e,t,n,{callee:e.parse}),e.safeParse=(t,n)=>_s(e,t,n),e.parseAsync=async(t,n)=>bs(e,t,n,{callee:e.parseAsync}),e.safeParseAsync=async(t,n)=>ws(e,t,n),e.check=(...n)=>e.clone({...t,checks:[...t.checks??[],...n.map(e=>"function"==typeof e?{_zod:{check:e,def:{check:"custom"},onattach:[]}}:e)]}),e.clone=(t,n)=>function(e,t,n){const i=new e._zod.constr(t??e._zod.def);return t&&!n?.parent||(i._zod.parent=e),i}(e,t,n),e.brand=()=>e,e.register=(t,n)=>(t.add(e,n),e)}),js=ts("ZodMiniString",(e,t)=>{Cs.init(e,t),Ns.init(e,t)});function Rs(e){return new js({type:"string"})}const Us=ts("ZodMiniNumber",(e,t)=>{Os.init(e,t),Ns.init(e,t)}),Bs=ts("ZodMiniNumberFormat",(e,t)=>{Ms.init(e,t),Us.init(e,t)});function Fs(e){return new Bs({type:"number",check:"number_format",abort:!1,format:"safeint"})}const Vs=ts("ZodMiniObject",(e,t)=>{Ts.init(e,t),Ns.init(e,t),as(e,"shape",()=>t.shape)});function Ws(e,t){return new Vs({type:"object",shape:e??{}})}const Gs=ts("ZodMiniEnum",(e,t)=>{zs.init(e,t),Ns.init(e,t),e.options=Object.values(t.entries)});const Zs=ts("ZodMiniOptional",(e,t)=>{$s.init(e,t),Ns.init(e,t)});function Ks(e){return new Zs({type:"optional",innerType:e})}var qs,Hs;!function(e){e.Toggle="Toggle",e.Set="Set",e.Adjust="Adjust"}(qs||(qs={})),function(e){e.Static="Static",e.SliderHorizontal="SliderHorizontal",e.SliderVertical="SliderVertical",e.LevelmeterHorizontal="LevelmeterHorizontal",e.LevelmeterVertical="LevelmeterVertical",e.SliderAndLevelmeterHorizontal="SliderAndLevelmeterHorizontal",e.SliderAndLevelmeterVertical="SliderAndLevelmeterVertical"}(Hs||(Hs={}));const Xs=function(e){const t=Array.isArray(e)?Object.fromEntries(e.map(e=>[e,e])):e;return new Gs({type:"enum",entries:t})}(Hs);var Js,Ys,Qs,eo,to;!function(e){e.GetApplicationInfo="getApplicationInfo",e.GetInputDevices="getInputDevices",e.SetInputDevice="setInputDevice",e.GetOutputDevices="getOutputDevices",e.SetOutputDevice="setOutputDevice",e.GetChannels="getChannels",e.SetChannel="setChannel",e.AddToChannel="addToChannel",e.GetMixes="getMixes",e.SetMix="setMix",e.SetSubscription="setSubscription"}(Js||(Js={})),function(e){e.InputDevicesChanged="inputDevicesChanged",e.InputDeviceChanged="inputDeviceChanged",e.OutputDevicesChanged="outputDevicesChanged",e.OutputDeviceChanged="outputDeviceChanged",e.ChannelsChanged="channelsChanged",e.ChannelChanged="channelChanged",e.MixesChanged="mixesChanged",e.MixChanged="mixChanged",e.LevelMeterChanged="levelMeterChanged",e.FocusedAppChanged="focusedAppChanged"}(Ys||(Ys={})),function(e){e.AppConnected="appConnected",e.AppDisconnected="appDisconnected",e.InputDevicesChanged="inputDevicesChanged",e.InputDeviceChanged="inputDeviceChanged",e.OutputDevicesChanged="outnputDevicesChanged",e.OutputDeviceChanged="outputDeviceChanged",e.ChannelsChanged="channelsChanged",e.ChannelChanged="channelChanged",e.MixesChanged="mixesChanged",e.MixChanged="mixChanged",e.LevelMeterChanged="levelMeterChanged",e.FocusedAppChanged="focusedAppChanged"}(Qs||(Qs={})),function(e){e.NoWaveDevice="NoWaveDevice",e.Wave1="Wave1",e.Wave3="Wave3",e.WaveXLR="WaveXLR",e.WaveXLRDock="WaveXLRDock",e.WaveNeo="WaveNeo",e.WaveXLRMk2="WaveXLRMk2",e.WaveXLRMk2Dock="WaveXLRMk2Dock",e.WaveXLRPro="WaveXLRPro"}(eo||(eo={})),function(e){e.Input="input",e.Output="output",e.Channel="channel",e.Mix="mix"}(to||(to={}));class no extends fe{constructor(){super()}}var io=new class extends es{eventEmitter=new no;isAppInstalled=!1;isAppUpToDate=!1;isConnected=!1;blockedNotifications=new Map;addToChannelCount=0;mainOutput="";inputDevices=[];outputDevices=[];channels=[];mixes=[];focusedApp={id:"",name:"",channel:{id:""}};levelMeters={inputDevices:[],outputDevices:[],channels:[],mixes:[]};throttleInputDevice=this.throttle(e=>{void 0!==e&&this.eventEmitter.emit(Qs.InputDeviceChanged,{id:e.id})},100);throttleChannel=this.throttle(e=>{void 0!==e&&this.eventEmitter.emit(Qs.ChannelChanged,{id:e.id})},100);constructor(){super(1884);let e=at.info.application.platform;try{let t="",n="";"windows"==e?(t='Get-AppxPackage -Name "Elgato.WaveLink"',n="powershell.exe"):"mac"==e&&(t="mdfind \"kMDItemCFBundleIdentifier == 'com.elgato.WaveLink3.debug' || kMDItemCFBundleIdentifier == 'com.elgato.WaveLink3'\"",n="/bin/sh");const i=m(t,{shell:n}).toString();this.isAppInstalled=i.length>0}catch(e){at.logger.error("App search failed:",e)}finally{at.logger.info("Wave Link found on system.")}this.updateBannerSettings(),this.onNotification(Ys.InputDevicesChanged,[],e=>{this.inputDevices=e.inputDevices,console.log(e),this.eventEmitter.emit(Qs.InputDevicesChanged)}),this.onNotification(Ys.InputDeviceChanged,[],e=>{if(this.isNotificationBlocked(Ys.InputDeviceChanged))return;const t=this.getInputDeviceById(e.id);if(void 0!==t){for(const t of e.inputs)if("effects"in t){const n=this.getInputById(e.id,t.id);void 0!==n&&"effects"in t&&(n.effects=t.effects)}this.updateObject(t,e),this.throttleInputDevice(t,e)}}),this.onNotification(Ys.OutputDevicesChanged,[],e=>{this.outputDevices=e.outputDevices,console.log(e),this.eventEmitter.emit(Qs.OutputDevicesChanged)}),this.onNotification(Ys.OutputDeviceChanged,[],e=>{const t=e,n=this.outputDevices?.find(e=>e.id===t.id);void 0!==n&&(this.updateObject(n,t),this.eventEmitter.emit(Qs.OutputDeviceChanged,{id:t.id}))}),this.onNotification(Ys.ChannelsChanged,[],e=>{this.channels=e.channels,this.eventEmitter.emit(Qs.ChannelsChanged)}),this.onNotification(Ys.ChannelChanged,[],e=>{const t=this.channels.find(t=>t.id===e.id);void 0!==t&&t!=e&&("apps"in e&&(t.apps=e.apps),"effects"in e&&(t.effects=e.effects),this.updateObject(t,e),this.throttleChannel(t,e))}),this.onNotification(Ys.MixesChanged,[],e=>{this.mixes=e.mixes,this.eventEmitter.emit(Qs.MixesChanged)}),this.onNotification(Ys.MixChanged,[],e=>{const t=this.mixes.find(t=>t.id===e.id);void 0!==t&&(this.updateObject(t,e),this.eventEmitter.emit(Qs.MixChanged,{id:t.id}))}),this.onNotification(Ys.LevelMeterChanged,["inputDevices","outputDevices","channels","mixes"],(e,t,n,i)=>{this.levelMeters.inputDevices=e,this.levelMeters.outputDevices=t,this.levelMeters.channels=n,this.levelMeters.mixes=i,this.eventEmitter.emit(Qs.LevelMeterChanged)}),this.onNotification(Ys.FocusedAppChanged,["id","name","channel"],(e,t,n)=>{at.logger.debug(`${Ys.FocusedAppChanged}: ID ${e} Name ${t} Channel ${n?.id}`),this.focusedApp.name=""===t?"--":t,this.focusedApp.id=e,this.focusedApp.channel=n,this.eventEmitter.emit(Qs.FocusedAppChanged)})}onConnect(){this.init()}onDisconnect(){at.logger.info("Application disconnected."),this.isConnected=!1,this.isAppUpToDate=!1,this.updateBannerSettings(),this.eventEmitter.emit(Qs.AppDisconnected),at.ui.sendToPropertyInspector({isAppConnected:this.isAppConnected()}),at.logger.info("Trying to reconnect."),this.connect()}isAppConnected(){return this.isConnected}async init(){this.send(Js.GetApplicationInfo).then(async e=>{const t=e;if(at.logger.debug(`Application Info: ${t}`),"EWL"!==t.appID&&"Elgato Wave Link"!==t.name)return at.logger.error("Connected application is not Wave Link.");t.interfaceRevision>=1&&(this.isAppUpToDate=!0,this.isConnected=!0,this.updateBannerSettings(),await Promise.all([this.getInputDevices(),this.getOutputDevices(),this.getChannels(),this.getMixes()]),this.eventEmitter.emit(Qs.AppConnected),at.ui.sendToPropertyInspector({isAppConnected:this.isAppConnected()}))})}async getInputDevices(){return this.send(Js.GetInputDevices).then(e=>{if(null!=e){const t=e.inputDevices;Array.isArray(t)&&(at.logger.debug(`Input devices: ${t}`),this.inputDevices=t)}})}async getOutputDevices(){return this.send(Js.GetOutputDevices).then(e=>{if(null!=e){this.mainOutput=e.mainOutput,at.logger.debug(`Main output: ${this.mainOutput}`);const t=e.outputDevices;Array.isArray(t)&&(at.logger.debug(`Output devices: ${t}`),this.outputDevices=t)}})}async getChannels(){return this.send(Js.GetChannels).then(e=>{null!=e&&(at.logger.debug(`Channels: ${e.channels}`),this.channels=e.channels)})}async getMixes(){return this.send(Js.GetMixes).then(e=>{null!=e&&(at.logger.debug(`Mixes: ${e.mixes}`),this.mixes=e.mixes)})}setInputDevice(e){this.send(Js.SetInputDevice,e).then(()=>{}).catch(e=>{at.logger.debug(e)})}setOutputDevice(e){this.send(Js.SetOutputDevice,e).then(()=>{}).catch(e=>{at.logger.debug(e)})}setChannel(e){this.send(Js.SetChannel,e).then(()=>{}).catch(e=>{at.logger.debug(e)})}setMix(e){this.send(Js.SetMix,e).then(()=>{}).catch(e=>{at.logger.debug(e)})}getInputDeviceList(){return this.inputDevices??[]}getInputDeviceById(e){if(void 0!==this.inputDevices)return this.inputDevices.find(t=>t.id==e)}getInputById(e,t){if(void 0===this.inputDevices)return;const n=this.getInputDeviceById(e);if(void 0!==n&&void 0!==n.inputs){if(1==n.inputs.length)return n.inputs[0];if(n.inputs.length>1)return n.inputs.find(e=>e.id==t)}}getOutputDeviceById(e){if(void 0!==this.outputDevices)return this.outputDevices.find(t=>t.id==e)}getOutputById(e,t){if(void 0===this.outputDevices)return;const n=this.getOutputDeviceById(e);if(void 0!==n&&void 0!==n.outputs){if(1==n.outputs.length)return n.outputs[0];if(n.outputs.length>1)return n.outputs.find(t=>t.id==e)}}getChannelList(){return this.channels}getChannelById(e){if(void 0!==this.channels)return this.channels.find(t=>t.id==e)}getMixById(e){if(void 0!==this.mixes)return this.mixes.find(t=>t.id==e)}getLevelMeterOfId(e,t,n=""){let i;switch(e){case to.Input:i=this.levelMeters.inputDevices;break;case to.Output:i=this.levelMeters.outputDevices;break;case to.Channel:i=this.levelMeters.channels;break;case to.Mix:i=this.levelMeters.mixes;break;default:return}return""!==n&&"all"!==n?i?.find(e=>e.id===t&&e.subId===n):i?.find(e=>e.id===t)}setSubscription(e){this.isAppConnected()&&this.send(Js.SetSubscription,e).then(e=>{const{focusedAppChanged:t,levelMeterChanged:n}=e,i=void 0!==n?n:t;void 0!==i&&at.logger.info(`${i?.isEnabled?"Subscribed":"Unsubscribed"} to ${i.type} with id ${i.id}${void 0!==i.subId?" and subID "+i.subId:""}.`)},t=>at.logger.error(`setSubscription failed, payload: ${JSON.stringify(e)} error: ${JSON.stringify(t)}`))}subscribe(e){this.isAppConnected()&&(0===this.addToChannelCount&&this.send(Js.SetSubscription,{[e]:{isEnabled:!0}}).then(e=>console.log(e),e=>{console.log(e),this.addToChannelCount--}),this.addToChannelCount++)}unsubscribe(e){this.isAppConnected()&&(1===this.addToChannelCount&&this.send(Js.SetSubscription,{[e]:{isEnabled:!1}}).then(e=>console.log(e),e=>{console.log(e),this.addToChannelCount++}),this.addToChannelCount--)}isNotificationBlocked(e){return this.blockedNotifications.get(e)??!1}setNotificationIsBlocked(e,t){this.blockedNotifications.set(e,t)}updateBannerSettings(){console.log("Updating Banner Settings",this.isAppInstalled,this.isAppUpToDate,this.isAppConnected()),this.isAppInstalled&&this.isAppUpToDate&&this.isAppConnected()?at.settings.setGlobalSettings({showBanner:"false"}):at.settings.setGlobalSettings({showBanner:"true"})}throttle(e,t){let n;return(...i)=>{void 0===n&&(e(...i),n=setTimeout(()=>{n=void 0,e(...i)},t))}}updateObject(e,t){for(const n in t){const i=n;"object"==typeof e[i]?this.updateObject(e[i],t[i]??{}):e[i]=t[i]}}};let so=(()=>{let e,t,n,i=ot,s=[];return class extends i{static{const o="function"==typeof Symbol&&Symbol.metadata?Object.create(i[Symbol.metadata]??null):void 0;e=[Ji("InputDevices")],t=[Ji("SoftwareChannels")],n=[Ji("Mixes")],ct(this,null,e,{kind:"method",name:"inputDevices",static:!1,private:!1,access:{has:e=>"inputDevices"in e,get:e=>e.inputDevices},metadata:o},null,s),ct(this,null,t,{kind:"method",name:"softwareChannels",static:!1,private:!1,access:{has:e=>"softwareChannels"in e,get:e=>e.softwareChannels},metadata:o},null,s),ct(this,null,n,{kind:"method",name:"mixes",static:!1,private:!1,access:{has:e=>"mixes"in e,get:e=>e.mixes},metadata:o},null,s),o&&Object.defineProperty(this,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})}actionMap=(lt(this,s),new Map);showAlertMap=new Map;updateTimers=new Map;constructor(){super()}onWillAppear(e){this.onAppear(e),this.actionMap.set(e.action,e.payload.settings),e.action.isKey()?(this.setImageLayout(e.action,e.payload.settings),this.setImage(e.action,!0),this.setState(e.action)):this.setFeedback(e.action,!0)}onAppear(e){}onWillDisappear(e){this.onDisappear(e),this.actionMap.forEach((t,n)=>{n.id==e.action.id&&this.actionMap.delete(n)})}onDisappear(e){}onDidReceiveSettings(e){this.actionMap.get(e.action)!=e.payload.settings&&(this.actionMap.set(e.action,e.payload.settings),e.action.isDial()?this.setFeedback(e.action,!0):(this.setImage(e.action,!0),this.setState(e.action)))}onReceiveSettings(e){}onKeyUp(e){this.showAlertMap.get(e.action)&&(e.action.showAlert(),this.showAlertMap.delete(e.action))}setState(e){}setImage(e,t=!1){}setImageLayout(e,t){}setFeedback(e,t=!1){}setFeedbackLayout(e){}onPropertyInspectorDidAppear(e){at.ui.sendToPropertyInspector({method:"applicationStateChanged",isAppConnected:io.isAppConnected(),isAppInstalled:io.isAppInstalled,isAppUpToDate:io.isAppUpToDate}),this.onPIDidAppear(e)}onPIDidAppear(e){}inputDevices(){return io.inputDevices?.filter(e=>e.type!==eo.NoWaveDevice).map(e=>new Vi(e.name,e.id))??[]}softwareChannels(){return io.channels?.filter(e=>"Software"===e.type).map(e=>new Vi(e.name,e.id))??[]}mixes(){return io.mixes?.map(e=>new Vi(e.name,e.id))??[]}showAlert(e){this.showAlertMap.set(e,!0)}setUpdateBlocked(e,t){this.updateTimers.get(e)?(clearTimeout(this.updateTimers.get(e)),this.updateTimers.delete(e),this.updateTimers.set(e,setTimeout(()=>{this.updateTimers.delete(e),t.isDial()?this.setFeedback(t):this.setImage(t)},2e3))):this.updateTimers.set(e,setTimeout(()=>{this.updateTimers.delete(e),t.isDial()?this.setFeedback(t):this.setImage(t)},2e3))}isUpdatedBlocked(e){return this.updateTimers.get(e)}}})();var oo=new class{actionMap=new Map;layouts=new Map;imageCache=new Map;manifest;constructor(){try{this.manifest=JSON.parse(g.readFileSync("./ui/layouts/manifest.json").toString()),g.readdir("./ui/layouts/key/",(e,t)=>{null===e&&t.forEach(e=>{const t=JSON.parse(g.readFileSync(`./ui/layouts/key/${e}`,"utf-8"));this.layouts.set(t.id,t.items)})})}catch(e){console.error(e)}}setImage(e,t,n,i){let s="";try{const o=this.actionMap.get(e.id)??[];if((0===o.length||0===o[0]?.length)&&(o.length=0,void 0!==this.manifest)){const t=this.manifest.Actions.find(t=>t.UUID===e.manifestId);if(void 0===t)return void console.error(`No key layout for ${e.manifestId} found`);void 0!==t.States&&t.States.forEach(e=>{const t=[];this.layouts.get(e.Layout).forEach(e=>t.push(Object.assign({},e))),o.push(t)})}const r=[t];void 0!==n&&r.push(n);for(let t=0;t<r.length;t++){o[t]?.sort((e,t)=>e.zOrder-t.zOrder);const a=void 0===i?.ViewBox?"0 0 144 144":`${i.ViewBox[0]} ${i.ViewBox[1]} ${i.ViewBox[2]} ${i.ViewBox[3]}`;s=`<svg width="144" height="144" viewBox="${a}" fill="none" xmlns="http://www.w3.org/2000/svg">\n`,o[t]?.forEach(e=>{const n=r[t][e.key];if(void 0!==n)for(const t in n)e[t]=n[t];if(!1===e?.isEnabled)return;const i=Object.assign([],e.rect);if(void 0!==n?.offset)for(let e=0;e<n.offset.length;e++)i[e]+=n?.offset[e]??0;switch(e.type){case"img":if(void 0===e?.value||"string"!=typeof e.value)return;if(e.value.includes(".svg")){let t={data:"",width:0,height:0};if(this.imageCache.has(e.value))Object.assign(t,this.imageCache.get(e.value));else{t=this.loadSvgContent(e.value);const n=Object.assign({},t);this.imageCache.set(e.value,n)}void 0!==e?.color&&(t.data=t.data.replaceAll("white",`${e.color}`)),s+=`<g transform="matrix(${i[2]/t.width} 0 0 ${i[3]/t.height} ${i[0]} ${i[1]})" opacity="${e?.opacity??1}">${t.data}</g>\n`}else s+=`<image x="${i[0]}" y="${i[1]}" width="${i[2]}" height="${i[3]}" opacity="${e?.opacity??1}" href="data:image/png;charset=utf-8;base64,${e.value}"/>\n`;break;case"svg":s+=e.value+"\n";break;case"text":const t=e?.fontSize??20,n=e?.fontWeight??"bold";let o=0,r=0;const a=e?.fontAnchor??"middle";switch(a){case"start":o=i[0],r=i[1]+i[3]/2;break;case"middle":o=i[0]+i[2]/2,r=i[1]+i[3]/2;break;case"end":o=i[0]+i[2],r=i[1]+i[3]/2}s+=`<g transform="translate(${o} ${r})"><text y="5" fill="${e?.color??"white"}" opacity="${e?.opacity??"1"}" xml:space="preserve" style="white-space: pre" font-family="Segoe UI" font-size="${t}" font-weight="${n}" letter-spacing="0em" text-anchor="${a}">${e.value}</text></g>\n`}}),s+="</svg>",this.actionMap.set(e.id,o),void 0!==n?e.setImage(`data:image/svg+xml;base64,${btoa(s)}`,{state:t}):e.setImage(`data:image/svg+xml;base64,${btoa(s)}`)}}catch(e){console.log(e)}}setImageLayout(e,t,n=void 0){if(void 0!==this.manifest){const i=[t];void 0!==n&&i.push(n);const s=new Array;i.forEach(e=>{const t=[];this.layouts.get(e)?.forEach(e=>t.push(Object.assign({},e))),s.push(t)}),this.actionMap.set(e.id,s)}}loadSvgContent(e){if(void 0===e||""===e)return{data:"",width:0,height:0};const t=g.readFileSync(e,"utf-8").toString(),n=Number(t.match(/width="[0-9]+/i)?.toString().replace('width="',"")),i=Number(t.match(/height="[0-9]+/i)?.toString().replace('height="',""));return{data:t.substring(t.indexOf(">")+1,t.lastIndexOf("</")),width:n,height:i}}truncate(e,t=12,n="..."){return e?e&&e.length>t?e.slice(0,t-3)+n:e:""}};const ro=new Map([["all","./imgs/actions/mixLevel/icons/all.svg"],["crown","./imgs/actions/mixLevel/icons/crown.svg"],["facesatisfied","./imgs/actions/mixLevel/icons/facesatisfied.svg"],["game","./imgs/actions/mixLevel/icons/game.svg"],["group","./imgs/actions/mixLevel/icons/group.svg"],["headphones","./imgs/actions/mixLevel/icons/headphones.svg"],["heart","./imgs/actions/mixLevel/icons/heart.svg"],["lens","./imgs/actions/mixLevel/icons/lens.svg"],["logoobs","./imgs/actions/mixLevel/icons/logoobs.svg"],["logotiktok","./imgs/actions/mixLevel/icons/logotiktok.svg"],["logotwitch","./imgs/actions/mixLevel/icons/logotwitch.svg"],["logoyoutube","./imgs/actions/mixLevel/icons/logoyoutube.svg"],["person","./imgs/actions/mixLevel/icons/person.svg"],["podcast","./imgs/actions/mixLevel/icons/podcast.svg"],["number1square","./imgs/actions/mixLevel/icons/square1.svg"],["number2square","./imgs/actions/mixLevel/icons/square2.svg"],["number3square","./imgs/actions/mixLevel/icons/square3.svg"],["number4square","./imgs/actions/mixLevel/icons/square4.svg"],["number5square","./imgs/actions/mixLevel/icons/square5.svg"],["star","./imgs/actions/mixLevel/icons/star.svg"],["stream","./imgs/actions/mixLevel/icons/stream.svg"]]),ao=new Map([["display","./imgs/actions/channelLevel/icons/display.svg"],["game","./imgs/actions/channelLevel/icons/game.svg"],["message","./imgs/actions/channelLevel/icons/message.svg"],["music","./imgs/actions/channelLevel/icons/music.svg"],["soundeffect","./imgs/actions/channelLevel/icons/soundeffect.svg"],["window","./imgs/actions/channelLevel/icons/window.svg"]]);class co extends so{levelMeterCounter=new Map;lastLevelMeters=new Map;subscriptionType;iconPaths=new Map;iconSmallPaths=new Map;throttle=new Map;longPressTimer=new Map;constructor(e,t){super(),this.subscriptionType=e,Array.isArray(t)||(t=[t]),io.eventEmitter.on(Qs.AppConnected,()=>{this.actionMap.forEach((e,t)=>{const{actionStyle:n}=e;void 0!==n&&this.showLevelMeter(n)&&this.setSubscription(this.getSubscriptionType(e),this.getIdentifier(e),!0,this.getSubIdentifier(e)),t.isKey()?(this.setImageLayout(t,e),this.setImage(t),this.setState(t)):(this.setFeedbackLayout(t),this.setFeedback(t))})}),io.eventEmitter.on(Qs.AppDisconnected,()=>{this.actionMap.forEach((e,t)=>{const{actionStyle:n}=e;void 0!==n&&this.showLevelMeter(n)&&this.setSubscription(this.getSubscriptionType(e),this.getIdentifier(e),!1,this.getSubIdentifier(e)),t.isKey()?(this.setImage(t),this.setState(t)):this.setFeedback(t)}),this.levelMeterCounter.clear()}),t.forEach(e=>{io.eventEmitter.on(e,e=>{const{id:t}=e;this.actionMap.forEach((e,n)=>{this.getIdentifier(e)===t&&(n.isKey()?void 0===this.throttle.get(n.id)&&this.throttle.set(n.id,setTimeout(()=>{this.throttle.delete(n.id),this.updateImage(e)&&this.setImage(n),this.updateState(e)&&this.setState(n)},50)):(this.setFeedbackLayout(n),this.setFeedback(n)),at.ui.action?.id===n.id&&this.updatePI(e))})})}),io.eventEmitter.on(Qs.LevelMeterChanged,()=>{this.actionMap.forEach((e,t)=>{t.isDial()?this.setFeedback(t):e.actionSubtype==qs.Adjust&&this.setImage(t)})})}onWillAppear(e){this.onAppear(e);const{settings:t}=e.payload;if(this.actionMap.set(e.action,t),e.action.isKey()?(this.setImageLayout(e.action,t),this.setImage(e.action,!0),this.setState(e.action)):(this.setFeedbackLayout(e.action),this.setFeedback(e.action,!0)),void 0===this.getIdentifier(t))return;const{actionStyle:n}=t;void 0!==n&&this.showLevelMeter(n)&&this.setSubscription(this.getSubscriptionType(t),this.getIdentifier(t),!0,this.getSubIdentifier(t))}onDisappear(e){const{settings:t}=e.payload;if(void 0===this.getIdentifier(t))return;const{actionStyle:n}=t;void 0!==n&&this.showLevelMeter(n)&&this.setSubscription(this.getSubscriptionType(t),this.getIdentifier(t),!1,this.getSubIdentifier(t))}onDidReceiveSettings(e){const t=this.actionMap.get(e.action),n=e.payload.settings;if(t==n)return;const i=this.showLevelMeter(t?.actionStyle),s=this.showLevelMeter(n?.actionStyle);t?.channelId!==n.channelId||t?.mixId!==n.mixId?(void 0!==t&&i&&this.setSubscription(this.getSubscriptionType(t),this.getIdentifier(t),!1,this.getSubIdentifier(t)),s&&this.setSubscription(this.getSubscriptionType(n),this.getIdentifier(n),!0,this.getSubIdentifier(n))):i!=s&&this.setSubscription(this.getSubscriptionType(n),this.getIdentifier(n),s,this.getSubIdentifier(n)),!e.action.isKey()||t?.actionStyle===n.actionStyle&&t?.actionSubtype===n.actionSubtype||this.setImageLayout(e.action,n),this.actionMap.set(e.action,e.payload.settings),e.action.isDial()?this.setFeedback(e.action,!0):(this.setImage(e.action,!0),this.setState(e.action)),this.updatePI(e.payload.settings)}async onKeyDown(e){const{settings:t}=e.payload;if(void 0!==this.getData(t))try{switch(t.actionSubtype){case qs.Toggle:if(e.action.isInMultiAction()){const{multiActionState:n}=e.payload.settings;this.setMute(t,-1===n?void 0:Boolean(n))}else this.setMute(t);break;case qs.Set:this.setValue(t);break;case qs.Adjust:const n=t.adjustValue;this.adjustValueLongPress(e.action.id,t,n>0?n:n-1)}}catch(t){console.error(t),e.action.showAlert()}else e.action.showAlert()}onKeyUp(e){const{settings:t}=e.payload,n=this.longPressTimer.get(e.action.id);t.actionSubtype===qs.Adjust&&void 0!==n&&(clearTimeout(n),this.longPressTimer.delete(e.action.id))}onTouchTap(e){const{settings:t}=e.payload;if(void 0!==this.getIdentifier(t))try{this.setMute(t)}catch(t){console.error(t),e.action.showAlert()}else e.action.showAlert()}onDialRotate(e){const{settings:t}=e.payload,n=t.adjustValue;this.setUpdateBlocked(e.action.id,e.action);if(""!==this.getIdentifier(t))try{this.adjustValue(t,n*e.payload.ticks)}catch(t){console.error(t),e.action.showAlert()}else e.action.showAlert()}onDialDown(e){const{settings:t}=e.payload;if(""!==this.getIdentifier(t))try{this.setMute(t)}catch(t){console.error(t),e.action.showAlert()}else e.action.showAlert()}setMute(e,t){throw new Error('"setMute" method not implemented.')}setValue(e){throw new Error('"setValue" method not implemented.')}adjustValue(e,t){throw new Error('"adjustValue" method not implemented.')}adjustValueLongPress(e,t,n){this.adjustValue(t,n),this.longPressTimer.set(e,setTimeout(()=>this.adjustValueLongPress(e,t,n),200))}updatePI(e){console.log("updatePI not implemented.")}async setImage(e,t=!1){const n=this.actionMap.get(e);if(io.isAppConnected(),null==n)return;const i=this.getData(n);try{switch(n.actionSubtype){case qs.Toggle:const t=this.getKeyPayloads(n);t.length>0&&oo.setImage(e,t[0],t[1]);break;case qs.Set:{const t=this.getKeyPayloads(n);t.length>0&&oo.setImage(e,t[0])}break;case qs.Adjust:if(n.actionStyle==Hs.Static){const t=this.getKeyPayloads(n);t.length>0&&oo.setImage(e,t[0],t[1])}else{const t=io,s=i?.id??"";let o=t.getLevelMeterOfId(this.getSubscriptionType(n),s,this.getSubIdentifier(n));void 0===o&&void 0===this.lastLevelMeters.get(s)&&this.lastLevelMeters.set(s,{id:s,levelLeftPercentage:0,levelRightPercentage:0}),void 0===o?o=this.lastLevelMeters.get(s):this.lastLevelMeters.set(s,o);const r=i?.name??"--",a=i?.value??0,c=i?.maxRange??100,l=n?.adjustValue>0,u=Math.round(100*(o?.levelLeftPercentage??0)),d=this.getKeyPayloads(n);switch(n.actionStyle){case Hs.SliderHorizontal:{const t={sliderMask:{value:`<mask id="slider"><rect width="${a/c*240}" height="12" fill="white"/></mask>`},handle:{offset:[a/c*228,0,0,0]},icon:{value:d[0].icon.value},iconMix:{value:d[0].iconMix?.value??""},number:{value:d[0]?.number?.value,isEnabled:d[0]?.number?.isEnabled??!1},title:{value:r,offset:d[0]?.number?.isEnabled?[23,0,0,0]:[0,0,0,0]}};oo.setImage(e,t,void 0,{ViewBox:[l?144:0,0,144,144]})}break;case Hs.SliderVertical:{const t={sliderMask:{value:`<mask id="slider"><g transform="rotate(180 10 200)"><rect y="200" width="20" height="${a/c*200}" fill="white"/></g></mask>`},handle:{offset:[0,(c-a)/c*188,0,0]},icon:{value:d[0].icon.value,offset:d[0]?.number?.isEnabled?[-11.5,0,0,0]:[0,0,0,0]},iconMix:{value:d[0].iconMix?.value??"",offset:d[0]?.number?.isEnabled?[14.5,0,0,0]:[0,0,0,0]},number:{value:d[0]?.number?.value,isEnabled:d[0]?.number?.isEnabled??!1}};oo.setImage(e,t,void 0,{ViewBox:[0,l?0:144,144,144]})}break;case Hs.SliderAndLevelmeterHorizontal:{const t={levelMeterMask:{value:`<mask id="level"><rect width="${Math.floor(u/c*13)*(240/13)}" height="12" fill="white"/></mask>`},sliderMask:{value:`<mask id="slider"><rect width="${a/c*240}" height="12" fill="white"/></mask>`},handle:{offset:[a/c*228,0,0,0]},icon:{value:d[0].icon.value},iconMix:{value:d[0].iconMix?.value??""},number:{value:d[0]?.number?.value,isEnabled:d[0]?.number?.isEnabled??!1},title:{value:r,offset:d[0]?.number?.isEnabled?[23,0,0,0]:[0,0,0,0]}};oo.setImage(e,t,void 0,{ViewBox:[l?144:0,0,144,144]})}break;case Hs.SliderAndLevelmeterVertical:{const t={levelMeterMask:{value:`<mask id="level"><g transform="rotate(180 10 200)"><rect y="200" width="20" height="${Math.floor(u/c*13)*(200/13)}" fill="white"/></g></mask>`},sliderMask:{value:`<mask id="slider"><g transform="rotate(180 10 200)"><rect y="200" width="20" height="${a/c*200}" fill="white"/></g></mask>`},handle:{offset:[0,(c-a)/c*188,0,0]},icon:{value:d[0].icon.value,offset:d[0]?.number?.isEnabled?[-11.5,0,0,0]:[0,0,0,0]},iconMix:{value:d[0].iconMix?.value??"",offset:d[0]?.number?.isEnabled?[14.5,0,0,0]:[0,0,0,0]},number:{value:d[0]?.number?.value,isEnabled:d[0]?.number?.isEnabled??!1}};oo.setImage(e,t,void 0,{ViewBox:[0,l?0:144,144,144]})}}}}}catch(e){console.error(e)}}setImageLayout(e,t){if(void 0===t)return;const n=this.getKeyLayout(t);n.length>1&&oo.setImageLayout(e,n[0],n[1])}async setState(e){const t=this.actionMap.get(e);if(null==t)return;let n=0;switch(t.actionSubtype){case qs.Toggle:n=Number(this.getData(t)?.isMuted)??0;break;case qs.Adjust:t.actionStyle===Hs.Static&&(n=t?.adjustValue>0?0:1)}e.setState(n)}async setFeedback(e,t=!1){if(e.isDial()){const n=io,i=this.actionMap.get(e);if(void 0===i)return;io.isAppConnected();const s={},o=this.getIdentifier(i),r=this.getData(i),a=r?.name??"--",c=r?.value??0,l=r?.maxRange??100,u=r?.isMuted??!1;let d="black",h=-1;if(this.useLevelmeter(e.id,i?.actionStyle)){let e=n.getLevelMeterOfId(this.getSubscriptionType(i),o,this.getSubIdentifier(i));void 0===e&&void 0===this.lastLevelMeters.get(o)&&this.lastLevelMeters.set(o,{id:o,levelLeftPercentage:0,levelRightPercentage:0}),void 0===e?e=this.lastLevelMeters.get(o):this.lastLevelMeters.set(o,e),void 0===e||t||(d="url(#levelMeterGradient)",h=130*(1-(e?.levelLeftPercentage??0)))}else d="white",h=(l-c)/l*130;const p=c/l*120-60;h>=0&&(s.image=`data:image/svg+xml;base64,${btoa(`\n                    <svg width="200" height="100" viewBox="0 0 200 100" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <defs>\n                            <mask id="cut-bottom">\n                                <path transform="rotate(${-h} 65 65)" fill="white" d="M22.8308 44.4327C21.7971 43.9285 21.3639 42.6793 21.9116 41.6679C25.9469 34.2156 31.8528 27.926 39.063 23.4275C46.863 18.5611 55.8748 15.9872 65.0684 16C74.262 16.0129 83.2666 18.6119 91.053 23.5001C98.2506 28.0187 104.139 34.3248 108.153 41.7883C108.698 42.8012 108.262 44.0493 107.226 44.5506C106.191 45.0519 104.95 44.6164 104.401 43.6056C100.73 36.8445 95.3742 31.1306 88.8385 27.0276C81.7139 22.5549 73.4748 20.1768 65.0626 20.165C56.6504 20.1533 48.4047 22.5084 41.2676 26.9612C34.7205 31.0459 29.3487 36.7448 25.6587 43.4956C25.107 44.5049 23.8646 44.9369 22.8308 44.4327Z"/>\n                            </mask>\n                            <linearGradient id="levelMeterGradient" x1="16" y1="65" x2="114" y2="65" gradientUnits="userSpaceOnUse">\n                                <stop stop-color="#3BB455"/>\n                                <stop offset="0.6" stop-color="#3BB455"/>\n                                <stop offset="0.8" stop-color="#FBDB00"/>\n                                <stop offset="0.95" stop-color="#FF3C4E"/>\n                            </linearGradient>\n\n                            <radialGradient id="paint1_radial_280_24180" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse" gradientTransform="translate(81 113) rotate(-90) scale(40)">\n                                <stop/>\n                                <stop offset="1" stop-color="#232323"/>\n                            </radialGradient>\n                            <linearGradient id="paint2_linear_280_24180" x1="81" y1="79" x2="81" y2="99.5" gradientUnits="userSpaceOnUse">\n                                <stop stop-color="#2A2A2A"/>\n                                <stop offset="1" stop-color="#909090"/>\n                            </linearGradient>\n                        </defs>\n\n                        <g id="levelMeter" transform="translate(16, 48)">\n                            <path id="levelBackground" d="M22.8308 44.4327C21.7971 43.9285 21.3639 42.6793 21.9116 41.6679C25.9469 34.2156 31.8528 27.926 39.063 23.4275C46.863 18.5611 55.8748 15.9872 65.0684 16C74.262 16.0129 83.2666 18.6119 91.053 23.5001C98.2506 28.0187 104.139 34.3248 108.153 41.7883C108.698 42.8012 108.262 44.0493 107.226 44.5506C106.191 45.0519 104.95 44.6164 104.401 43.6056C100.73 36.8445 95.3742 31.1306 88.8385 27.0276C81.7139 22.5549 73.4748 20.1768 65.0626 20.165C56.6504 20.1533 48.4047 22.5084 41.2676 26.9612C34.7205 31.0459 29.3487 36.7448 25.6587 43.4956C25.107 44.5049 23.8646 44.9369 22.8308 44.4327Z" fill="#171717"/>\n                            <path id="levelmeter" mask="url(#cut-bottom)" d="M22.8308 44.4327C21.7971 43.9285 21.3639 42.6793 21.9116 41.6679C25.9469 34.2156 31.8528 27.926 39.063 23.4275C46.863 18.5611 55.8748 15.9872 65.0684 16C74.262 16.0129 83.2666 18.6119 91.053 23.5001C98.2506 28.0187 104.139 34.3248 108.153 41.7883C108.698 42.8012 108.262 44.0493 107.226 44.5506C106.191 45.0519 104.95 44.6164 104.401 43.6056C100.73 36.8445 95.3742 31.1306 88.8385 27.0276C81.7139 22.5549 73.4748 20.1768 65.0626 20.165C56.6504 20.1533 48.4047 22.5084 41.2676 26.9612C34.7205 31.0459 29.3487 36.7448 25.6587 43.4956C25.107 44.5049 23.8646 44.9369 22.8308 44.4327Z" fill="${d}"/>\n                        </g>\n\n                        <g transform="translate(80.5, 78)">\n                            <g transform="rotate(${p}, 0, 36)" transform-origin="bottom-left">\n                                <rect width="2" height="14" rx="1" fill="#C5C5C5"/>\n                                <rect width="2" height="14" rx="1" fill-opacity="0.04"/>\n                            </g>\n                        </g>\n                    </svg>\n                `)}`);const f=this.getIcon(i);let v="";v=f.includes(".svg")?f:`data:image/svg+xml;base64,${f}`,s.icon=""!==f?{value:v,enabled:!0}:{value:"./imgs/actions/channelLevel/blank.svg"},s.title=a,s.number=void 0!==r?.appCount&&r?.appCount>1?{value:`./imgs/actions/channelLevel/icons/plus${r.appCount-1}.svg`,enabled:!0}:{enabled:!1},s.value={enabled:!u,value:r?.label??c},""!==this.getUnit(i)&&(s.unit={value:this.getUnit(i),enabled:!u}),this.subscriptionType===to.Channel?s.iconSmall={value:this.getIconSmall(i),enabled:void 0!==r}:s.iconSmall={enabled:!1},s.muteOverlay={enabled:u},e.setFeedback(s)}}useLevelmeter(e,t){switch(t){case Hs.SliderAndLevelmeterHorizontal:case Hs.LevelmeterHorizontal:return null==this.isUpdatedBlocked(e);default:return!1}}loadSvgContent(e,t=0){if(void 0===e||""===e)return"";const n=g.readFileSync(e,"utf-8").toString();return Number(n.match(/width="[0-9]+/i)?.toString().replace('width="',"")),n.substring(n.indexOf(">")+1,n.lastIndexOf("</")-1)}loadSvg(e){return void 0===e||""===e?"":g.readFileSync(e,"utf-8").toString()}getIdentifier(e){throw new Error('"getIdentifier" method not implemented.')}getSubIdentifier(e){return""}getData(e){throw new Error('"getData" method not implemented.')}getKeyPayloads(e){const t=this.getData(e),n="white",i=io.isAppConnected()&&""!==t?.id?"1":"0.33",s=t?.appCount??1,o={background:{isEnabled:!1},backgroundUnmuted:{isEnabled:!1},modifier:{value:"",isEnabled:!1,offset:[s>1?-6.5:0,0,0,0],opacity:i},icon:{value:this.getIcon(e),offset:[s>1?-6.5:0,0,0,0],opacity:i},iconMix:{value:this.getIconSmall(e),opacity:i},number:{value:`./imgs/actions/channelLevel/icons/plus${s-1}.svg`,isEnabled:s>1},value:{value:"--",opacity:i}},r={background:{isEnabled:!1},backgroundMuted:{isEnabled:!1},modifier:{value:"",isEnabled:!1,offset:[s>1?-6.5:0,0,0,0],opacity:i},icon:{value:this.getIcon(e),offset:[s>1?-6.5:0,0,0,0],opacity:i},iconMix:{value:this.getIconSmall(e),color:n,opacity:i},number:{value:`./imgs/actions/channelLevel/icons/plus${s-1}.svg`,isEnabled:s>1},value:{value:"--",color:n,opacity:i}};switch(e.actionSubtype){case qs.Toggle:o.backgroundUnmuted.isEnabled=!0,r.backgroundMuted.isEnabled=!0,o.value.value=void 0!==t?`${t.value}%`:"--",r.value.value=void 0!==t?`${t.value}%`:"--",r.value.color="#FF3C4E",r.iconMix.color="#FF3C4E";break;case qs.Set:return o.background.isEnabled=!0,o.modifier.isEnabled=!0,o.modifier.value="./imgs/actions/common/modifier/set.svg",o.value.value=`${e.setValue}%`,[o];case qs.Adjust:const n=e.adjustValue;o.background.isEnabled=!0,o.modifier.isEnabled=!0,o.modifier.value="./imgs/actions/common/modifier/increase.svg",o.value.value=`${n>0?n:n-1}%`,r.background.isEnabled=!0,r.modifier.isEnabled=!0,r.modifier.value="./imgs/actions/common/modifier/decrease.svg",r.value.value=`${n>0?n:n-1}%`}return[o,r]}getKeyLayout(e){return[]}getIcon(e){return""}getIconSmall(e){return""}getUnit(e){return""}updateImage(e){switch(e.actionSubtype){case qs.Set:return!1;case qs.Adjust:return e.actionStyle!==Hs.Static;default:return!0}}updateState(e){return e.actionSubtype===qs.Toggle}showLevelMeter(e){switch(e){case Hs.LevelmeterHorizontal:case Hs.LevelmeterVertical:case Hs.SliderAndLevelmeterHorizontal:case Hs.SliderAndLevelmeterVertical:return!0;default:return!1}}getSubscriptionType(e){return this.subscriptionType}setSubscription(e,t,n,i=""){if(""===t)return;"all"===i&&(i="");let s=this.levelMeterCounter.get(t+i)??0;void 0!==e&&void 0!==t&&io.isAppConnected()&&((n&&0===s||!n&&1===s)&&(""!==i?io.setSubscription({levelMeterChanged:{id:t,subId:i,isEnabled:n,type:e}}):io.setSubscription({levelMeterChanged:{id:t,isEnabled:n,type:e}})),s+=n?1:-1,this.levelMeterCounter.set(t+i,s<=0?0:s))}}function lo(e,t,n){return e<t?t:e>n?n:e}function uo(e,t){const n=Math.pow(10,t);return Math.round(e*n)/n}var ho,po,fo;!function(e){e.Wave="./imgs/actions/waveControl/icons/wave.svg",e.WaveNeo="./imgs/actions/waveControl/icons/waveNeo.svg",e.WaveXLR="./imgs/actions/waveControl/icons/waveXLR.svg",e.WaveXLRDock="./imgs/actions/waveControl/icons/waveXLRDock.svg"}(ho||(ho={})),function(e){e.Gain="Gain",e.OutputVolume="OutputVolume",e.MicPcMix="MicPcMix"}(po||(po={})),function(e){e.Gain="./imgs/actions/waveControl/gain.svg",e.GainMuted="./imgs/actions/waveControl/gainMuted.svg",e.OutputVolume="./imgs/actions/waveControl/outputVolume.svg",e.OutputVolumeMuted="./imgs/actions/waveControl/outputVolume.svg",e.MicPcMix="./imgs/actions/waveControl/micPcMix.svg",e.MicPcMixMuted="./imgs/actions/waveControl/micPcMix.svg"}(fo||(fo={}));let vo=(()=>{let e,t,n,i=[st({UUID:"com.elgato.wave-link.wavecontrol"})],s=[],o=co,r=[];return class extends o{static{t=this}static{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(o[Symbol.metadata]??null):void 0;n=[Ji("OutputDevices")],ct(this,null,n,{kind:"method",name:"outputDevices",static:!1,private:!1,access:{has:e=>"outputDevices"in e,get:e=>e.outputDevices},metadata:a},null,r),ct(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),lt(t,s)}constructor(){super(to.Input,[Qs.InputDeviceChanged,Qs.OutputDeviceChanged]),lt(this,r),io.eventEmitter.on(Qs.InputDeviceChanged,e=>{this.actionMap.forEach((e,t)=>{t.isKey()?(this.setImage(t),this.setState(t)):this.setFeedback(t)})})}outputDevices(){return io.outputDevices?.filter(e=>e.type!==eo.NoWaveDevice).map(e=>new Vi(e.name,e.id))??[]}async onAppear(e){const{settings:t}=e.payload;if(!mo.safeParse(e.payload.settings).success){const n=io.inputDevices?.filter(e=>e.type!==eo.NoWaveDevice).at(0),i=io.outputDevices?.filter(e=>e.type!==eo.NoWaveDevice).at(0);t.inputDeviceId=n?.id??"",t.inputId=n?.inputs?.at(0)?.id??"",t.outputDeviceId=i?.id??"",t.outputId=i?.outputs?.at(0)?.id??"",t.actionType=po.Gain,t.setValue=100,t.adjustValue=5,t.actionSubtype=e.action.isDial()?qs.Adjust:qs.Toggle,t.actionStyle=e.action.isDial()?Hs.SliderAndLevelmeterHorizontal:Hs.Static,t.multiActionState=-1,await e.action.setSettings(t)}}onDidReceiveSettings(e){const t=this.actionMap.get(e.action),n=e.payload.settings,i=t?.inputDeviceId!==n.inputDeviceId,s=t?.outputDeviceId!==n.outputDeviceId;if(super.onDidReceiveSettings(e),i){const e=io.getInputDeviceById(n.inputDeviceId);n.inputId=e?.inputs?.at(0)?.id??""}else if(s){const e=io.getOutputDeviceById(n.outputDeviceId);n.outputId=e?.outputs?.at(0)?.id??""}(i||s)&&e.action.setSettings(n)}onPIDidAppear(e){this.actionMap.forEach((t,n)=>{n.id===e.action.id&&this.updatePI(t)})}getData(e){const t=io.getInputById(e.inputDeviceId,e.inputId),n=io.getOutputById(e.outputDeviceId,e.outputId);switch(e.actionType){case po.Gain:if(void 0===t)return;return{id:t.id,name:t.name,isMuted:t.isMuted,value:t.gain.value*t.gain.max,maxRange:t.gain.max,label:Math.round(t.gain.value*t.gain.max)};case po.OutputVolume:{if(void 0===n)return;const e=Math.round(100*n.level);return{id:n.id,name:n.name,isMuted:n.isMuted,value:e,label:e}}case po.MicPcMix:{if(void 0===t)return;const e=Math.round(100*t.micPcMix);return{id:t.id,name:t.name,isMuted:t.isMuted,value:e,label:e}}default:return}}getIdentifier(e){switch(e.actionType){case po.Gain:case po.MicPcMix:return e.inputDeviceId;case po.OutputVolume:return e.outputDeviceId;default:return""}}getIcon(e,t=0){switch(e.actionType){case po.Gain:return 0===t?fo.Gain:fo.GainMuted;case po.OutputVolume:return 0===t?fo.OutputVolume:fo.OutputVolumeMuted;case po.MicPcMix:return 0===t?fo.MicPcMix:fo.MicPcMixMuted;default:return""}}getIconSmall(e){switch(io.getInputDeviceById(e.inputDeviceId)?.type){case eo.Wave1:case eo.Wave3:return ho.Wave;case eo.WaveNeo:return ho.WaveNeo;case eo.WaveXLR:case eo.WaveXLRMk2:return ho.WaveXLR;case eo.WaveXLRDock:case eo.WaveXLRMk2Dock:return ho.WaveXLRDock;default:return""}}getKeyPayloads(e){const t=this.getData(e),n={background:{isEnabled:!1},backgroundUnmuted:{isEnabled:!1},modifier:{value:"",isEnabled:!1},icon:{value:this.getIcon(e)},value:{value:"--",isEnabled:!0},title:{value:"--",isEnabled:!1}},i={background:{isEnabled:!1},backgroundMuted:{isEnabled:!1},modifier:{value:"",isEnabled:!1},icon:{value:this.getIcon(e),color:"white"},value:{value:"--",isEnabled:!0},title:{value:"--",isEnabled:!1}};switch(e.actionSubtype){case qs.Toggle:n.backgroundUnmuted.isEnabled=!0,i.backgroundMuted.isEnabled=!0,i.icon.value=this.getIcon(e,1),i.icon.color="#FF3C4E",n.value.value=void 0!==t?`${t.label}${this.getUnit(e)}`:"--",i.value.value=void 0!==t?`${t.label}${this.getUnit(e)}`:"--";break;case qs.Set:return n.background.isEnabled=!0,n.modifier.isEnabled=!0,n.modifier.value="./imgs/actions/common/modifier/set.svg",n.value.value=`${e.setValue}${this.getUnit(e)}`,[n,void 0];case qs.Adjust:const s=e.adjustValue;n.background.isEnabled=!0,n.modifier.isEnabled=!0,n.modifier.value="./imgs/actions/common/modifier/increase.svg",n.value.value=`${s>0?s:s-1}${this.getUnit(e)}`,i.background.isEnabled=!0,i.modifier.isEnabled=!0,i.modifier.value="./imgs/actions/common/modifier/decrease.svg",i.value.value=`${s>0?s:s-1}${this.getUnit(e)}`}return[n,i]}getKeyLayout(e){let t="",n="";switch(e.actionSubtype){case qs.Toggle:t="com.elgato.wave-link.controlaction",n="com.elgato.wave-link.controlaction";break;case qs.Set:t="com.elgato.wave-link.controlaction";break;case qs.Adjust:switch(e.actionStyle){case Hs.Static:t="com.elgato.wave-link.controlaction",n="com.elgato.wave-link.controlaction";break;case Hs.SliderHorizontal:t="com.elgato.wave-link.mixsliderhorizontal";break;case Hs.SliderVertical:t="com.elgato.wave-link.mixslidervertical";break;case Hs.SliderAndLevelmeterHorizontal:t="com.elgato.wave-link.mixlevelmeterhorizontal";break;case Hs.SliderAndLevelmeterVertical:t="com.elgato.wave-link.mixlevelmetervertical"}}return[t,n]}getUnit(e){switch(e.actionType){case po.Gain:return" dB";case po.OutputVolume:case po.MicPcMix:return"%";default:return""}}setMute(e,t){switch(e.actionType){case po.Gain:case po.MicPcMix:{const n=io.getInputById(e.inputDeviceId,e.inputId);io.setInputDevice({id:e.inputDeviceId,inputs:[{id:e.inputId,isMuted:null==t?!n?.isMuted:t}]})}break;case po.OutputVolume:{const n=io.getOutputById(e.outputDeviceId,e.outputId);io.setOutputDevice({outputDevice:{id:e.outputDeviceId,outputs:[{id:e.outputId,isMuted:null==t?!n?.isMuted:t}]}})}}}setValue(e){switch(e.actionType){case po.Gain:{const t=this.getData(e);if(void 0===t?.maxRange)return;io.setInputDevice({id:e.inputDeviceId,inputs:[{id:e.inputId,gain:{value:e.setValue/t.maxRange}}]})}break;case po.OutputVolume:void 0!==io.getOutputById(e.outputDeviceId,e.outputId)&&io.setOutputDevice({outputDevice:{id:e.outputDeviceId,outputs:[{id:e.outputId,level:e.setValue/100}]}});break;case po.MicPcMix:io.setInputDevice({id:e.inputDeviceId,inputs:[{id:e.inputId,micPcMix:e.setValue/100}]})}}adjustValue(e,t){switch(e.actionType){case po.Gain:{const n=this.getData(e);if(void 0===n||void 0===n.maxRange)return;io.setInputDevice({id:e.inputDeviceId,inputs:[{id:e.inputId,gain:{value:uo(lo((n?.value+t)/n.maxRange,0,1),4)}}]})}break;case po.OutputVolume:{const n=io.getOutputById(e.outputDeviceId,e.outputId);void 0!==n&&io.setOutputDevice({outputDevice:{id:e.outputDeviceId,outputs:[{id:e.outputId,level:uo(lo(n.level+t/100,0,1),2)}]}})}break;case po.MicPcMix:{const n=io.getInputById(e.inputDeviceId,e.inputId);void 0!==n&&io.setInputDevice({id:e.inputDeviceId,inputs:[{id:e.inputId,micPcMix:uo(lo(n?.micPcMix+t/100,0,1),2)}]})}}}getSubscriptionType(e){return e.actionType===po.OutputVolume?to.Output:to.Input}updatePI(e){switch(e.actionType){case po.Gain:const t=io.getInputById(e.inputDeviceId,e.inputId);void 0!==t&&at.ui.sendToPropertyInspector({event:"valueRange",minRange:t.gain?.min,totalRange:t.gain?.max});break;case po.OutputVolume:case po.MicPcMix:at.ui.sendToPropertyInspector({event:"valueRange",minRange:0,totalRange:100})}}getIndexOf(e,t,n,i,s){if(n<t)return-1;const o=t+Math.floor((n-t)/2);return e[o][s]===i?o:e[o][s]>i?this.getIndexOf(e,t,o-1,i,s):this.getIndexOf(e,o+1,n,i,s)}getLastValidIndexOf(e,t,n,i,s){const o=t+Math.floor((n-t)/2);return e[o][s]===i?o:e[o][s]>i?o-1<t?o:this.getLastValidIndexOf(e,t,o-1,i,s):n<o+1?o:this.getLastValidIndexOf(e,o+1,n,i,s)}},t})();const mo=Ws({inputDeviceId:Rs(),inputId:Rs(),outputDeviceId:Rs(),outputId:Rs(),actionType:Rs(),actionSubtype:Rs(),actionStyle:Xs,setValue:Fs(),adjustValue:Fs(),multiActionState:Ks(Fs())});class go extends so{userTitles=new Map;constructor(e){super(),io.eventEmitter.on(e,e=>{const{id:t}=e;this.actionMap.forEach((e,n)=>{this.getIdentifier(e)===t&&(n.isKey()&&this.setState(n),at.ui.action?.id===n.id&&this.updatePI())})}),io.eventEmitter.on(Qs.AppConnected,()=>{this.actionMap.forEach((e,t)=>{t.isKey()?(this.setImage(t),this.setState(t)):this.setFeedback(t)})}),io.eventEmitter.on(Qs.AppDisconnected,()=>{this.actionMap.forEach((e,t)=>{t.isKey()?(this.setImage(t),this.setState(t)):this.setFeedback(t)})})}onDidReceiveSettings(e){this.actionMap.get(e.action)!=e.payload.settings&&(this.actionMap.set(e.action,e.payload.settings),e.action.isDial()?this.setFeedback(e.action,!0):(this.setImage(e.action,!0),this.setState(e.action)))}onTitleParametersDidChange(e){e.action.isKey()&&(this.userTitles.set(e.action.id,e.payload.title),this.setImage(e.action))}onKeyDown(e){const{settings:t}=e.payload;if(void 0!==t)if(e.action.isInMultiAction()){const{multiActionState:n}=e.payload.settings;this.toggleValue(t,-1===n?void 0:Boolean(n))}else this.toggleValue(t)}async setState(e){const t=this.actionMap.get(e);if(null==t)return;const n=this.getState(t);void 0!==n?e.setState(Number(n)):e.setState(0)}getIdentifier(e){return console.error('"getIdentifier" method not implemented.'),""}toggleValue(e,t){console.log("toggleValue not implemented.")}getState(e){return console.log("getState not implemented."),!1}updatePI(){console.log("updatePI not implemented.")}}let yo=(()=>{let e,t,n=[st({UUID:"com.elgato.wave-link.gainlock"})],i=[],s=go;return class extends s{static{t=this}static{const o="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ct(null,e={value:t},n,{kind:"class",name:t.name,metadata:o},null,i),t=e.value,o&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o}),lt(t,i)}constructor(){super(Qs.InputDeviceChanged)}async onAppear(e){const{settings:t}=e.payload;bo.safeParse(e.payload.settings).success||(t.inputDeviceId=io.getInputDeviceList().at(0)?.id??"",t.inputId=io.getInputDeviceList().at(0)?.inputs?.at(0)?.id??"",t.multiActionState=-1,await e.action.setSettings(t))}async onKeyDown(e){const{settings:t}=e.payload,n=io,i=n.getInputById(t.inputDeviceId,"");if(void 0===i)return void e.action.showAlert();let s;e.action.isInMultiAction()&&(s=Boolean(e.payload.settings.multiActionState)),n.setInputDevice({id:i.id,inputs:[{id:t.inputDeviceId,isGainLockOn:s??!i.isGainLockOn}]})}setImage(e){const t=this.actionMap.get(e);if(void 0===t)return;const n=io.getInputById(t.inputDeviceId,t.inputId);let i={title:{value:"Gain Lock"},name:{value:oo.truncate(n?.name??"",13)}};oo.setImage(e,i,i)}getState(e){const t=io.getInputById(e.inputDeviceId,e.inputId);return!t?.isGainLockOn}getIdentifier(e){return e.inputDeviceId}},t})();const bo=Ws({inputDeviceId:Rs(),inputId:Rs(),multiActionState:Ks(Fs())});let _o=(()=>{let e,t,n,i=[st({UUID:"com.elgato.wave-link.audioeffect"})],s=[],o=go,r=[];return class extends o{static{t=this}static{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(o[Symbol.metadata]??null):void 0;n=[Ji("Effects")],ct(this,null,n,{kind:"method",name:"effects",static:!1,private:!1,access:{has:e=>"effects"in e,get:e=>e.effects},metadata:a},null,r),ct(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),lt(t,s)}constructor(){super(Qs.InputDeviceChanged),lt(this,r)}async effects(){const e=at.ui.action;if(void 0===e)return[];const t=await e.getSettings();if(void 0!==t.inputDeviceId){const e=io.getInputById(t.inputDeviceId,t.inputId);if(void 0===e)return[];const n=e.dspEffects?.map(e=>new Vi(e.name,e.id))??[],i=e.effects?.map(e=>new Vi(e.name,e.id))??[];return n.concat(i)}return[]}async onAppear(e){const{settings:t}=e.payload;if(!wo.safeParse(e.payload.settings).success){const n=io.getInputDeviceList().filter(e=>e.type!==eo.NoWaveDevice).at(0);t.inputDeviceId=n?.id??"",t.inputId=n?.inputs?.at(0)?.id??"",t.effectId=n?.inputs?.at(0)?.dspEffects?.at(0)?.id??"",t.multiActionState=-1,await e.action.setSettings(t)}}async onDidReceiveSettings(e){const t=this.actionMap.get(e.action),n=e.payload.settings;if(t?.inputDeviceId!==n.inputDeviceId){const t=io.getInputDeviceById(n.inputDeviceId);n.inputId=t?.inputs?.at(0)?.id??"",n.effectId=t?.inputs?.at(0)?.dspEffects?.at(0)?.id??"",await e.action.setSettings(n),this.updatePI()}super.onDidReceiveSettings(e)}setImage(e,t){const n=this.actionMap.get(e);if(void 0===n)return;const i=io.getInputById(n.inputDeviceId,n.inputId);let s=this.userTitles.get(e.id);if(void 0===s||""===s){const e=i?.dspEffects?.find(e=>e.id===n.effectId)||i?.effects?.find(e=>e.id===n.effectId);s=e?.name??"--"}let o={title:{value:oo.truncate(s,11)},name:{value:oo.truncate(i?.name??"",13)}};oo.setImage(e,o,o)}toggleValue(e,t){const n=io.getInputById(e.inputDeviceId,e.inputId),i=n?.effects?.find(t=>t.id===e.effectId),s=n?.dspEffects?.find(t=>t.id===e.effectId),o=i??s;void 0!==o&&io.setInputDevice({id:e.inputDeviceId,inputs:[{id:e.inputId,[void 0!==i?"effects":"dspEffects"]:[{id:e.effectId,isEnabled:void 0===t?!o.isEnabled:t}]}]})}getState(e){const t=io.getInputById(e.inputDeviceId,e.inputId),n=t?.dspEffects?.find(t=>t.id===e.effectId)||t?.effects?.find(t=>t.id===e.effectId);return void 0!==n?.isEnabled&&!n.isEnabled}getIdentifier(e){return e.inputDeviceId}async updatePI(){void 0!==at.ui.action&&Xi.notify("Effects",await this.effects())}},t})();const wo=Ws({inputDeviceId:Rs(),inputId:Rs(),effectId:Rs(),multiActionState:Ks(Fs())}),So="foregroundApp";let Io=(()=>{let e,t,n,i,s=[st({UUID:"com.elgato.wave-link.channellevel"})],o=[],r=co,a=[];return class extends r{static{t=this}static{const c="function"==typeof Symbol&&Symbol.metadata?Object.create(r[Symbol.metadata]??null):void 0;n=[Ji("Channels")],i=[Ji("ChannelMixes")],ct(this,null,n,{kind:"method",name:"channels",static:!1,private:!1,access:{has:e=>"channels"in e,get:e=>e.channels},metadata:c},null,a),ct(this,null,i,{kind:"method",name:"channelMixes",static:!1,private:!1,access:{has:e=>"channelMixes"in e,get:e=>e.channelMixes},metadata:c},null,a),ct(null,e={value:t},s,{kind:"class",name:t.name,metadata:c},null,o),t=e.value,c&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:c}),lt(t,o)}lastChannelId=(lt(this,a),new Map);constructor(){super(to.Channel,Qs.ChannelChanged),this.iconSmallPaths=ro,io.eventEmitter.on(Qs.ChannelsChanged,()=>{Xi.notify("Channels",this.channels())}),io.eventEmitter.on(Qs.AppConnected,()=>{this.actionMap.forEach((e,t)=>{e.channelId===So&&io.subscribe(Ys.FocusedAppChanged)})}),io.eventEmitter.on(Qs.AppDisconnected,()=>{this.actionMap.forEach((e,t)=>{e.channelId===So&&io.unsubscribe(Ys.FocusedAppChanged)})}),io.eventEmitter.on(Qs.FocusedAppChanged,()=>{this.actionMap.forEach((e,t)=>{if(this.showLevelMeter(e.actionStyle)){const e=io.focusedApp?.channel?.id,n=this.lastChannelId.get(t.id);this.setSubscription(this.subscriptionType,e??n??"",void 0!==e),void 0!==e&&void 0!==n&&e!==n&&this.setSubscription(this.subscriptionType,n,!1),void 0===e?this.lastChannelId.delete(t.id):this.lastChannelId.set(t.id,e)}t.isKey()?(this.setImage(t),this.setState(t)):this.setFeedback(t)})})}channels(){return[new Vi("Foreground App",So)].concat(io.getChannelList().map(e=>new Vi(e.name,e.id)))}async channelMixes(){const e=at.ui.action;if(void 0===e)return[];const t=await e.getSettings(),n=[new Vi("All","all")];if(t?.channelId===So)return n.concat(io.mixes.map(e=>new Vi(e.name,e.id)));if(void 0!==t.channelId){const e=io.getChannelById(t.channelId);return void 0===e?[]:(e.mixes.forEach(e=>{let t=io.mixes.find(t=>t.id==e.id);void 0!==t&&n.push(new Vi(t.name,t.id))}),n)}return[]}async onAppear(e){const{settings:t}=e.payload;ko.safeParse(e.payload.settings).success||(t.channelId=io.channels?.length>0?io.channels[0].id:"",t.mixId="all",t.setValue=100,t.adjustValue=5,t.actionSubtype=e.action.isDial()?qs.Adjust:qs.Toggle,t.actionStyle=e.action.isDial()?Hs.SliderAndLevelmeterHorizontal:Hs.Static,t.multiActionState=-1,await e.action.setSettings(t)),t.channelId===So&&io.subscribe(Ys.FocusedAppChanged)}onDisappear(e){e.payload.settings.channelId===So&&io.unsubscribe(Ys.FocusedAppChanged)}setFeedbackLayout(e){const t=this.actionMap.get(e);if(void 0!==t){const n=this.getChannelbySetting(t);n?.apps?.length?e.setFeedbackLayout("./ui/layouts/controlActionMultiApps.json"):e.setFeedbackLayout("./ui/layouts/controlAction.json")}}getIdentifier(e){return e.channelId===So?io.focusedApp?.channel?.id??"":e.channelId??""}getSubIdentifier(e){return e.mixId??"all"}getData(e){const t=this.getChannelbySetting(e);if(void 0!==t){const n=t.apps?.length??0;if(void 0!==e.mixId&&"all"!==e.mixId){const i=t.mixes.find(t=>t.id===e.mixId);return{id:t.id,isMuted:i?.isMuted??!1,value:Math.round(100*(i?.level??0)),name:t.name,appCount:n}}return{id:t.id,isMuted:t.isMuted,value:Math.round(100*t.level),name:t.name,appCount:n}}return{id:"",isMuted:!1,value:0,name:"--"}}getKeyLayout(e){let t="",n="";switch(e.actionSubtype){case qs.Toggle:t="com.elgato.wave-link.channellevel",n="com.elgato.wave-link.channellevel";break;case qs.Set:t="com.elgato.wave-link.channellevel";break;case qs.Adjust:switch(e.actionStyle){case Hs.Static:t="com.elgato.wave-link.channellevel",n="com.elgato.wave-link.channellevel";break;case Hs.SliderHorizontal:t="com.elgato.wave-link.channelsliderhorizontal";break;case Hs.SliderVertical:t="com.elgato.wave-link.channelslidervertical";break;case Hs.SliderAndLevelmeterHorizontal:t="com.elgato.wave-link.channellevelmeterhorizontal";break;case Hs.SliderAndLevelmeterVertical:t="com.elgato.wave-link.channellevelmetervertical"}}return[t,n]}getIcon(e){const t=this.getChannelbySetting(e);return void 0!==t?.image?.imgData?t.image.imgData:void 0!==t?.image?.name?ao.get(t.image.name)??ro.get(t.image.name)??"":"./imgs/actions/channelLevel/icon.svg"}getIconSmall(e){let t="all";return void 0!==this.getChannelbySetting(e)&&"all"!==e.mixId&&(t=io.mixes.find(t=>t.id===e.mixId)?.image?.name??"all"),ro.get(t)??""}getUnit(e){return"%"}setMute(e,t){const n=this.getChannelbySetting(e);if(void 0!==n){let i={id:n.id};void 0===e.mixId||"all"===e.mixId?i.isMuted=t??!n.isMuted:i.mixes=[{id:e.mixId,isMuted:t??!n.mixes.find(t=>t.id===e.mixId)?.isMuted}],io.setChannel(i)}}setValue(e){const t=this.getChannelbySetting(e);if(void 0!==t){let n={id:t.id};void 0===e.mixId||"all"===e.mixId?n.level=e.setValue/100:n.mixes=[{id:e.mixId,level:e.setValue/100}],io.setChannel(n)}}adjustValue(e,t){const n=this.getChannelbySetting(e);if(void 0!==n){let i={id:n.id};void 0===e.mixId||"all"===e.mixId?i.level=uo(lo(n.level+t/100,0,1),2):i.mixes=[{id:e.mixId,level:uo(lo((n.mixes.find(t=>t.id===e.mixId)?.level??0)+t/100,0,1),2)}],io.setChannel(i)}}getChannelbySetting(e){return e.channelId===So?io.getChannelById(io.focusedApp?.channel?.id):io.getChannelById(e.channelId)}},t})();const ko=Ws({channelId:Rs(),mixId:Rs(),actionSubtype:Rs(),actionStyle:Xs,setValue:Fs(),adjustValue:Fs(),multiActionState:Ks(Fs())});let xo=(()=>{let e,t,n=[st({UUID:"com.elgato.wave-link.addtochannel"})],i=[],s=so;return class extends s{static{t=this}static{const o="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ct(null,e={value:t},n,{kind:"class",name:t.name,metadata:o},null,i),t=e.value,o&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o}),lt(t,i)}constructor(){super(),io.eventEmitter.on(Qs.AppConnected,()=>{this.actionMap.forEach((e,t)=>{io.subscribe(Ys.FocusedAppChanged)})}),io.eventEmitter.on(Qs.AppDisconnected,()=>{this.actionMap.forEach((e,t)=>{io.unsubscribe(Ys.FocusedAppChanged)})}),io.eventEmitter.on(Qs.ChannelsChanged,()=>{Xi.notify("SoftwareChannels",this.softwareChannels())}),io.eventEmitter.on(Qs.ChannelChanged,e=>{this.actionMap.forEach((e,t)=>{t.isKey()&&(this.setImage(t),this.setState(t))})}),io.eventEmitter.on(Qs.FocusedAppChanged,e=>{this.actionMap.forEach((e,t)=>{t.isKey()&&(this.setImage(t),this.setState(t))})})}async onAppear(e){const{settings:t}=e.payload;if(!Eo.safeParse(e.payload.settings).success){const n=io.getChannelList()?.filter(e=>"Software"===e.type)?.at(0);t.channelId=n?.id??"",await e.action.setSettings(t)}io.subscribe(Ys.FocusedAppChanged)}onDisappear(){io.unsubscribe(Ys.FocusedAppChanged)}onKeyDown(e){const t=this.actionMap.get(e.action);if(void 0===t)return;const n=io.getChannelById(t.channelId);void 0===n?.apps.find(e=>e.id===io.focusedApp.id)&&io.send(Js.AddToChannel,{appId:io.focusedApp.id,channelId:t.channelId})}async setImage(e){const t=this.actionMap.get(e);if(void 0===t)return;const n=io.getChannelById(t.channelId)?.apps?.length??1,i={icon:{value:this.getIcon(t),offset:[n>1?-6.5:0,0,0,0]},modifier:{offset:[n>1?-6.5:0,0,0,0]},number:{value:`./imgs/actions/channelLevel/icons/plus${n-1}.svg`,isEnabled:n>1},title:{value:oo.truncate(io.focusedApp.name,12)}};oo.setImage(e,i,i)}setState(e){const t=this.actionMap.get(e);if(void 0===t)return;const n=io.getChannelById(t.channelId);void 0!==n?.apps.find(e=>e.id===io.focusedApp.id)?e.setState(1):e.setState(0)}getIcon(e){const t=io.getChannelById(e.channelId);return void 0!==t?.image.name?ao.get(t.image.name)??"./imgs/actions/addToChannel/icon.svg":void 0!==t?.image?.imgData?t.image.imgData:"./imgs/actions/addToChannel/icon.svg"}},t})();const Eo=Ws({channelId:Rs()});let Do=(()=>{let e,t,n,i=[st({UUID:"com.elgato.wave-link.channelaudioeffect"})],s=[],o=go,r=[];return class extends o{static{t=this}static{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(o[Symbol.metadata]??null):void 0;n=[Ji("Effects")],ct(this,null,n,{kind:"method",name:"effects",static:!1,private:!1,access:{has:e=>"effects"in e,get:e=>e.effects},metadata:a},null,r),ct(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),lt(t,s)}constructor(){super(Qs.ChannelChanged),lt(this,r)}async effects(){const e=at.ui.action;if(void 0===e)return[];const t=await e.getSettings();if(void 0!==t.channelId){const e=io.getChannelById(t.channelId);return void 0===e?[]:e.effects?.map(e=>new Vi(e.name,e.id))??[]}return[]}async onAppear(e){const{settings:t}=e.payload;if(!Co.safeParse(e.payload.settings).success){const n=io.getChannelList()?.filter(e=>"Software"===e.type)?.at(0);t.channelId=n?.id??"",t.effectId=n?.effects?.at(0)?.id??"",t.multiActionState=-1,await e.action.setSettings(t)}}async onDidReceiveSettings(e){const t=this.actionMap.get(e.action),n=e.payload.settings;if(t?.channelId!==n.channelId){const t=io.getChannelById(n.channelId);n.effectId=t?.effects?.at(0)?.id??"",await e.action.setSettings(n),this.updatePI()}super.onDidReceiveSettings(e)}setImage(e,t){const n=this.actionMap.get(e);if(void 0===n)return;const i=io.getChannelById(n.channelId);let s=this.userTitles.get(e.id);if(void 0===s||""===s){const e=i?.effects?.find(e=>e.id===n.effectId);s=e?.name??"--"}const o=i?.apps?.length??1,r={title:{value:oo.truncate(s,10)},icon:{value:i?.image.imgData,offset:[o>1?-6.5:0,0,0,0]},number:{value:`./imgs/actions/channelLevel/icons/plus${o-1}.svg`,isEnabled:o>1}};oo.setImage(e,r,r)}toggleValue(e,t){const n=io.getChannelById(e.channelId),i=n?.effects?.find(t=>t.id===e.effectId);void 0!==i&&io.setChannel({id:n?.id,effects:[{id:i.id,isEnabled:void 0===t?!i.isEnabled:t}]})}getState(e){const t=io.getChannelById(e.channelId),n=t?.effects?.find(t=>t.id===e.effectId);return void 0!==n?.isEnabled&&!n.isEnabled}getIdentifier(e){return e.channelId}async updatePI(){void 0!==at.ui.action&&Xi.notify("Effects",await this.effects())}},t})();const Co=Ws({channelId:Rs(),effectId:Rs(),multiActionState:Ks(Fs())});let Oo=(()=>{let e,t,n=[st({UUID:"com.elgato.wave-link.mixlevel"})],i=[],s=co;return class extends s{static{t=this}static{const o="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ct(null,e={value:t},n,{kind:"class",name:t.name,metadata:o},null,i),t=e.value,o&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o}),lt(t,i)}constructor(){super(to.Mix,Qs.MixChanged),this.iconPaths=ro,io.eventEmitter.on(Qs.MixesChanged,()=>{Xi.notify("Mixes",this.mixes())})}async onAppear(e){const{settings:t}=e.payload;Mo.safeParse(e.payload.settings).success||(t.mixId=io.mixes?.length>0?io.mixes[0].id:"",t.setValue=100,t.adjustValue=5,t.actionSubtype=e.action.isDial()?qs.Adjust:qs.Toggle,t.actionStyle=e.action.isDial()?Hs.SliderAndLevelmeterHorizontal:Hs.Static,t.multiActionState=-1,await e.action.setSettings(t)),void 0!==t.actionStyle&&this.showLevelMeter(t.actionStyle)&&this.setSubscription(this.getSubscriptionType(t),this.getIdentifier(t),!0,this.getSubIdentifier(t))}getData(e){const t=io.getMixById(e.mixId);return void 0!==t?{id:t.id,isMuted:t.isMuted,value:Math.round(100*t.level),name:t.name}:void 0}getIdentifier(e){return e.mixId??""}getIcon(e){const t=io.getMixById(e.mixId);return void 0===t?.image.imgData&&void 0===t?.image.name?"":void 0===t.image.imgData?ro.get(t.image.name)??"":t.image.imgData}getKeyLayout(e){let t="",n="";switch(e.actionSubtype){case qs.Toggle:t="com.elgato.wave-link.controlaction",n="com.elgato.wave-link.controlaction";break;case qs.Set:t="com.elgato.wave-link.controlaction";break;case qs.Adjust:switch(e.actionStyle){case Hs.Static:t="com.elgato.wave-link.controlaction",n="com.elgato.wave-link.controlaction";break;case Hs.SliderHorizontal:t="com.elgato.wave-link.mixsliderhorizontal";break;case Hs.SliderVertical:t="com.elgato.wave-link.mixslidervertical";break;case Hs.SliderAndLevelmeterHorizontal:t="com.elgato.wave-link.mixlevelmeterhorizontal";break;case Hs.SliderAndLevelmeterVertical:t="com.elgato.wave-link.mixlevelmetervertical"}}return[t,n]}getUnit(e){return"%"}setMute(e,t){const n=io.getMixById(e.mixId);void 0!==n&&(void 0===t?io.setMix({id:e.mixId,isMuted:!n.isMuted}):io.setMix({id:e.mixId,isMuted:t}))}setValue(e){io.setMix({id:e.mixId,level:e.setValue/100})}adjustValue(e,t){const n=io.getMixById(e.mixId);if(void 0!==n){let i={id:e.mixId,level:uo(lo(n.level+t/100,0,1),2)};"all"!==e.mixId&&(i.mixId=e.mixId),io.setMix(i)}}},t})();const Mo=Ws({mixId:Rs(),actionSubtype:Rs(),actionStyle:Xs,setValue:Fs(),adjustValue:Fs(),multiActionState:Ks(Fs())});let Po=(()=>{let e,t,n=[st({UUID:"com.elgato.wave-link.setoutputtomix"})],i=[],s=so;return class extends s{static{t=this}static{const o="function"==typeof Symbol&&Symbol.metadata?Object.create(s[Symbol.metadata]??null):void 0;ct(null,e={value:t},n,{kind:"class",name:t.name,metadata:o},null,i),t=e.value,o&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o}),lt(t,i)}addToChannelCount=0;constructor(){super(),io.eventEmitter.on(Qs.OutputDeviceChanged,()=>{this.actionMap.forEach((e,t)=>{t.isKey()&&this.setState(t)})}),io.eventEmitter.on(Qs.AppConnected,()=>{this.actionMap.forEach((e,t)=>{t.isKey()&&(this.setImage(t),this.setState(t))})}),io.eventEmitter.on(Qs.AppDisconnected,()=>{this.actionMap.forEach((e,t)=>{t.isKey()&&(this.setImage(t),this.setState(t))})})}async onAppear(e){const{settings:t}=e.payload;Ao.safeParse(e.payload.settings).success||(t.mixId=io.mixes?.at(0)?.id??"",await e.action.setSettings(t))}onKeyDown(e){const t=this.actionMap.get(e.action);void 0!==t&&io.setOutputDevice({outputDevice:{id:io.mainOutput,outputs:[{mixId:t.mixId}]}})}onPIDidAppear(e){at.ui.sendToPropertyInspector({event:"mixes",items:io.mixes.map(e=>({value:e.id,label:e.name}))})}async setImage(e){const t=this.actionMap.get(e),n=io.getMixById(t?.mixId??""),i={iconMix:{value:ro.get(n?.image?.name??"")??"./imgs/actions/addToChannel/icon.svg"},modifier:{value:"./imgs/actions/common/modifier/set.svg"}},s={iconMix:{value:ro.get(n?.image?.name??"")??"./imgs/actions/addToChannel/icon.svg"},modifier:{value:"./imgs/actions/common/modifier/check.svg"}};oo.setImage(e,i,s)}setState(e){const t=this.actionMap.get(e),n=io.getOutputById(io.mainOutput,"");if(void 0!==n?.mixId&&void 0!==t?.mixId){const i=n.mixId===t.mixId;e.setState(Number(i))}else e.setState(0)}},t})();const Ao=Ws({mixId:Rs()});var To;!function(e){e.OutputVolume="./imgs/actions/waveControl/outputVolume.svg",e.OutputVolumeMuted="./imgs/actions/waveControl/outputVolume.svg"}(To||(To={}));let zo=(()=>{let e,t,n,i=[st({UUID:"com.elgato.wave-link.outputcontrol"})],s=[],o=co,r=[];return class extends o{static{t=this}static{const a="function"==typeof Symbol&&Symbol.metadata?Object.create(o[Symbol.metadata]??null):void 0;n=[Ji("OutputDevices")],ct(this,null,n,{kind:"method",name:"outputDevices",static:!1,private:!1,access:{has:e=>"outputDevices"in e,get:e=>e.outputDevices},metadata:a},null,r),ct(null,e={value:t},i,{kind:"class",name:t.name,metadata:a},null,s),t=e.value,a&&Object.defineProperty(t,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:a}),lt(t,s)}constructor(){super(to.Output,[Qs.OutputDeviceChanged]),lt(this,r),io.eventEmitter.on(Qs.OutputDevicesChanged,e=>{this.actionMap.forEach((e,t)=>{t.isKey()?(this.setImage(t),this.setState(t)):this.setFeedback(t)})})}outputDevices(){return io.outputDevices.map(e=>new Vi(e.name,e.id))}async onAppear(e){const{settings:t}=e.payload;if(!Lo.safeParse(e.payload.settings).success){const n=io.outputDevices.at(0);t.outputDeviceId=n?.id??"",t.outputId=n?.outputs?.at(0)?.id??"",t.setValue=100,t.adjustValue=5,t.actionSubtype=e.action.isDial()?qs.Adjust:qs.Toggle,t.actionStyle=e.action.isDial()?Hs.SliderAndLevelmeterHorizontal:Hs.Static,t.multiActionState=-1,e.payload.isInMultiAction&&(t.multiActionState=-1),await e.action.setSettings(t)}}onDidReceiveSettings(e){const t=this.actionMap.get(e.action),n=e.payload.settings,i=t?.outputDeviceId!==n.outputDeviceId;if(super.onDidReceiveSettings(e),i){const e=io.getOutputDeviceById(n.outputDeviceId);n.outputId=e?.outputs?.at(0)?.id??""}i&&e.action.setSettings(n)}getData(e){const t=io.getOutputById(e.outputDeviceId,e.outputId);if(void 0===t)return;const n=Math.round(100*t.level);return{id:t.id,name:t.name,isMuted:t.isMuted,value:n,label:n}}getIdentifier(e){return e.outputDeviceId}getIcon(e,t=0){return 0===t?To.OutputVolume:To.OutputVolumeMuted}getIconSmall(e){const t=io.getOutputDeviceById(e.outputDeviceId);return void 0===t||t.type===eo.NoWaveDevice?"./imgs/actions/waveControl/icon.svg":"./imgs/actions/waveControl/outputVolume.svg"}getKeyPayloads(e){const t=this.getData(e),n={background:{isEnabled:!1},backgroundUnmuted:{isEnabled:!1},modifier:{value:"",isEnabled:!1},iconMix:{value:this.getIconSmall(e)},icon:{value:this.getIcon(e)},value:{value:"--",isEnabled:!0},title:{value:"--",isEnabled:!1}},i={background:{isEnabled:!1},backgroundMuted:{isEnabled:!1},modifier:{value:"",isEnabled:!1},iconMix:{value:this.getIconSmall(e),color:"white"},icon:{value:this.getIcon(e),color:"white"},value:{value:"--",isEnabled:!0,color:"white"},title:{value:"--",isEnabled:!1}};switch(e.actionSubtype){case qs.Toggle:n.backgroundUnmuted.isEnabled=!0,i.backgroundMuted.isEnabled=!0,i.icon.value=this.getIcon(e,1),i.icon.color="#FF3C4E",i.iconMix.color="#FF3C4E",n.value.value=void 0!==t?`${t.value}${this.getUnit(e)}`:"--",i.value.value=void 0!==t?`${t.value}${this.getUnit(e)}`:"--",i.value.color="#FF3C4E";break;case qs.Set:return n.background.isEnabled=!0,n.modifier.isEnabled=!0,n.modifier.value="./imgs/actions/common/modifier/set.svg",n.value.value=`${e.setValue}${this.getUnit(e)}`,[n,void 0];case qs.Adjust:const s=e.adjustValue;switch(n.background.isEnabled=!0,n.modifier.isEnabled=!0,n.modifier.value="./imgs/actions/common/modifier/increase.svg",n.value.value=`${s>0?s:s-1}${this.getUnit(e)}`,i.background.isEnabled=!0,i.modifier.isEnabled=!0,i.modifier.value="./imgs/actions/common/modifier/decrease.svg",i.value.value=`${s>0?s:s-1}${this.getUnit(e)}`,e.actionStyle){case Hs.SliderVertical:case Hs.SliderHorizontal:case Hs.SliderAndLevelmeterHorizontal:n.iconMix.value="",i.iconMix.value=""}}return[n,i]}getKeyLayout(e){let t="",n="";switch(e.actionSubtype){case qs.Toggle:t="com.elgato.wave-link.controlaction",n="com.elgato.wave-link.controlaction";break;case qs.Set:t="com.elgato.wave-link.controlaction";break;case qs.Adjust:switch(e.actionStyle){case Hs.Static:t="com.elgato.wave-link.controlaction",n="com.elgato.wave-link.controlaction";break;case Hs.SliderHorizontal:t="com.elgato.wave-link.mixsliderhorizontal";break;case Hs.SliderVertical:t="com.elgato.wave-link.mixslidervertical";break;case Hs.SliderAndLevelmeterHorizontal:t="com.elgato.wave-link.mixlevelmeterhorizontal";break;case Hs.SliderAndLevelmeterVertical:t="com.elgato.wave-link.mixlevelmetervertical"}}return[t,n]}getUnit(e){return"%"}setMute(e,t){const n=io.getOutputById(e.outputDeviceId,e.outputId);io.setOutputDevice({outputDevice:{id:e.outputDeviceId,outputs:[{id:e.outputId,isMuted:null==t?!n?.isMuted:t}]}})}setValue(e){void 0!==io.getOutputById(e.outputDeviceId,e.outputId)&&io.setOutputDevice({outputDevice:{id:e.outputDeviceId,outputs:[{id:e.outputId,level:e.setValue/100}]}})}adjustValue(e,t){const n=io.getOutputById(e.outputDeviceId,e.outputId);void 0!==n&&io.setOutputDevice({outputDevice:{id:e.outputDeviceId,outputs:[{id:e.outputId,level:uo(lo(n.level+t/100,0,1),2)}]}})}getSubscriptionType(e){return to.Output}},t})();const Lo=Ws({outputDeviceId:Rs(),outputId:Rs(),actionSubtype:Rs(),actionStyle:Xs,setValue:Fs(),adjustValue:Fs(),multiActionState:Ks(Fs())}),$o="Wave Link",No=[new vo,new yo,new _o,new Io,new xo,new Do,new Oo,new Po,new zo];at.logger.setLevel(ge.INFO),at.logger.info("Wave link 3 Plugin"),at.logger.info("--------------------------------------------------------------------"),at.logger.info(`Plugin version:       ${at.info.plugin.version}`),at.logger.info(`Stream Deck version:  ${at.info.application.version}`),at.logger.info(`Platform:             ${at.info.application.platform}`),at.logger.info(`Platform version:     ${at.info.application.platformVersion}`),at.logger.info("--------------------------------------------------------------------");for(let e=0;e<No.length;e++)at.actions.registerAction(No[e]);at.connect(),at.system.onApplicationDidLaunch(e=>{io.isAppConnected()||(at.logger.info(`Application did launch: ${e.application}`),setTimeout(()=>{at.logger.info(`Trying to connect to ${$o}`),io.connect()},1e3))}),at.system.onApplicationDidTerminate(e=>{at.logger.info(`Application did terminate: ${e.application}`),io.disconnect()}),setTimeout(()=>{io.isAppConnected()||(at.logger.info(`No ApplicationDidLaunchEvent received, start trying to connect to ${$o}`),io.connect())},2e3);
